<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Introduction √† l‚Äôutilisation de YAML, un langage lisible et expressif devenu incontournable dans l‚Äô√©co-syst√®me DevOps.">

<title>YAML 101 ‚Äì Mise en production</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-b66d9f3da4d84aca26cc7cc1c94b0445.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-1.2.0/all.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-1.2.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>
div.callout-application.callout {
  border-left-color: #9c5bd9;
}
div.callout-application.callout-style-default > .callout-header {
  background-color: rgba(156, 91, 217, 0.13);
}
div.callout-application .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-application.callout-style-default .callout-icon::before, div.callout-application.callout-titled .callout-icon::before {
  content: 'üß†';
  background-image: none;
}
</style>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://ensae-reproductibilite.github.io/"> 
<span class="menu-text">Mise en production</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../chapters/introduction.html"> 
<span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-les-bases" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Les bases</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-les-bases">    
        <li>
    <a class="dropdown-item" href="../chapters/linux101.html">
 <span class="dropdown-text">Linux 101</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/git.html">
 <span class="dropdown-text">Git</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bonnes-pratiques-de-d√©veloppement" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Bonnes pratiques de d√©veloppement</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-bonnes-pratiques-de-d√©veloppement">    
        <li>
    <a class="dropdown-item" href="../chapters/code-quality.html">
 <span class="dropdown-text">Qualit√© du code</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/projects-architecture.html">
 <span class="dropdown-text">Structure des projets</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/big-data.html">
 <span class="dropdown-text">Traitement des donn√©es volumineuses</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/portability.html">
 <span class="dropdown-text">Portabilit√©</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-mise-en-production" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Mise en production</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-mise-en-production">    
        <li>
    <a class="dropdown-item" href="../chapters/yaml101.html">
 <span class="dropdown-text">YAML 101</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/deployment.html">
 <span class="dropdown-text">D√©ploiement</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/mlops.html">
 <span class="dropdown-text">MLOps</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../chapters/application.html"> 
<span class="menu-text">Application</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-projets" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Projets</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-projets">    
        <li>
    <a class="dropdown-item" href="../chapters/evaluation.html">
 <span class="dropdown-text">Modalit√©s d‚Äô√©valuation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/galerie.html">
 <span class="dropdown-text">Galerie des projets pass√©s</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-bi-github">    
        <li>
    <a class="dropdown-item" href="https://github.com/ensae-reproductibilite/website">
 <span class="dropdown-text">Site web</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/ensae-reproductibilite/slides">
 <span class="dropdown-text">Slides</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/ensae-reproductibilite/application">
 <span class="dropdown-text">Application fil rouge</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#quest-ce-que-le-format-yaml" id="toc-quest-ce-que-le-format-yaml" class="nav-link active" data-scroll-target="#quest-ce-que-le-format-yaml">Qu‚Äôest-ce que le format <code>YAML</code></a></li>
  <li><a href="#yaml-et-lapproche-gitops" id="toc-yaml-et-lapproche-gitops" class="nav-link" data-scroll-target="#yaml-et-lapproche-gitops"><code>YAML</code> et l‚Äôapproche <code>GitOps</code></a></li>
  <li><a href="#yaml-vs.-json" id="toc-yaml-vs.-json" class="nav-link" data-scroll-target="#yaml-vs.-json"><code>YAML</code> <em>vs.</em> <code>JSON</code></a></li>
  <li><a href="#caract√©ristiques-dun-fichier-yaml" id="toc-caract√©ristiques-dun-fichier-yaml" class="nav-link" data-scroll-target="#caract√©ristiques-dun-fichier-yaml">Caract√©ristiques d‚Äôun fichier <code>YAML</code></a></li>
  <li><a href="#utilisation-programmatique" id="toc-utilisation-programmatique" class="nav-link" data-scroll-target="#utilisation-programmatique">Utilisation programmatique</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<script>
  const langButton = document.createElement("div");
  langButton.className = "lang-switch-button";
  langButton.style.textAlign = "right";
  langButton.style.marginTop = "1rem";
  langButton.style.marginBottom = "1rem";

  const currentPath = window.location.pathname;

  // G√©rer les cas avec un sous-r√©pertoire comme /website
  const normalizedPath = currentPath.replace(/^\/website/, "");
  const isEnglish = normalizedPath.includes("/en/");
  let targetHref, label, svg;

  if (isEnglish) {
    targetHref = currentPath.replace("/en/", "/");  // conserve le pr√©fixe /website si pr√©sent
    label = "Passer √† la version fran√ßaise";
    svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="20" height="20" style="vertical-align: middle; margin-left: 0.5em; display: inline-block;"><mask id="circleFlagsLangFr"><circle cx="256" cy="256" r="256" fill="#fff"/></mask><g mask="url(#circleFlagsLangFr)"><path fill="#0055A4" d="M0 0h512v512H0z"/><path fill="#fff" d="M170.7 0h170.6v512H170.7z"/><path fill="#EF4135" d="M341.3 0H512v512H341.3z"/></g></svg>`;
  } else {
    const prefix = currentPath.startsWith("/website") ? "/website" : "";
    targetHref = prefix + "/en" + currentPath.slice(prefix.length);
    label = "Switch to English version";
    svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="20" height="20" style="vertical-align: middle; margin-left: 0.5em; display: inline-block;"><mask id="circleFlagsLangEn"><circle cx="256" cy="256" r="256" fill="#fff"/></mask><g mask="url(#circleFlagsLangEn)"><path fill="#eee" d="M256 0L0 256v64l32 32l-32 32v128l22-8l23 8h23l54-32l54 32h32l48-32l48 32h32l54-32l54 32h68l-8-22l8-23v-23l-32-54l32-54v-32l-32-48l32-48v-32l-32-54l32-54V0z"/><path fill="#d80027" d="M224 64v64h160l64-64zm0 128l32 64l-48 48v208h96V304h208v-96H304l16-16zM0 320v64h128l-64 64H0v64h45l131-131v-45l16-16zm336 16l176 176v-45L381 336Z"/><path fill="#0052b4" d="M0 0v256h256V0zm512 68L404 176h108zM404 336l108 108V336zm-228 68L68 512h108zm160 0v108h108z"/><path fill="#eee" d="m187 243l57-41h-70l57 41l-22-67zm-81 0l57-41H93l57 41l-22-67zm-81 0l57-41H12l57 41l-22-67zm162-81l57-41h-70l57 41l-22-67zm-81 0l57-41H93l57 41l-22-67zm-81 0l57-41H12l57 41l-22-67Zm162-82l57-41h-70l57 41l-22-67zm-81 0l57-41H93l57 41l-22-67Zm-81 0l57-41H12l57 41l-22-67Z"/></g></svg>`;
  }

  langButton.innerHTML = `
    <a href="${targetHref}" class="button-cta">
      <button class="btn"><i class="fa fa-language"></i> ${label} ${svg}</button>
    </a>
  `;

  const main = document.querySelector("main#quarto-document-content");
  if (main) main.insertAdjacentElement("afterbegin", langButton);
</script>
    

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">YAML 101</h1>
</div>

<div>
  <div class="description">
    <p>Introduction √† l‚Äôutilisation de <code>YAML</code>, un langage lisible et expressif devenu incontournable dans l‚Äô√©co-syst√®me DevOps.</p>
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<details>
<summary>
D√©rouler les <em>slides</em> ci-dessous ou <a href="https://ensae-reproductibilite.github.io/slides/#/introduction-au-format-yaml">cliquer ici</a> pour afficher les slides en plein √©cran.
</summary>
<div class="code-copy-outer-scaffold"><div id="cb1" class="sourceCode">
<pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
<iframe class="sourceCode yaml code-with-copy" src="https://ensae-reproductibilite.github.io/slides/#/introduction-au-format-yaml">
</iframe>
</div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<section id="quest-ce-que-le-format-yaml" class="level2">
<h2 class="anchored" data-anchor-id="quest-ce-que-le-format-yaml">Qu‚Äôest-ce que le format <code>YAML</code></h2>
<p><code>YAML</code> est un acronyme r√©cursif signifiant <a href="https://yaml.org/"><em>YAML Ain‚Äôt Markup Language</em></a>. <code>YAML</code> est un langage de s√©rialisation de donn√©es au format texte : il permet de structurer de la donn√©e dans des fichiers textuels, √† l‚Äôinstar d‚Äôautres formats populaires (<code>CSV</code>, <code>JSON</code>, <code>XML</code>, etc.).</p>
<p>Sa sp√©cificit√© par rapport aux autres formats populaires est qu‚Äôil est con√ßu pour √™tre √† la fois expressif et <strong>facile √† lire</strong> pour un humain. Expressif dans la mesure o√π il permet de repr√©senter de l‚Äôinformation hi√©rarchique, ce que ne permet pas le format <code>CSV</code> par exemple qui repr√©sente essentiellement des donn√©es tabulaires (‚Äúfichier plat‚Äù). Lisible car, contrairement aux languages dont la structure est bas√©e sur des balises (<em>markup</em>) comme <code>XML</code> ou bien d√©limit√©e par des symboles comme l‚Äôaccolade en <code>JSON</code>, <code>YAML</code> se d√©marque par une syntaxe bas√©e sur l‚Äôindentation ‚Äî comme <code>Python</code>.</p>
<p>Voici un exemple typique d‚Äôun fichier <code>YAML</code>, qui compare les principaux langages utilis√©s pour repr√©senter des donn√©es hi√©rarchiques dans un format textuel<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1" data-code-line-numbers=""><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">type</span><span class="kw">:</span><span class="at"> tutorial</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">domain</span><span class="kw">:</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> devops</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">language</span><span class="kw">:</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">yaml</span><span class="kw">:</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">name</span><span class="kw">:</span><span class="at"> YAML Ain't Markup Language</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">born</span><span class="kw">:</span><span class="at"> </span><span class="dv">2001</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">legibility</span><span class="kw">:</span><span class="at"> awesome</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">json</span><span class="kw">:</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">name</span><span class="kw">:</span><span class="at"> JavaScript Object Notation</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">born</span><span class="kw">:</span><span class="at"> </span><span class="dv">2001</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">legibility</span><span class="kw">:</span><span class="at"> good</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">xml</span><span class="kw">:</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Extensible Markup Language</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">born</span><span class="kw">:</span><span class="at"> </span><span class="dv">1996</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">legibility</span><span class="kw">:</span><span class="at"> bad</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="yaml-et-lapproche-gitops" class="level2">
<h2 class="anchored" data-anchor-id="yaml-et-lapproche-gitops"><code>YAML</code> et l‚Äôapproche <code>GitOps</code></h2>
<p>Gr√¢ce √† sa lisibilit√©, le langage <code>YAML</code> est rapidement devenu un standard dans les √©cosyst√®mes <code>DevOps</code> et <code>MLOps</code> dans la mesure o√π il facilite grandement l‚Äôinteraction entre les humains et les syst√®mes automatis√©s. Il permet de d√©finir de mani√®re lisible des r√®gles, bas√©es sur des param√®tres, qui peuvent facilement √™tre interpr√©t√©es √† la fois par des humains (du fait de sa lisibilit√©) et par des machines (du fait de sa structure hi√©rarchis√©e).</p>
<p>En particulier, le <code>YAML</code> est devenu un √©l√©ment central des environnements de d√©ploiement modernes bas√©s sur une approche dite <strong>d√©clarative</strong> (<a href="#nte-sql-declarative" class="quarto-xref">Note&nbsp;1</a>). Au lieu de sp√©cifier √©tape par √©tape comment d√©ployer une ressource (approche <strong>imp√©rative</strong>), <code>YAML</code> permet de d√©crire simplement <strong>l‚Äô√©tat final souhait√©</strong> de l‚Äôenvironnement. C‚Äôest alors l‚Äôoutil utilis√© (par exemple, <code>Kubernetes</code> dans l‚Äôexemple ci-dessous) qui g√®re les d√©tails d‚Äôimpl√©mentation de mani√®re la plus adapt√©e. On parle souvent d‚Äôapproche <strong><em>Infrastructure as Code</em></strong> : l‚Äôinfrastructure peut √™tre compl√®tement d√©crite dans des fichiers de configuration <code>YAML</code> ‚Äî qu‚Äôon appelle <strong>manifestes</strong> ‚Äî qui permettent de d√©crire l‚Äô√©tat souhait√© de celle-ci. Cette mani√®re de sp√©cifier les environnements favorise la <strong>reproductibilit√©</strong>, chaque √©tat de l‚Äôinfrastructure √©tant clairement d√©crit et pouvant √™tre reproduit simplement.</p>
<div id="nte-sql-declarative" class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note&nbsp;1: YAML n‚Äôest pas le premier langage d√©claratif que vous avez appris !
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>A titre d‚Äôanalogie, l‚Äôapproche d√©clarative est √©galement au c≈ìur du langage <code>SQL</code>.</p>
<p>En <code>SQL</code>, on d√©crit le traitement souhait√© dans un langage proche du langage naturel (<em>SELECT</em> ce groupe de variables, <em>FILTER</em> ces individus, etc.) et c‚Äôest le moteur d‚Äôex√©cution sous-jacent qui choisit comment effectuer les calculs demand√©s de mani√®re optimale.</p>
<p>C‚Äôest notamment une des raisons de la popularit√© du langage <code>SQL</code> dans l‚Äô√©co-syst√®me <em>big data</em> : il est possible d‚Äôappliquer une m√™me requ√™te √† des donn√©es de volum√©tries tr√®s diff√©rentes dans la mesure o√π le moteur d‚Äôex√©cution sous-jacent va convertir la requ√™te de mani√®re appropri√©e. Par exemple, une requ√™te <code>SQL</code> sera convertie par <code>Spark</code> en op√©rations <code>MapReduce</code> distribu√©es permettant de traiter des volumes consid√©rables de donn√©es (voir chapitre <a href="../chapters/big-data.html"><em>big data</em></a> pour plus de d√©tails).</p>
</div>
</div>
</div>
<p>Bien entendu, ces fichiers d√©crivant les environnements souhait√©s ont vocation √† √™tre versionn√©s sur un d√©p√¥t <code>Git</code> <i class="fa-brands fa-git-alt" aria-label="git-alt"></i>. Cette extension directe de l‚Äôapproche <em>Infrastructure as Code</em> se nomme le <strong><em>GitOps</em></strong> : l‚Äôarchitecture est d√©crite sous forme de manifestes (<code>YAML</code>) et ces manifestes sont versionn√©s sur un d√©p√¥t <code>Git</code> qui devient ainsi la <strong>source de v√©rit√© unique</strong> de sp√©cification de l‚Äôenvironnement. Cette approche favorise √† la fois la <strong>tra√ßabilit√©</strong> ‚Äî tout changement est document√© dans l‚Äôhistorique du d√©p√¥t <code>Git</code> ‚Äî et l‚Äô<strong>automatisation</strong> ‚Äî l‚Äôinfrastructure peut √™tre d√©ploy√©e automatiquement √† partir du d√©p√¥t <code>Git</code> gr√¢ce √† des outils de d√©ploiement continus orient√©s <strong><em>GitOps</em></strong> comme <code>ArgoCD</code> (cf.&nbsp;chapitre <a href="../chapters/deployment.html">d√©ploiement</a>).</p>
<p>Voici un exemple illustrant ce concept dans le contexte de <code>Kubernetes</code>. On d√©clare dans un manifeste <code>YAML</code> une ressource de type <code>Pod</code>, qui a des m√©tadonn√©es (un nom) et des sp√©cifications. On y d√©clare le conteneur que le <code>Pod</code> doit d√©ployer : celui d‚Äôune API <a href="https://fastapi.tiangolo.com/"><code>FastAPI</code></a> (voir l‚Äô<a href="../chapters/application.html">application fil rouge</a> pour plus de d√©tails). On passe √† ce conteneur une variable d‚Äôenvironnement (cf.&nbsp;chapitre <a href="../chapters/linux101.html">Linux 101</a>) qui sp√©cifie le mod√®le √† d√©ployer via l‚ÄôAPI au <em>runtime</em>. Ainsi, on d√©crit dans ce manifeste l‚Äô√©tat souhait√©, et <code>Kubernetes</code> se charge du d√©ploiement effectif du conteneur.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>example.yaml</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2" data-file="example.yaml" data-filename="example.yaml" data-code-line-numbers=""><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Pod</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-api-pod</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> api</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">image</span><span class="kw">:</span><span class="at"> my_dh_account/my_fast_api:0.0.1</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> MODEL</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">value</span><span class="kw">:</span><span class="at"> deepseek-ai/DeepSeek-R1</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="yaml-vs.-json" class="level2">
<h2 class="anchored" data-anchor-id="yaml-vs.-json"><code>YAML</code> <em>vs.</em> <code>JSON</code></h2>
<p>Les langages <code>YAML</code> et <code>JSON</code> sont tr√®s proches dans la repr√©sentation hi√©rarchique de l‚Äôinformation qu‚Äôils permettent. Fonctionnellement, le langage <code>YAML</code> est un <strong>superset</strong> du langage <code>JSON</code>. Cela signifie que tout ce qui est repr√©sentable en <code>JSON</code> peut l‚Äô√™tre en <code>YAML</code> mais l‚Äôinverse n‚Äôest pas n√©cessairement vrai ‚Äî m√™me s‚Äôil est tr√®s rare en pratique de ne pas pouvoir faire la conversion dans les deux sens. Plusieurs outils en ligne, comme <a href="https://jsonformatter.org/%60YAML%60-to-json"><code>YAML</code>-to-json</a> et <a href="https://jsonformatter.org/json-to-%60YAML%60">json-to-<code>YAML</code></a>, permettent de convertir facilement ces formats entre eux.</p>
<p>Comparons √† titre d‚Äôillustration les repr√©sentations <code>YAML</code> et <code>JSON</code> du manifeste <code>Kubernetes</code> pr√©c√©dent.</p>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3" data-code-line-numbers=""><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Pod</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-api-pod</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> api</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">image</span><span class="kw">:</span><span class="at"> my_dh_account/my_fast_api:0.0.1</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> MODEL</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">value</span><span class="kw">:</span><span class="at"> deepseek-ai/DeepSeek-R1</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4" data-code-line-numbers=""><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"kind"</span><span class="fu">:</span> <span class="st">"Pod"</span><span class="fu">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"metadata"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"my-api-pod"</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"spec"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"containers"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"api"</span><span class="fu">,</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"image"</span><span class="fu">:</span> <span class="st">"my_dh_account/my_fast_api:0.0.1"</span><span class="fu">,</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"env"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>          <span class="fu">{</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"MODEL"</span><span class="fu">,</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"value"</span><span class="fu">:</span> <span class="st">"deepseek-ai/DeepSeek-R1"</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        <span class="ot">]</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
<p>La comparaison entre les deux repr√©sentations illustre clairement la diff√©rence majeure entre les deux langages : le <code>YAML</code> est facilement lisible par l‚Äôhumain l√† o√π le <code>JSON</code> est plus verbeux et ressemble donc plus √† un ‚Äúlangage machine‚Äù. En effet, <code>YAML</code> utilise l‚Äôindentation pour structurer les donn√©es l√† o√π <code>JSON</code> utilise des accolades pour structurer ses objets, ce qui limite sa lisibilit√© mais le rend √©galement moins susceptible aux erreurs d‚Äôindentation.</p>
<p>Il n‚Äôest donc pas √©tonnant que <code>YAML</code> soit devenu le langage de r√©f√©rence dans le monde du <code>GitOps</code>, les fichiers de configuration d√©claratifs √©tant g√©n√©ralement g√©n√©r√©s et lus par des humains. A l‚Äôinverse, <code>JSON</code> reste le langage standard de communication avec une API, dont les r√©ponses sont g√©n√©ralement lues par d‚Äôautres applications ou bien par le biais d‚Äôun langage de programmation, ce √† quoi se pr√™te tr√®s bien une structure plus verbeuse mais aussi plus robuste.</p>
</section>
<section id="caract√©ristiques-dun-fichier-yaml" class="level2">
<h2 class="anchored" data-anchor-id="caract√©ristiques-dun-fichier-yaml">Caract√©ristiques d‚Äôun fichier <code>YAML</code></h2>
<p>Les fichiers <code>YAML</code> portent g√©n√©ralement les extensions <code>.yaml</code> ou <code>.yml</code>. En pratique ‚Äî et cela est vrai pour tous les formats de fichier en pratique ‚Äî ce n‚Äôest pas l‚Äôextension qui fait qu‚Äôun fichier texte est un fichier <code>YAML</code>, mais bien la validit√© de son contenu au regard de la norme <code>YAML</code>. On doit donc respecter un certains nombres de r√®gles et utiliser les types pr√©vus pour produire un fichier <code>YAML</code>.</p>
<p><em>Premi√®re r√®gle</em> : le contenu d‚Äôun fichier <code>YAML</code> est organis√© en <strong>paires cl√©-valeur</strong> imbriqu√©es, √† la mani√®re d‚Äôun dictionnaire en <code>Python</code>. La structure hi√©rarchique, c‚Äôest √† dire l‚Äôimbrication des dictionnaires de donn√©es, est marqu√©e par l‚Äôindentation. Par convention, on indente avec <strong>deux espaces</strong> (pas de tabulation!) √† chaque niveau de hi√©rarchie.</p>
<p><strong>Seconde r√®gle</strong> : on doit utiliser les types de donn√©es support√©s par <code>YAML</code>. En pratique, ils sont suffisamment nombreux pour couvrir la plupart des usages :</p>
<ul>
<li><strong>Cha√Ænes de caract√®res</strong> : de la donn√©e textuelle. On peut choisir de l‚Äôentourer ou non de guillemets. Par convention, tout ce qui n‚Äôest pas des autres types de cette liste est au format textuel, il n‚Äôest donc pas indispensable de mettre des guillemets (√† l‚Äôinverse du <code>JSON</code>).</li>
<li><strong>Num√©riques</strong> : entiers ou flottants (exemple : <code>42</code>, <code>3.14</code>). Attention √† ne pas mettre de guillemets dans ce cas, sinon les nombres seront reconnus comme des cha√Ænes de caract√®res.</li>
<li><strong>Bool√©ens</strong> : repr√©sent√©s par <code>true</code> ou <code>false</code> (tout en minuscule!). L√† encore, pas de guillemets.</li>
<li><strong>Listes</strong> : √©l√©ments pr√©c√©d√©s d‚Äôun tiret (<code>-</code>). Les √©l√©ments d‚Äôune liste peuvent √™tre, et sont souvent, √† plusieurs niveaux, le YAML permettant une structure imbriqu√©e.</li>
</ul>
<p>Agr√©mentons encore un peu le manifeste de d√©ploiement <code>Kubernetes</code> pour faire appara√Ætre l‚Äôensemble de ces types.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5" data-code-line-numbers=""><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Pod</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-api-pod</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> api</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">image</span><span class="kw">:</span><span class="at"> my_dh_account/my_fast_api:0.0.1</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> MODEL</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">value</span><span class="kw">:</span><span class="at"> deepseek-ai/DeepSeek-R1</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> DEBUG</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">containerPort</span><span class="kw">:</span><span class="at"> </span><span class="dv">8000</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>On voit ici que dans notre param√®tre <code>env</code>, on a pu mettre plusieurs valeurs. M√™me si on ne connait pas les d√©tails de l‚Äôimpl√©mentation sous-jacente, on peut se douter qu‚Äôon va injecter deux variables d‚Äôenvironnement √† notre API dont les valeurs sont d√©finies dans ce fichier.</p>
<p>Les cl√©s-valeurs accept√©es sont des conventions, elles d√©pendent de chaque solution logicielle. Mais, globalement, les param√®tres d‚Äôinstruction accept√©s par telle ou telle machine se ressemblent. Dans le cadre de l‚Äô<a href="../chapters/application.html">application fil rouge</a>, nous proposons l‚Äôutilisation de <code>Github Actions</code>, qui repose sur la sp√©cification <a href="https://github.com/mustache/spec"><code>Mustache</code></a>, d‚Äô<code>Argo</code> et de <code>Kubernetes</code>. Ces solutions techniques r√©pondent √† des besoins diff√©rents mais pr√©sentent le point commun de recevoir toutes trois leurs instructions depuis des <code>YAML</code>.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Validation et erreurs fr√©quentes
</div>
</div>
<div class="callout-body-container callout-body">
<p>Le principal point de vigilance lorsqu‚Äôon √©crit du <code>YAML</code> concerne l‚Äôindentation. Celle-ci est essentielle √† la structuration des donn√©es. L‚Äôindentation recommand√©e est de <strong>deux espaces</strong> ; jamais de tabulations, qui peuvent g√©n√©rer des erreurs d‚Äôinterpr√©tation car il s‚Äôagit de caract√®res sp√©ciaux.</p>
<p>Pour pr√©venir ces erreurs, de nombreux outils de validation existent :</p>
<ul>
<li><strong>IDE</strong> : les IDE standards comme <code>VSCode</code>, <code>PyCharm</code>, etc. supportent nativement le <code>YAML</code> et indiquent donc imm√©diatement les erreurs d‚Äôindentation ou de syntaxe. Il est utile d‚Äôavoir dans son IDE une coloration des indentations pour faire moins d‚Äôerreur: dans <code>VSCode</code>, vous pouvez installer l‚Äôextension <a href="https://marketplace.visualstudio.com/items?itemName=oderwat.indent-rainbow">indent-rainbow</a> pour cela<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</li>
<li><strong><em>Linters</em></strong> : des outils sp√©cialis√©s pour valider le contenu d‚Äôun fichier <code>YAML</code>. <a href="https://yamllint.com">YAMLlint</a> en est un choix courant.</li>
</ul>
<p>Si vous utilisez des actions <code>Github</code>, l‚Äôinterface de <code>Github</code> depuis votre navigateur effectue un diagnostic de la validit√© formelle du YAML. Si vous <em>committez</em> un fichier non valide formellement (par exemple √† cause d‚Äôune erreur d‚Äôidentation), <code>Github</code> ne lancera pas l‚Äôaction. Il peut donc √™tre utile de v√©rifier, si une action ne se lance pas, si cela vient d‚Äôun probl√®me de formattage du fichier en l‚Äôouvrant directement depuis <code>Github</code>.</p>
</div>
</div>
</section>
<section id="utilisation-programmatique" class="level2">
<h2 class="anchored" data-anchor-id="utilisation-programmatique">Utilisation programmatique</h2>
<p>Comme on l‚Äôa vu, le langage <code>YAML</code> est pens√© avant tout pour √™tre √©crit et lus par des humains. Cela dit, on peut vouloir parfois g√©n√©rer par exemple de nombreux fichiers <code>YAML</code> √† partir d‚Äôun m√™me template, ou bien r√©cup√©rer de mani√®re automatis√©e des informations dans un fichier de configuration <code>YAML</code>. De la m√™me mani√®re qu‚Äôun fichier <code>JSON</code> par exemple, il est tout √† fait possible d‚Äôinteragir avec un fichier <code>YAML</code> de mani√®re programmatique.</p>
<p>En <code>Python</code>, le <em>package</em> de r√©f√©rence pour manipuler du <code>YAML</code> est <a href="https://pypi.org/project/PyYAML/">PyYAML</a>. Illustrons quelques commandes de base.</p>
<div id="6c96c935" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yaml</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Supposons que le fichier de d√©ploiement <code>Kubernetes</code> qu‚Äôon a utilis√© tout a long de ce tutoriel soit √©crit dans un fichier <code>api-deployment.yaml</code>. Commen√ßons par l‚Äôimporter et r√©cup√©rer quelques informations.</p>
<p>La syntaxe pour importer le contenu d‚Äôun fichier <code>YAML</code> est semblable √† celle pour n‚Äôimporte quel fichier. On utilise la fonction <code>safe_load</code> du <em>package</em> <code>PyYAML</code>.</p>
<div id="5cf61256" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"api-deployment.yaml"</span>, <span class="st">"r"</span>) <span class="im">as</span> file_in:</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  manifest <span class="op">=</span> yaml.safe_load(file_in)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(manifest)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>{'kind': 'Pod', 'metadata': {'name': 'my-api-pod'}, 'spec': {'containers': [{'env': [{'name': 'MODEL', 'value': 'deepseek-ai/DeepSeek-R1'}, {'name': 'DEBUG', 'value': True}], 'image': 'my_dh_account/my_fast_api:0.0.1', 'name': 'api', 'ports': [{'containerPort': 8000}]}]}}</code></pre>
</div>
</div>
<p>Le contenu est charg√© en <code>Python</code> sous la forme d‚Äôun dictionnaire, qui est la mani√®re naturelle en <code>Python</code> de repr√©senter de l‚Äôinformation hi√©rarchique. A partir de l√†, on peut requ√™ter le contenu du fichier <code>YAML</code> √† la mani√®re de n‚Äôimporte quel dictionnaire <code>Python</code>. R√©cup√©rons par exemple le nom du mod√®le d√©ploy√©.</p>
<div id="f5e729d4" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  manifest</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  .get(<span class="st">"spec"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  .get(<span class="st">"containers"</span>)[<span class="dv">0</span>]</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  .get(<span class="st">"env"</span>)[<span class="dv">0</span>]</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  .get(<span class="st">"value"</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ou en version plus succincte:</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># print(manifest["spec"]["containers"][0]["env"][0]["value"])</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>deepseek-ai/DeepSeek-R1</code></pre>
</div>
</div>
<p>Le chemin dans le dictionnaire refl√®te les diff√©rents objets qui structurent un fichier <code>YAML</code>. Les cl√©s (‚Äúspec‚Äù, ‚Äúcontainers‚Äù) correspondent aux dictionnaires en <code>YAML</code>, et les index num√©riques (‚Äú0‚Äù ici) correspondent √† la s√©lection d‚Äôun √©l√©ment par position dans une liste. Ici, on r√©cup√®re la sp√©cification du premier conteneur ‚Äî et le seul en l‚Äôoccurrence, mais le <code>Pod</code> pourrait h√©berger plusieurs conteneurs ‚Äî et, pour ce conteneur, on r√©cup√®re la premi√®re variable d‚Äôenvironnement (<code>MODEL</code>) dont on extrait la valeur (le nom du mod√®le).</p>
<p>A pr√©sent, int√©ressons-nous au cas o√π l‚Äôon voudrait modifier une information du fichier <code>YAML</code> et exporter un manifeste actualis√©. On va changer la valeur de la variable d‚Äôenvironnement <code>DEBUG</code> de <code>true</code> √† <code>false</code>. En pratique, on fait la modification sur le dictionnaire en <code>Python</code>, puis on exporte le dictionnaire au format <code>YAML</code>.</p>
<div id="325ec9f0" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># V√©rification du contenu actuel</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(manifest[<span class="st">"spec"</span>][<span class="st">"containers"</span>][<span class="dv">0</span>][<span class="st">"env"</span>][<span class="dv">1</span>])</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Modification du contenu</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>manifest[<span class="st">"spec"</span>][<span class="st">"containers"</span>][<span class="dv">0</span>][<span class="st">"env"</span>][<span class="dv">1</span>][<span class="st">"value"</span>] <span class="op">=</span> <span class="va">False</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(manifest[<span class="st">"spec"</span>][<span class="st">"containers"</span>][<span class="dv">0</span>][<span class="st">"env"</span>][<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>{'name': 'DEBUG', 'value': True}
{'name': 'DEBUG', 'value': False}</code></pre>
</div>
</div>
<p>L‚Äôop√©ration a fonctionn√© sur l‚Äôobjet en m√©moire dans <code>Python</code>. On exporte finalement le dictionnaire au format <code>YAML</code>.</p>
<div id="1c27f4fc" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'api-deployment-modifie.yaml'</span>, <span class="st">'w'</span>) <span class="im">as</span> file_out:</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    yaml.dump(manifest, file_out)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># V√©rification</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">open</span>(<span class="st">"api-deployment-modifie.yaml"</span>, <span class="st">"r"</span>).read())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>kind: Pod
metadata:
  name: my-api-pod
spec:
  containers:
  - env:
    - name: MODEL
      value: deepseek-ai/DeepSeek-R1
    - name: DEBUG
      value: false
    image: my_dh_account/my_fast_api:0.0.1
    name: api
    ports:
    - containerPort: 8000
</code></pre>
</div>
</div>
<p>Le manifeste export√© a bien √©t√© modifi√© comme attendu.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Du fait de sa pr√©dominance dans l‚Äô√©co-syst√®me <code>DevOps</code> / <code>MLOps</code>, la ma√Ætrise du langage <code>YAML</code> est aujourd‚Äôhui indispensable pour tout <em>data scientist</em> impliqu√© dans des projets visant la mise en production. Sa syntaxe lisible mais puissante et sa compatibilit√© avec le paradigme d√©claratif en font un langage de choix pour la d√©claration de manifestes en mode <em>GitOps</em>. Cette approche est progressivement devenue un standard pour le d√©ploiement industrialis√© d‚Äôapplications et sera centrale dans les chapitres suivants sur le <a href="../chapters/deployment.html">d√©ploiement</a> et le <a href="../chapters/mlops.html">MLOps</a>.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>L‚Äôexemple pr√©sent√© est inspir√© de <a href="https://www.ambient-it.net/tout-savoir-fichiers-yaml/">ce tutoriel</a>.<a href="#fnref1" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
<li id="fn2"><p>Dans le cadre de l‚Äô<a href="../chapters/application.html">application fil rouge</a>, si vous cr√©ez votre <code>VSCode</code> √† partir de la configuration propos√©e, celle-ci est install√©e par d√©faut pour vous.<a href="#fnref2" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<script src="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>