<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Présentation des principes et des techniques permettant de rendre un projet exécutable sur différents environnements.">

<title>Portabilité – Mise en production</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-957390e16f8056bf57452af51c800dd0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Mise en production</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../chapters/introduction.html"> 
<span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-les-bases" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Les bases</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-les-bases">    
        <li>
    <a class="dropdown-item" href="../chapters/linux-101.html">
 <span class="dropdown-text">Linux 101</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/git.html">
 <span class="dropdown-text">Git</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bonnes-pratiques-de-développement" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Bonnes pratiques de développement</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-bonnes-pratiques-de-développement">    
        <li>
    <a class="dropdown-item" href="../chapters/code-quality.html">
 <span class="dropdown-text">Qualité du code</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/projects-architecture.html">
 <span class="dropdown-text">Structure des projets</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/big-data.html">
 <span class="dropdown-text">Traitement des données volumineuses</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/portability.html">
 <span class="dropdown-text">Portabilité</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-mise-en-production" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Mise en production</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-mise-en-production">    
        <li>
    <a class="dropdown-item" href="../chapters/deployment.html">
 <span class="dropdown-text">Déploiement</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/mlops.html">
 <span class="dropdown-text">MLOps</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../chapters/application.html"> 
<span class="menu-text">Application</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-projets" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Projets</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-projets">    
        <li>
    <a class="dropdown-item" href="../chapters/evaluation.html">
 <span class="dropdown-text">Modalités d’évaluation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/galerie.html">
 <span class="dropdown-text">Galerie des projets passés</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-bi-github">    
        <li>
    <a class="dropdown-item" href="https://github.com/ensae-reproductibilite/website">
 <span class="dropdown-text">Site web</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/ensae-reproductibilite/slides">
 <span class="dropdown-text">Slides</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/ensae-reproductibilite/application-correction">
 <span class="dropdown-text">Application fil rouge</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction-la-notion-de-portabilité" id="toc-introduction-la-notion-de-portabilité" class="nav-link active" data-scroll-target="#introduction-la-notion-de-portabilité">Introduction : la notion de portabilité</a></li>
  <li><a href="#virtualenv" id="toc-virtualenv" class="nav-link" data-scroll-target="#virtualenv">Les environnements virtuels <i class="fa-brands fa-python" aria-label="python"></i></a>
  <ul class="collapse">
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#fonctionnement" id="toc-fonctionnement" class="nav-link" data-scroll-target="#fonctionnement">Fonctionnement</a></li>
  <li><a href="#implémentations" id="toc-implémentations" class="nav-link" data-scroll-target="#implémentations">Implémentations</a></li>
  <li><a href="#guide-pratique-dutilisation-dun-environnement-virtuel" id="toc-guide-pratique-dutilisation-dun-environnement-virtuel" class="nav-link" data-scroll-target="#guide-pratique-dutilisation-dun-environnement-virtuel">Guide pratique d’utilisation d’un environnement virtuel</a>
  <ul class="collapse">
  <li><a href="#installation" id="toc-installation" class="nav-link" data-scroll-target="#installation">Installation</a></li>
  <li><a href="#créer-un-environnement" id="toc-créer-un-environnement" class="nav-link" data-scroll-target="#créer-un-environnement">Créer un environnement</a></li>
  <li><a href="#activer-un-environnement" id="toc-activer-un-environnement" class="nav-link" data-scroll-target="#activer-un-environnement">Activer un environnement</a></li>
  <li><a href="#lister-les-packages-installés" id="toc-lister-les-packages-installés" class="nav-link" data-scroll-target="#lister-les-packages-installés">Lister les packages installés</a></li>
  <li><a href="#installer-un-package" id="toc-installer-un-package" class="nav-link" data-scroll-target="#installer-un-package">Installer un package</a></li>
  <li><a href="#exporter-les-spécifications-de-lenvironnement" id="toc-exporter-les-spécifications-de-lenvironnement" class="nav-link" data-scroll-target="#exporter-les-spécifications-de-lenvironnement">Exporter les spécifications de l’environnement</a></li>
  <li><a href="#changer-denvironnement" id="toc-changer-denvironnement" class="nav-link" data-scroll-target="#changer-denvironnement">Changer d’environnement</a></li>
  <li><a href="#aide-mémoire" id="toc-aide-mémoire" class="nav-link" data-scroll-target="#aide-mémoire">Aide-mémoire</a></li>
  </ul></li>
  <li><a href="#limites" id="toc-limites" class="nav-link" data-scroll-target="#limites">Limites</a></li>
  </ul></li>
  <li><a href="#les-conteneurs" id="toc-les-conteneurs" class="nav-link" data-scroll-target="#les-conteneurs">Les conteneurs 🐋</a>
  <ul class="collapse">
  <li><a href="#introduction-1" id="toc-introduction-1" class="nav-link" data-scroll-target="#introduction-1">Introduction</a></li>
  <li><a href="#fonctionnement-1" id="toc-fonctionnement-1" class="nav-link" data-scroll-target="#fonctionnement-1">Fonctionnement</a></li>
  <li><a href="#docker-limplémentation-standard" id="toc-docker-limplémentation-standard" class="nav-link" data-scroll-target="#docker-limplémentation-standard"><code>Docker</code> <i class="fa-brands fa-docker" aria-label="docker"></i>, l’implémentation standard</a>
  <ul class="collapse">
  <li><a href="#installation-et-environnements-bacs-à-sable" id="toc-installation-et-environnements-bacs-à-sable" class="nav-link" data-scroll-target="#installation-et-environnements-bacs-à-sable">Installation et environnements bacs à sable</a></li>
  <li><a href="#principes" id="toc-principes" class="nav-link" data-scroll-target="#principes">Principes</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#docker-en-pratique-un-exemple" id="toc-docker-en-pratique-un-exemple" class="nav-link" data-scroll-target="#docker-en-pratique-un-exemple"><code>Docker</code> en pratique: un exemple</a>
  <ul class="collapse">
  <li><a href="#application" id="toc-application" class="nav-link" data-scroll-target="#application">Application</a></li>
  <li><a href="#dockerfile" id="toc-dockerfile" class="nav-link" data-scroll-target="#dockerfile">Le <code>Dockerfile</code></a></li>
  <li><a href="#build" id="toc-build" class="nav-link" data-scroll-target="#build">Construction d’une image Docker</a></li>
  <li><a href="#execution" id="toc-execution" class="nav-link" data-scroll-target="#execution">Exécuter (<em>run</em>) une image <code>Docker</code></a></li>
  <li><a href="#exp-docker" id="toc-exp-docker" class="nav-link" data-scroll-target="#exp-docker">Exporter une image <code>Docker</code></a></li>
  <li><a href="#imp-docker" id="toc-imp-docker" class="nav-link" data-scroll-target="#imp-docker">Importer une image <code>Docker</code></a></li>
  <li><a href="#aide-mémoire-1" id="toc-aide-mémoire-1" class="nav-link" data-scroll-target="#aide-mémoire-1">Aide-mémoire</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Portabilité</h1>
</div>

<div>
  <div class="description">
    <p>Présentation des principes et des techniques permettant de rendre un projet exécutable sur différents environnements.</p>
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<details>
<summary>
Dérouler les <em>slides</em> ci-dessous ou <a href="https://ensae-reproductibilite.github.io/slides/#/portabilité">cliquer ici</a> pour afficher les slides en plein écran.
</summary>
<div id="cb1" class="sourceCode">
<pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
<iframe class="sourceCode yaml code-with-copy" src="https://ensae-reproductibilite.github.io/slides/#/portabilité">
</iframe>
</div>
</details>
<section id="introduction-la-notion-de-portabilité" class="level1">
<h1>Introduction : la notion de portabilité</h1>
<p>Dans les chapitres précédents, nous avons vu un ensemble de bonnes pratiques qui permettent de considérablement améliorer la qualité d’un projet : rendre le code plus lisible, adopter une structure du projet normalisée et évolutive et versionner proprement son code sur un dépôt <code>GitHub</code> <i class="fa-brands fa-github" aria-label="github"></i>.</p>
<p>Une fois ces bonnes pratiques appliquées à notre projet, ce dernier apparaît largement partageable. Du moins en théorie, car la pratique est souvent plus compliquée : il y a fort à parier que si vous essayez d’exécuter votre projet sur un autre environnement d’exécution (un autre ordinateur, un serveur, etc.), les choses ne se passent pas du tout comme attendu. Cela signifie que qu’<strong>en l’état, le projet n’est pas <span class="colorized">portable</span> : il n’est pas possible, sans modifications coûteuses, de l’exécuter dans un environnement différent de celui dans lequel il a été développé</strong>.</p>
<p>La raison principale est qu’un code ne vit pas dans une bulle isolée, il contient en général de nombreuses adhérences, plus ou moins visibles, au langage et à l’environnement dans lesquels il a été développé :</p>
<ul>
<li>des <strong>dépendances <code>Python</code></strong> propres au langage du projet. C’est l’environnement des <em>packages</em> nécessaires à exécuter le code ;</li>
<li>des <strong>dépendances dans d’autres langages</strong> nécessaires au fonctionnement de certaines librairies <code>Python</code>. En effet, <code>Python</code> est un langage de haut niveau et certains <em>packages</em> nécessitent des librairies bas-niveau pour être efficaces. Par exemple, <code>NumPy</code> est écrit en <code>C</code> et nécessite donc un compilateur <code>C</code> et <code>Pytorch</code> a quant à lui besoin de <code>C++</code> ;</li>
<li>des <strong>dépendances à des librairies systèmes</strong> nécessaires pour installer certains <em>packages</em> qui ne seront pas les mêmes selon le système d’exploitation utilisé et certains paramètres matériels (par exemple, selon que Windows utilise une version 32 ou 64 bits). Par exemple, les librairies de manipulation ou de visualisation de données spatiales (<code>GeoPandas</code>, <code>Folium</code>) reposent sur des librairies systèmes <code>GDAL</code> qui sont propres à chaque système d’exploitation<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</li>
</ul>
<p>Le premier problème peut être géré relativement facilement en adoptant une structure de projet (<a href="../chapters/projects-architecture.html">chapitre précédent</a>) avec un fichier <code>requirements.txt</code> bien structuré et versionné. Les deux autres nécessitent en général des outils plus avancés.</p>
<p>Nous allons progresser dans la démarche de reproductibilité en visant un projet portable, c’est-à-dire qui peut être exécuté dans un environnement différent de celui dans lequel il a été développé. Nous allons avoir besoin de nouveaux outils qui seront, chacun, des avancées sur l’échelle de la reproductibilité:</p>
<ul>
<li>Les <a href="#virtualenv">environnements virtuels</a> ;</li>
<li>Les <a href="#conteneurs">conteneurs</a>.</li>
</ul>
<p>Ces outils vont nous permettre de <strong>normaliser l’environnement afin de produire un projet portable</strong>. Cette étape est primordiale lorsque l’on se préoccupe de la mise en production d’un projet, car elle assure une transition relativement indolore entre l’environnement de développement et celui de production.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://img.devrant.com/devrant/rant/r_174386_yx6zV.jpg" class="img-fluid figure-img"></p>
<figcaption>Image empruntée à <a href="https://devrant.com/rants/174386/when-i-say-but-it-works-on-my-machine">devrant.com</a></figcaption>
</figure>
</div>
<p>Le choix de la méthode à privilégier dépend d’un arbitrage temps-opportunité. Tous les projets n’ont pas vocation à être mis à disposition par le biais de conteneurs. Néanmoins, l’intérêt d’adopter une démarche de bonnes pratiques est que si le projet gagne en ambition et que la conteneurisation s’avère adéquate, celle-ci sera peu coûteuse à mettre en oeuvre.</p>
</section>
<section id="virtualenv" class="level1">
<h1>Les environnements virtuels <i class="fa-brands fa-python" aria-label="python"></i></h1>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Pour illustrer l’importance de travailler avec des environnements virtuels, mettons-nous à la place d’un.e aspirant.e <em>data scientist</em> qui commencerait ses premiers projets.</p>
<p>Selon toute vraisemblance, on va commencer par installer une distribution de <code>Python</code> — souvent, via <code>Anaconda</code> — sur son poste et commencer à développer, projet après projet. S’il est nécessaire d’installer une librairie supplémentaire, on le fera sans trop se poser de question. Puis, on passera au projet suivant en adoptant la même démarche. Et ainsi de suite.</p>
<p>Cette démarche naturelle présentera l’avantage de permettre d’aller vite dans les expérimentations. Néanmoins, elle deviendra problématique s’il devient nécessaire de partager son projet, ou de reprendre celui-ci dans le futur.</p>
<p>Dans cette approche, les différents <em>packages</em> qu’on va être amené à utiliser vont être installés au même endroit. Ceci peut apparaître secondaire, après tout nous utilisons <code>Python</code> pour sa simplicité d’usage qui ne nécessite pas de passer des heures à se poser des questions avant d’écrire la moindre ligne de code, mais cela va finir par nous poser plusieurs problèmes :</p>
<ul>
<li><strong>conflits de version</strong> : une application A peut dépendre de la version 1 d’un package là où une application B peut dépendre de la version 2 de ce même package. Ces versions d’un même package peuvent avoir des incompatibilités<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. Une seule application peut donc fonctionner dans cette configuration ;</li>
<li><strong>version de <code>Python</code> fixe</strong> — on ne peut avoir qu’une seule installation par système — là où on voudrait pouvoir avoir des versions différentes selon le projet ;</li>
<li><strong>reproductiblité limitée</strong> : difficile de dire quel projet repose sur tel package, dans la mesure où ceux-ci s’accumulent en un même endroit au fil des projets ;</li>
<li><strong>portabilité limitée</strong> : conséquence du point précédent, il est difficile de fixer dans un fichier les dépendances spécifiques à un projet, et exclusivement celles-ci.</li>
</ul>
<p>Les environnements virtuels constituent une solution à ces différents problèmes.</p>
</section>
<section id="fonctionnement" class="level2">
<h2 class="anchored" data-anchor-id="fonctionnement">Fonctionnement</h2>
<p>Le concept d’environnement virtuel est techniquement très simple. On peut lui donner la définition suivante pour <code>Python</code> :</p>
<blockquote class="blockquote">
<p><em>“dossier auto-suffisant qui contient une installation de <code>Python</code> pour une version particulière de <code>Python</code> ainsi que des <em>packages</em> additionnels et qui est isolé des autres environnements existants.”</em></p>
</blockquote>
<p>On peut donc simplement voir les environnements virtuels comme un moyen de faire cohabiter sur un même système différentes installations de <code>Python</code> avec chacune leur propre liste de packages installés et leurs versions. Développer dans des environnements virtuels vierges à chaque début de projet est une très bonne pratique pour accroître la reproductibilité des analyses.</p>
</section>
<section id="implémentations" class="level2">
<h2 class="anchored" data-anchor-id="implémentations">Implémentations</h2>
<p>Il existe différentes implémentations des environnements virtuels en <code>Python</code>, dont chacune ont leurs spécificités et leur communauté d’utilisateurs :</p>
<ul>
<li>L’implémentation standard en <code>Python</code> est <code>venv</code>.</li>
<li><code>conda</code> propose une implémentation plus complète.</li>
</ul>
<p>En pratique pour les utilisateurs, ces implémentations sont relativement proches. La différence conceptuelle majeure est que <code>conda</code> est à la fois un <em>package manager</em> (comme <code>pip</code>) et un gestionnaire d’environnements virtuels (comme <code>venv</code>).</p>
<p>Pendant longtemps, <code>conda</code> en tant que <em>package manager</em> s’est avéré très pratique en <em>data science</em>, dans la mesure où il gérait non seulement les dépendances <code>Python</code> mais aussi dans d’autres langages, comme des dépendances <code>C</code>, très utilisées par les principales librairies de <em>data science</em> et dont l’installation peut être complexe sur certains systèmes d’exploitation. Néanmoins, depuis quelques années, l’installation de <em>packages</em> par <code>pip</code> se fait de plus en plus par le biais de <a href="https://pythonwheels.com/"><em>wheels</em></a> qui sont des versions pré-compilées des librairies systèmes, propres à chaque configuration système.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Une différence conceptuelle entre <code>pip</code> et <code>conda</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>L’autre différence majeure avec <code>pip</code> est que <code>Conda</code> utilise une méthode plus avancée — et donc également plus coûteuse en temps — de résolution des dépendances.</p>
<p>En effet, différents packages peuvent spécifier différentes versions d’un même package dont ils dépendent tous les deux, ce qui provoque un conflit de version. <code>Conda</code> va par défaut appliquer un algorithme qui vise à gérer au mieux ces conflits, là où <code>pip</code> va choisir une approche plus minimaliste<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>.</p>
</div>
</div>
</div>
<p><code>pip+venv</code> présente l’avantage de la simplicité, <code>conda</code> de la fiabilité. Selon les projets, on privilégiera l’un ou l’autre. Néanmoins, si le projet est amené à fonctionner de manière isolée dans un conteneur, <code>venv</code> suffira amplement car l’isolation sera fournie par le conteneur comme nous le verrons ultérieurement.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
C’est différent en <i class="fa-brands fa-r-project" aria-label="r-project"></i> ?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>On lit souvent, notamment chez les <em>afficionados</em> de <i class="fa-brands fa-r-project" aria-label="r-project"></i> que la gestion des environnements en <code>Python</code> est chaotique. C’était vrai au début des années 2010 mais c’est quelques peu exagéré aujourd’hui.</p>
<p>La qualité supérieure des outils <i class="fa-brands fa-r-project" aria-label="r-project"></i> pour la gestion des dépendances ne saute pas aux yeux: <a href="https://rstudio.github.io/renv/articles/renv.html"><code>renv</code></a> est très intéressant mais <a href="https://rstudio.github.io/renv/articles/renv.html#caveats">ne permet pas de définir la version de <i class="fa-brands fa-r-project" aria-label="r-project"></i></a> :</p>
<blockquote class="blockquote">
<p>R version: renv tracks, but doesn’t help with, the version of R used with the packge. renv can’t easily help with this because it’s run inside of R, but you might find tools like rig helpful, as they make it easier to switch between multiple version of R on one computer.</p>
</blockquote>
<p>C’est, en fait, le problème principal des outils <i class="fa-brands fa-r-project" aria-label="r-project"></i> pour la reproductibilité. Pour les utiliser, il faut souvent se trouver dans une session <i class="fa-brands fa-r-project" aria-label="r-project"></i>, avec ses spécificités. Les outils <i class="fa-brands fa-python" aria-label="python"></i> qui s’utilisent pas le biais de la ligne de commande offrent une robustesse plus importante. <code>venv</code> est certes dépendant de la version de <i class="fa-brands fa-python" aria-label="python"></i> utilisée lors de la création de l’environnement mais le fait de passer par le terminal permet de choisir la version de <i class="fa-brands fa-python" aria-label="python"></i> qui servira à créer l’environnement. Quant à <code>conda</code>, la version de <i class="fa-brands fa-python" aria-label="python"></i> est définie dans le <code>environment.yml</code> ce qui donne une grande liberté.</p>
</div>
</div>
</div>
<p>Puisqu’il n’y a pas de raison absolue d’imposer <code>pip+venv</code> ou <code>conda</code>, nous recommandons le pragmatisme. Personnellement, nous utilisons plutôt <code>venv</code> car nous travaillons principalement dans des microservices basés sur des conteneurs et non sur des postes personnels, ce qui est l’approche moderne dans le monde de la <em>data science</em>. Nous présentons néanmoins les deux approches par la suite. L’<a href="../chapters/application.html">application fil rouge</a> propose les deux approches, à vous de choisir celle que vous désirez privilégier.</p>
</section>
<section id="guide-pratique-dutilisation-dun-environnement-virtuel" class="level2">
<h2 class="anchored" data-anchor-id="guide-pratique-dutilisation-dun-environnement-virtuel">Guide pratique d’utilisation d’un environnement virtuel</h2>
<section id="installation" class="level3">
<h3 class="anchored" data-anchor-id="installation">Installation</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true"><code>venv</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false"><code>conda</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p><code>venv</code> est un module inclus par défaut dans <code>Python</code>, ce qui le rend facilement accessible pour la gestion d’environnements virtuels.</p>
<p>Les instructions pour utiliser <code>venv</code>, l’outil de création d’environnements virtuels intégré à Python, sont détaillées dans la <a href="https://docs.python.org/fr/3/library/venv.html">documentation officielle de Python</a>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.dataquest.io/wp-content/uploads/2022/01/python-virtual-envs1-1024x576.webp" class="img-fluid figure-img"></p>
<figcaption>Illustration du principe (Source: <a href="https://www.dataquest.io/blog/a-complete-guide-to-python-virtual-environments/">dataquest</a>)</figcaption>
</figure>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>Les instructions à suivre pour installer <code>conda</code> sont détaillées dans la <a href="https://docs.conda.io/projects/conda/en/latest/user-guide/install/index.html">documentation officielle</a>. <code>conda</code> seul étant peu utile en pratique, il est généralement installé dans le cadre de distributions. Les deux plus populaires sont :</p>
<ul>
<li><code>Miniconda</code> : une distribution minimaliste contenant <code>conda</code>, <code>Python</code> ainsi qu’un petit nombre de packages techniques très utiles ;</li>
<li><code>Anaconda</code> : une distribution assez volumineuse contenant <code>conda</code>, <code>Python</code>, d’autres logiciels (<code>R</code>, <code>Spyder</code>, etc.) ainsi qu’un ensemble de packages utiles pour la <em>data science</em> (<code>SciPy</code>, <code>NumPy</code>, etc.).</li>
</ul>
<p><img src="../conda-eco.png" class="img-fluid"></p>
<p>Le choix de la distribution importe assez peu en pratique, dans la mesure où nous allons de toute manière utiliser des environnements virtuels vierges pour développer nos projets.</p>
</div>
</div>
</div>
</section>
<section id="créer-un-environnement" class="level3">
<h3 class="anchored" data-anchor-id="créer-un-environnement">Créer un environnement</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true"><code>venv</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false"><code>conda</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>Pour commencer à utiliser <code>venv</code>, commençons par créer un environnement vierge, nommé <code>dev</code>. Pour créer un environnement virtuel, cela se fait en ligne de commande par le biais de <code>Python</code>. Cela signifie que la version de <code>Python</code> utilisée par cet environnement sera celle utilisée lors de la création de celui-ci.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="annotated-cell-20" data-filename="terminal" data-code-line-numbers=""><pre class="sourceCode bash code-annotation-code code-with-copy code-annotated"><code class="sourceCode bash"><a class="code-annotation-anchor" data-target-cell="annotated-cell-20" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-20-1" class="code-annotation-target"><a href="#annotated-cell-20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> python <span class="at">-m</span> venv dev</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-20" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-20" data-code-lines="1" data-code-annotation="1">Sur un système <code>Windows</code>, ce sera <code>python.exe -m venv dev</code></span>
</dd>
</dl>
<p>Cette commande crée un dossier nommé <code>dev/</code> contenant une installation Python isolée.</p>
<details>
<summary>
Exemple sur un système <code>Linux</code>
</summary>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../venv_local.png" class="img-fluid figure-img"></p>
<figcaption>Exemple sur un système <code>Linux</code></figcaption>
</figure>
</div>
</details>
<p>Celle-ci est de la version de <code>Python</code> enregistrée par défaut dans le <code>PATH</code>, en l’occurrence <code>Python 3.11</code>. Pour créer un environnement virtuel avec une autre version de <code>Python</code>, il faudra définir le chemin de manière formelle, par exemple:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="annotated-cell-21" data-filename="terminal" data-code-line-numbers=""><pre class="sourceCode bash code-annotation-code code-with-copy"><code class="sourceCode bash"><span id="annotated-cell-21-1"><a href="#annotated-cell-21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> /chemin_local/python3.8 <span class="at">-m</span> venv dev-old</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>Pour commencer à utiliser <code>conda</code>, commençons par créer un environnement vierge, nommé <code>dev</code>, en spécifiant la version de Python que l’on souhaite installer pour notre projet.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb1" data-filename="terminal" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> conda create <span class="at">-n</span> dev python=3.9.7</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb2" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>Retrieving notices: ...working... done</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>Channels:</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a> <span class="op">-</span> conda<span class="op">-</span>forge</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>Platform: linux<span class="op">-</span><span class="dv">64</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>Collecting package metadata (repodata.json): done</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>Solving environment: done</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">## Package Plan ##</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  environment location: <span class="op">/</span>opt<span class="op">/</span>mamba<span class="op">/</span>envs<span class="op">/</span>dev</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  added <span class="op">/</span> updated specs:</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span> python<span class="op">=</span><span class="fl">3.9.7</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>The following packages will be downloaded:</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>The following NEW packages will be INSTALLED:</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>Proceed ([y]<span class="op">/</span>n)? y</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>Downloading <span class="kw">and</span> Extracting Packages</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Comme indiqué dans les <em>logs</em>, <code>Conda</code> a créé notre environnement et nous indique son emplacement sur le <em>filesystem</em>. En réalité, l’environnement n’est jamais vraiment vierge : <code>Conda</code> nous demande — et il faut répondre oui en tapant <code>y</code> — d’installer un certain nombre de packages, qui sont ceux qui viennent avec la distribution <code>Miniconda</code>.</p>
<p>On peut vérifier que l’environnement a bien été créé en listant les environnements installés sur le système.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb3" data-filename="terminal" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> conda info <span class="at">--envs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb4" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># conda environments:                                                                                                                             </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#                                                                                                                                                 </span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>base                  <span class="op">*</span>  <span class="op">/</span>opt<span class="op">/</span>mamba                                                                                                               </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>dev                      <span class="op">/</span>opt<span class="op">/</span>mamba<span class="op">/</span>envs<span class="op">/</span>dev</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="activer-un-environnement" class="level3">
<h3 class="anchored" data-anchor-id="activer-un-environnement">Activer un environnement</h3>
<p>Comme plusieurs environnements peuvent coexister sur un même système, il faut dire à notre gestionnaire d’environnement d’activer celui-ci. Dès lors, ce sera celui-ci qui sera utilisé implicitement lorsqu’on utilisera <code>python</code>, <code>pip</code>, etc. dans la ligne de commande active<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true"><code>venv</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false"><code>conda</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb5" data-filename="terminal" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> source dev/bin/activate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>venv</code> active l’environnement virtuel <code>dev</code>, indiqué par le changement du nom de l’environnement qui apparaît au début de la ligne de commande dans le terminal. Une fois activé, <code>dev</code> devient temporairement notre environnement par défaut pour les opérations <code>Python</code>. Pour confirmer cela, nous pouvons utiliser la commande <code>which</code> pour déterminer l’emplacement de l’interpréteur Python qui sera utilisé pour exécuter des scripts comme <code>python mon-script.py</code>.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb6" data-filename="terminal" data-env="dev" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">dev</span><span class="kw">)</span> <span class="ex">$</span> which python</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb7" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="op">/</span>home<span class="op">/</span>onyxia<span class="op">/</span>work<span class="op">/</span>dev<span class="op">/</span><span class="bu">bin</span><span class="op">/</span>python</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb8" data-filename="terminal" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> conda activate dev</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>Conda</code> nous indique que l’on travaille à partir de maintenant dans l’environnement <code>dev</code> en indiquant son nom entre parenthèses au début de la ligne de commandes. Autrement dit, <code>dev</code> devient pour un temps notre environnement par défaut. Pour s’en assurer, vérifions avec la commande <code>which</code> l’emplacement de l’interpréteur Python qui sera utilisé si on lance une commande du type <code>python mon-script.py</code>.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb9" data-filename="terminal" data-env="dev" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">dev</span><span class="kw">)</span> <span class="ex">$</span> which python </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb10" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="op">/</span>opt<span class="op">/</span>mamba<span class="op">/</span>envs<span class="op">/</span>dev<span class="op">/</span><span class="bu">bin</span><span class="op">/</span>python</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>On travaille bien dans l’environnement attendu : l’interpréteur qui se lance n’est pas celui du système global, mais bien celui spécifique à notre environnement virtuel.</p>
</section>
<section id="lister-les-packages-installés" class="level3">
<h3 class="anchored" data-anchor-id="lister-les-packages-installés">Lister les packages installés</h3>
<p>Une fois l’environnement activé, on peut lister les packages installés et leur version. Cela confirme qu’un certain nombre de packages sont installés par défaut lors de la création d’un environnement virtuel.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true"><code>venv</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false"><code>conda</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<p>On part d’un environnement vraiment réduit à l’os:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb11" data-filename="terminal" data-env="dev" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">dev</span><span class="kw">)</span> <span class="ex">$</span> pip list</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb12" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>Package    Version</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="op">----------</span> <span class="op">-------</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>pip        <span class="fl">23.3.2</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>setuptools <span class="fl">69.0.3</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>wheel      <span class="fl">0.42.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<p>L’environnement est assez minimaliste, quoique plus garni que lors de la création d’un environnement virtuel par <code>venv</code></p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb13" data-filename="terminal" data-env="dev" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">dev</span><span class="kw">)</span> <span class="ex">$</span> conda list</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb14" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># packages in environment at /opt/mamba/envs/dev:</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Name                    Version                   Build  Channel</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>_libgcc_mutex             <span class="fl">0.1</span>                 conda_forge    conda<span class="op">-</span>forge</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>_openmp_mutex             <span class="fl">4.5</span>                       <span class="dv">2</span><span class="er">_gnu</span>    conda<span class="op">-</span>forge</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>ca<span class="op">-</span>certificates           <span class="fl">2023.11.17</span>           hbcca054_0    conda<span class="op">-</span>forge</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Pour se convaincre, on peut vérifier que <code>Numpy</code> est bien absent de notre environnement:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb15" data-filename="terminal" data-env="dev" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">dev</span><span class="kw">)</span> <span class="ex">$</span> python <span class="at">-c</span> <span class="st">"import numpy as np"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb16" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>Traceback (most recent call last):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  File <span class="st">"&lt;string&gt;"</span>, line <span class="dv">1</span>, <span class="kw">in</span> <span class="op">&lt;</span>module<span class="op">&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="pp">ModuleNotFoundError</span>: No module named <span class="st">'numpy'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="installer-un-package" class="level3">
<h3 class="anchored" data-anchor-id="installer-un-package">Installer un package</h3>
<p>Notre environnement peut être enrichi, lorsque nécessaire, avec l’installation d’un <em>package</em> par le biais de la ligne de commande. La procédure est très similaire entre <code>pip</code> (pour les environnements <code>venv</code>) et <code>conda</code>.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Mélanger <code>pip</code> et <code>conda</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Il est techniquement possible d’installer des <em>packages</em> par le biais de <code>pip</code> en étant situé dans un environnement virtuel <code>conda</code><a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>. Ce n’est pas un problème pour de l’expérimentation et ça permet de développer rapidement.</p>
<p>Néanmoins, dans un environnement de production c’est une <a href="https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#using-pip-in-an-environment">pratique à éviter</a>.</p>
<ul>
<li>Soit on initialise un environnement <code>conda</code> autosuffisant avec un <code>env.yml</code> (voir plus bas) ;</li>
<li>Soit on crée un environnement <code>venv</code> et on fait exclusivement des <code>pip install</code>.</li>
</ul>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true"><code>venv</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false"><code>conda</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb17" data-filename="terminal" data-env="dev" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">dev</span><span class="kw">)</span> <span class="ex">$</span> pip install nom_du_package</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb18" data-filename="terminal" data-env="dev" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">dev</span><span class="kw">)</span> <span class="ex">$</span> conda install nom_du_package</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>La différence est que là où <code>pip install</code> va installer un package à partir du répertoire <a href="https://pypi.org/">PyPI</a>, <code>conda install</code> va chercher le package sur les répertoires maintenus par les développeurs de Conda<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>.</p>
<p>Installons par exemple le package phare de <em>machine learning</em> <code>scikit-learn</code>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true"><code>venv</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false"><code>conda</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb19" data-filename="terminal" data-env="dev" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">dev</span><span class="kw">)</span> <span class="ex">$</span> conda install scikit-learn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb20" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>pip install scikit<span class="op">-</span>learn</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>Collecting scikit<span class="op">-</span>learn</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  Obtaining dependency information <span class="cf">for</span> scikit<span class="op">-</span>learn <span class="im">from</span> https:<span class="op">//</span>files.pythonhosted.org<span class="op">/</span>packages<span class="op">/</span><span class="dv">5</span><span class="er">b</span><span class="op">/</span>be<span class="op">/</span><span class="dv">208</span><span class="er">f17ce87a5e55094b0e8ffd55b06919ab9b56e7e4ce2a64cd9095ec5d2</span><span class="op">/</span>scikit_learn<span class="op">-</span><span class="fl">1.4.0</span><span class="op">-</span><span class="dv">1</span><span class="op">-</span>cp311<span class="op">-</span>cp311<span class="op">-</span>manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  Downloading scikit_learn<span class="op">-</span><span class="fl">1.4.0</span><span class="op">-</span><span class="dv">1</span><span class="op">-</span>cp311<span class="op">-</span>cp311<span class="op">-</span>manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (<span class="dv">11</span> kB)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>Collecting numpy<span class="op">&lt;</span><span class="fl">2.0</span>,<span class="op">&gt;=</span><span class="fl">1.19.5</span> (<span class="im">from</span> scikit<span class="op">-</span>learn)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  Obtaining dependency information <span class="cf">for</span> numpy<span class="op">&lt;</span><span class="fl">2.0</span>,<span class="op">&gt;=</span><span class="fl">1.19.5</span> <span class="im">from</span> https:<span class="op">//</span>files.pythonhosted.org<span class="op">/</span>packages<span class="op">/</span><span class="dv">5</span><span class="er">a</span><span class="op">/</span><span class="dv">62</span><span class="op">/</span><span class="dv">00</span><span class="er">7b63f916aca1d27f5fede933fda3315d931</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Les dépendances nécessaires (par exemple <code>Numpy</code> sont automatiquement installées). L’environnement s’enrichit donc:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb21" data-filename="terminal" data-env="dev" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">dev</span><span class="kw">)</span> <span class="ex">$</span> pip list</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb22" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>Package       Version</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="op">-------------</span> <span class="op">-------</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>joblib        <span class="fl">1.3.2</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>numpy         <span class="fl">1.26.3</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>pip           <span class="fl">23.2.1</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>scikit<span class="op">-</span>learn  <span class="fl">1.4.0</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>scipy         <span class="fl">1.12.0</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>setuptools    <span class="fl">65.5.0</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>threadpoolctl <span class="fl">3.2.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb23" data-filename="terminal" data-env="dev" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">dev</span><span class="kw">)</span> <span class="ex">$</span> conda install scikit-learn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<details>
<summary>
Voir la sortie
</summary>
<div class="sourceCode" id="cb24" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>Channels:</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a> <span class="op">-</span> conda<span class="op">-</span>forge</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>Platform: linux<span class="op">-</span><span class="dv">64</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>Collecting package metadata (repodata.json): done</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>Solving environment: done</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co">## Package Plan ##</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  environment location: <span class="op">/</span>opt<span class="op">/</span>mamba<span class="op">/</span>envs<span class="op">/</span>dev</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  added <span class="op">/</span> updated specs:</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span> scikit<span class="op">-</span>learn</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>The following packages will be downloaded:</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    package                    <span class="op">|</span>            build</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">---------------------------|-----------------</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    joblib<span class="op">-</span><span class="fl">1.3.2</span>               <span class="op">|</span>     pyhd8ed1ab_0         <span class="dv">216</span> KB  conda<span class="op">-</span>forge</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    libblas<span class="op">-</span><span class="fl">3.9.0</span>              <span class="op">|</span><span class="dv">21</span><span class="er">_linux64_openblas</span>          <span class="dv">14</span> KB  conda<span class="op">-</span>forge</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    libcblas<span class="op">-</span><span class="fl">3.9.0</span>             <span class="op">|</span><span class="dv">21</span><span class="er">_linux64_openblas</span>          <span class="dv">14</span> KB  conda<span class="op">-</span>forge</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    libgfortran<span class="op">-</span>ng<span class="op">-</span><span class="fl">13.2.0</span>      <span class="op">|</span>       h69a702a_3          <span class="dv">23</span> KB  conda<span class="op">-</span>forge</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    libgfortran5<span class="op">-</span><span class="fl">13.2.0</span>        <span class="op">|</span>       ha4646dd_3         <span class="fl">1.4</span> MB  conda<span class="op">-</span>forge</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>    liblapack<span class="op">-</span><span class="fl">3.9.0</span>            <span class="op">|</span><span class="dv">21</span><span class="er">_linux64_openblas</span>          <span class="dv">14</span> KB  conda<span class="op">-</span>forge</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>    libopenblas<span class="op">-</span><span class="fl">0.3.26</span>         <span class="op">|</span>pthreads_h413a1c8_0         <span class="fl">5.3</span> MB  conda<span class="op">-</span>forge</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>    libstdcxx<span class="op">-</span>ng<span class="op">-</span><span class="fl">13.2.0</span>        <span class="op">|</span>       h7e041cc_3         <span class="fl">3.7</span> MB  conda<span class="op">-</span>forge</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>    numpy<span class="op">-</span><span class="fl">1.26.3</span>               <span class="op">|</span>   py39h474f0d3_0         <span class="fl">6.6</span> MB  conda<span class="op">-</span>forge</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>    python_abi<span class="op">-</span><span class="fl">3.9</span>             <span class="op">|</span>           <span class="dv">4</span><span class="er">_cp39</span>           <span class="dv">6</span> KB  conda<span class="op">-</span>forge</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>    scikit<span class="op">-</span>learn<span class="op">-</span><span class="fl">1.4.0</span>         <span class="op">|</span>   py39ha22ef79_0         <span class="fl">8.7</span> MB  conda<span class="op">-</span>forge</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>    scipy<span class="op">-</span><span class="fl">1.12.0</span>               <span class="op">|</span>   py39h474f0d3_2        <span class="fl">15.6</span> MB  conda<span class="op">-</span>forge</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>    threadpoolctl<span class="op">-</span><span class="fl">3.2.0</span>        <span class="op">|</span>     pyha21a80b_0          <span class="dv">20</span> KB  conda<span class="op">-</span>forge</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">------------------------------------------------------------</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>                                           Total:        <span class="fl">41.6</span> MB</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>The following NEW packages will be INSTALLED:</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>  joblib             conda<span class="op">-</span>forge<span class="op">/</span>noarch::joblib<span class="op">-</span><span class="fl">1.3.2</span><span class="op">-</span>pyhd8ed1ab_0 </span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>  libblas            conda<span class="op">-</span>forge<span class="op">/</span>linux<span class="op">-</span><span class="dv">64</span>::libblas<span class="op">-</span><span class="fl">3.9.0</span><span class="op">-</span><span class="dv">21</span><span class="er">_linux64_openblas</span> </span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>  libcblas           conda<span class="op">-</span>forge<span class="op">/</span>linux<span class="op">-</span><span class="dv">64</span>::libcblas<span class="op">-</span><span class="fl">3.9.0</span><span class="op">-</span><span class="dv">21</span><span class="er">_linux64_openblas</span> </span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>  libgfortran<span class="op">-</span>ng     conda<span class="op">-</span>forge<span class="op">/</span>linux<span class="op">-</span><span class="dv">64</span>::libgfortran<span class="op">-</span>ng<span class="op">-</span><span class="fl">13.2.0</span><span class="op">-</span>h69a702a_3 </span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>  libgfortran5       conda<span class="op">-</span>forge<span class="op">/</span>linux<span class="op">-</span><span class="dv">64</span>::libgfortran5<span class="op">-</span><span class="fl">13.2.0</span><span class="op">-</span>ha4646dd_3 </span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>  liblapack          conda<span class="op">-</span>forge<span class="op">/</span>linux<span class="op">-</span><span class="dv">64</span>::liblapack<span class="op">-</span><span class="fl">3.9.0</span><span class="op">-</span><span class="dv">21</span><span class="er">_linux64_openblas</span> </span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>  libopenblas        conda<span class="op">-</span>forge<span class="op">/</span>linux<span class="op">-</span><span class="dv">64</span>::libopenblas<span class="op">-</span><span class="fl">0.3.26</span><span class="op">-</span>pthreads_h413a1c8_0 </span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>  libstdcxx<span class="op">-</span>ng       conda<span class="op">-</span>forge<span class="op">/</span>linux<span class="op">-</span><span class="dv">64</span>::libstdcxx<span class="op">-</span>ng<span class="op">-</span><span class="fl">13.2.0</span><span class="op">-</span>h7e041cc_3 </span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>  numpy              conda<span class="op">-</span>forge<span class="op">/</span>linux<span class="op">-</span><span class="dv">64</span>::numpy<span class="op">-</span><span class="fl">1.26.3</span><span class="op">-</span>py39h474f0d3_0 </span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>  python_abi         conda<span class="op">-</span>forge<span class="op">/</span>linux<span class="op">-</span><span class="dv">64</span>::python_abi<span class="op">-</span><span class="fl">3.9</span><span class="op">-</span><span class="dv">4</span><span class="er">_cp39</span> </span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>  scikit<span class="op">-</span>learn       conda<span class="op">-</span>forge<span class="op">/</span>linux<span class="op">-</span><span class="dv">64</span>::scikit<span class="op">-</span>learn<span class="op">-</span><span class="fl">1.4.0</span><span class="op">-</span>py39ha22ef79_0 </span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>  scipy              conda<span class="op">-</span>forge<span class="op">/</span>linux<span class="op">-</span><span class="dv">64</span>::scipy<span class="op">-</span><span class="fl">1.12.0</span><span class="op">-</span>py39h474f0d3_2 </span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>  threadpoolctl      conda<span class="op">-</span>forge<span class="op">/</span>noarch::threadpoolctl<span class="op">-</span><span class="fl">3.2.0</span><span class="op">-</span>pyha21a80b_0 </span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>Downloading <span class="kw">and</span> Extracting Packages:</span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>                                                                                                                                                  </span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a>Preparing transaction: done                                                                                                                       </span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a>Verifying transaction: done                                                                                                                       </span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a>Executing transaction: done </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p>Là encore, <code>conda</code> nous demande d’installer d’autres packages, qui sont des dépendances de <code>scikit-learn</code>. Par exemple, la librairie de calcul scientifique <code>NumPy</code>.</p>
<div class="sourceCode" id="cb25" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>(dev) $ conda <span class="bu">list</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre data-code-line-numbers=""><code># packages in environment at /opt/mamba/envs/dev:
#
# Name                    Version                   Build  Channel
_libgcc_mutex             0.1                 conda_forge    conda-forge
_openmp_mutex             4.5                       2_gnu    conda-forge
ca-certificates           2023.11.17           hbcca054_0    conda-forge
joblib                    1.3.2              pyhd8ed1ab_0    conda-forge
ld_impl_linux-64          2.40                 h41732ed_0    conda-forge
libblas                   3.9.0           21_linux64_openblas    conda-forge
libcblas                  3.9.0           21_linux64_openblas    conda-forge
libffi                    3.4.2                h7f98852_5    conda-forge
libgcc-ng                 13.2.0               h807b86a_3    conda-forge
libgfortran-ng            13.2.0               h69a702a_3    conda-forge
libgfortran5              13.2.0               ha4646dd_3    conda-forge
libgomp                   13.2.0               h807b86a_3    conda-forge
liblapack                 3.9.0           21_linux64_openblas    conda-forge
libopenblas               0.3.26          pthreads_h413a1c8_0    conda-forge
libsqlite                 3.44.2               h2797004_0    conda-forge
libstdcxx-ng              13.2.0               h7e041cc_3    conda-forge
libzlib                   1.2.13               hd590300_5    conda-forge
ncurses                   6.4                  h59595ed_2    conda-forge
numpy                     1.26.3           py39h474f0d3_0    conda-forge
openssl                   3.2.0                hd590300_1    conda-forge
pip                       23.3.2             pyhd8ed1ab_0    conda-forge
python                    3.9.7           hf930737_3_cpython    conda-forge
python_abi                3.9                      4_cp39    conda-forge
readline                  8.2                  h8228510_1    conda-forge
scikit-learn              1.4.0            py39ha22ef79_0    conda-forge
scipy                     1.12.0           py39h474f0d3_2    conda-forge
setuptools                69.0.3             pyhd8ed1ab_0    conda-forge
sqlite                    3.44.2               h2c6b66d_0    conda-forge
threadpoolctl             3.2.0              pyha21a80b_0    conda-forge
tk                        8.6.13          noxft_h4845f30_101    conda-forge
tzdata                    2023d                h0c530f3_0    conda-forge
wheel                     0.42.0             pyhd8ed1ab_0    conda-forge
xz                        5.2.6                h166bdaf_0    conda-forge
zlib                      1.2.13               hd590300_5    conda-forge</code></pre>
</div>
</div>
</div>
</section>
<section id="exporter-les-spécifications-de-lenvironnement" class="level3">
<h3 class="anchored" data-anchor-id="exporter-les-spécifications-de-lenvironnement">Exporter les spécifications de l’environnement</h3>
<p>Développer à partir d’un environnement vierge est une bonne pratique de reproductibilité : en partant d’une base minimale, on s’assure que seuls les packages effectivement nécessaires au bon fonctionnement de notre application ont été installés au fur et à mesure du projet.</p>
<p>Cela rend également notre projet plus aisé à rendre portable. On peut exporter les spécifications de l’environnement dans un fichier spécial qui peut permettre de créer un nouvel environnement similaire à celui ayant servi initialement.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true"><code>venv</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false"><code>conda</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb27" data-filename="terminal" data-env="dev" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">dev</span><span class="kw">)</span> <span class="ex">$</span> pip freeze <span class="op">&gt;</span> requirements.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<details>
<summary>
Voir le fichier <code>requirements.txt</code> généré
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>requirements.txt</strong></pre>
</div>
<div class="sourceCode" id="cb28" data-filename="requirements.txt" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>joblib<span class="op">==</span><span class="fl">1.3.2</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>numpy<span class="op">==</span><span class="fl">1.26.3</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>scikit<span class="op">-</span>learn<span class="op">==</span><span class="fl">1.4.0</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>scipy<span class="op">==</span><span class="fl">1.12.0</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>threadpoolctl<span class="op">==</span><span class="fl">3.2.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb29" data-filename="terminal" data-env="dev" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">dev</span><span class="kw">)</span> <span class="ex">$</span> conda env export <span class="op">&gt;</span> environment.yml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<details>
<summary>
Voir le fichier <code>environment.yml</code> généré
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>environment.yml</strong></pre>
</div>
<div class="sourceCode" id="cb30" data-filename="environment.yml" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>name: dev</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>channels:</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> conda<span class="op">-</span>forge</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>dependencies:</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> _libgcc_mutex<span class="op">=</span><span class="fl">0.1</span><span class="op">=</span>conda_forge</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> _openmp_mutex<span class="op">=</span><span class="fl">4.5</span><span class="op">=</span><span class="dv">2</span><span class="er">_gnu</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> ca<span class="op">-</span>certificates<span class="op">=</span><span class="fl">2023.11.17</span><span class="op">=</span>hbcca054_0</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> joblib<span class="op">=</span><span class="fl">1.3.2</span><span class="op">=</span>pyhd8ed1ab_0</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> ld_impl_linux<span class="op">-</span><span class="dv">64</span><span class="op">=</span><span class="fl">2.40</span><span class="op">=</span>h41732ed_0</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> libblas<span class="op">=</span><span class="fl">3.9.0</span><span class="op">=</span><span class="dv">21</span><span class="er">_linux64_openblas</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> libcblas<span class="op">=</span><span class="fl">3.9.0</span><span class="op">=</span><span class="dv">21</span><span class="er">_linux64_openblas</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> libffi<span class="op">=</span><span class="fl">3.4.2</span><span class="op">=</span>h7f98852_5</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> libgcc<span class="op">-</span>ng<span class="op">=</span><span class="fl">13.2.0</span><span class="op">=</span>h807b86a_3</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> libgfortran<span class="op">-</span>ng<span class="op">=</span><span class="fl">13.2.0</span><span class="op">=</span>h69a702a_3</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> libgfortran5<span class="op">=</span><span class="fl">13.2.0</span><span class="op">=</span>ha4646dd_3</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> libgomp<span class="op">=</span><span class="fl">13.2.0</span><span class="op">=</span>h807b86a_3</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> liblapack<span class="op">=</span><span class="fl">3.9.0</span><span class="op">=</span><span class="dv">21</span><span class="er">_linux64_openblas</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> libopenblas<span class="op">=</span><span class="fl">0.3.26</span><span class="op">=</span>pthreads_h413a1c8_0</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> libsqlite<span class="op">=</span><span class="fl">3.44.2</span><span class="op">=</span>h2797004_0</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> libstdcxx<span class="op">-</span>ng<span class="op">=</span><span class="fl">13.2.0</span><span class="op">=</span>h7e041cc_3</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> libzlib<span class="op">=</span><span class="fl">1.2.13</span><span class="op">=</span>hd590300_5</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> ncurses<span class="op">=</span><span class="fl">6.4</span><span class="op">=</span>h59595ed_2</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> numpy<span class="op">=</span><span class="fl">1.26.3</span><span class="op">=</span>py39h474f0d3_0</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> openssl<span class="op">=</span><span class="fl">3.2.0</span><span class="op">=</span>hd590300_1</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> pip<span class="op">=</span><span class="fl">23.3.2</span><span class="op">=</span>pyhd8ed1ab_0</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> python<span class="op">=</span><span class="fl">3.9.7</span><span class="op">=</span>hf930737_3_cpython</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> python_abi<span class="op">=</span><span class="fl">3.9</span><span class="op">=</span><span class="dv">4</span><span class="er">_cp39</span></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> readline<span class="op">=</span><span class="fl">8.2</span><span class="op">=</span>h8228510_1</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> scikit<span class="op">-</span>learn<span class="op">=</span><span class="fl">1.4.0</span><span class="op">=</span>py39ha22ef79_0</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> scipy<span class="op">=</span><span class="fl">1.12.0</span><span class="op">=</span>py39h474f0d3_2</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> setuptools<span class="op">=</span><span class="fl">69.0.3</span><span class="op">=</span>pyhd8ed1ab_0</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> sqlite<span class="op">=</span><span class="fl">3.44.2</span><span class="op">=</span>h2c6b66d_0</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> threadpoolctl<span class="op">=</span><span class="fl">3.2.0</span><span class="op">=</span>pyha21a80b_0</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> tk<span class="op">=</span><span class="fl">8.6.13</span><span class="op">=</span>noxft_h4845f30_101</span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> tzdata<span class="op">=</span><span class="dv">2023</span><span class="er">d</span><span class="op">=</span>h0c530f3_0</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> wheel<span class="op">=</span><span class="fl">0.42.0</span><span class="op">=</span>pyhd8ed1ab_0</span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> xz<span class="op">=</span><span class="fl">5.2.6</span><span class="op">=</span>h166bdaf_0</span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> zlib<span class="op">=</span><span class="fl">1.2.13</span><span class="op">=</span>hd590300_5</span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>prefix: <span class="op">/</span>opt<span class="op">/</span>mamba<span class="op">/</span>envs<span class="op">/</span>dev</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
</div>
</div>
<p>Ce fichier est mis par convention à la racine du dépôt <code>Git</code> du projet. Ainsi, les personnes souhaitant tester l’application peuvent recréer le même environnement Conda que celui qui a servi au développement via la commande suivante.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true"><code>venv</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false"><code>conda</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<p>On refait la démarche précédente de création d’un environnement vierge puis un <code>pip install -r requirements.txt</code></p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb31" data-filename="terminal" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> python <span class="at">-m</span> venv newenv</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> source newenv/bin/activate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb32" data-filename="terminal" data-env="newenv" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">newenv</span><span class="kw">)</span> <span class="ex">$</span> pip install <span class="at">-r</span> requirements.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<p>Cela se fait en une seule commande:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb33" data-filename="terminal" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> $ conda env create <span class="at">-f</span> environment.yml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="changer-denvironnement" class="level3">
<h3 class="anchored" data-anchor-id="changer-denvironnement">Changer d’environnement</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true"><code>venv</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false"><code>conda</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<p>Pour changer d’environnement virtuel, il suffit d’en activer un autre.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb34" data-filename="terminal" data-no-prefix="true" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">myenv</span><span class="kw">)</span> <span class="ex">$</span> deactivate</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> source anotherenv/bin/activate</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">anotherenv</span><span class="kw">)</span> <span class="ex">$</span> which python</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="ex">/chemin/vers/anotherenv/bin/python</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pour quitter l’environnement virtuel actif, on utilise simplement la commande <code>deactivate</code> :</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb35" data-filename="terminal" data-no-prefix="true" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">anotherenv</span><span class="kw">)</span> <span class="ex">$</span> deactivate</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<p>Pour changer d’environnement, il suffit d’en activer un autre.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb36" data-filename="terminal" data-no-prefix="true" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">dev</span><span class="kw">)</span> <span class="ex">$</span> conda activate base</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">base</span><span class="kw">)</span> <span class="ex">$</span> which python</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="ex">/opt/mamba/bin/python</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pour sortir de tout environnement conda, on utilise la commande <code>conda deactivate</code> :</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb37" data-filename="terminal" data-no-prefix="true" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">base</span><span class="kw">)</span> <span class="ex">$</span> conda deactivate</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="aide-mémoire" class="level3">
<h3 class="anchored" data-anchor-id="aide-mémoire">Aide-mémoire</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 23%">
<col style="width: 38%">
<col style="width: 38%">
</colgroup>
<thead>
<tr class="header">
<th><code>venv</code></th>
<th><code>conda</code></th>
<th>Principe</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>python -m venv &lt;env_name&gt;</code></td>
<td><code>conda create -n &lt;env_name&gt; python=&lt;python_version&gt;</code></td>
<td>Création d’un environnement nommé <code>&lt;env_name&gt;</code> dont la version de Python est <code>&lt;python_version&gt;</code></td>
</tr>
<tr class="even">
<td></td>
<td><code>conda info --envs</code></td>
<td>Lister les environnements</td>
</tr>
<tr class="odd">
<td><code>source &lt;env_name&gt;/bin/activate</code></td>
<td><code>conda activate &lt;env_name&gt;</code></td>
<td>Utiliser l’environnement <code>&lt;env_name&gt;</code> pour la session du terminal</td>
</tr>
<tr class="even">
<td><code>pip list</code></td>
<td><code>conda list</code></td>
<td>Lister les <em>packages</em> dans l’environnement actif</td>
</tr>
<tr class="odd">
<td><code>pip install &lt;pkg&gt;</code></td>
<td><code>conda install &lt;pkg&gt;</code></td>
<td>Installer le <em>package</em> <code>&lt;pkg&gt;</code> dans l’environnement actif</td>
</tr>
<tr class="even">
<td><code>pip freeze &gt; requirements.txt</code></td>
<td><code>conda env export &gt; environment.yml</code></td>
<td>Exporter les spécifications de l’environnement dans un fichier <code>requirements.txt</code></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="limites" class="level2">
<h2 class="anchored" data-anchor-id="limites">Limites</h2>
<p>Développer dans des environnements virtuels est une bonne pratique, car cela accroît la portabilité d’une application. Néanmoins, il y a plusieurs limites à leur utilisation :</p>
<ul>
<li>les librairies système nécessaires à l’installation des packages ne sont pas gérées ;</li>
<li>les environnements virtuels ne permettent pas toujours de gérer des projets faisant intervenir différents langages de programmation ;</li>
<li>devoir installer <code>conda</code>, <code>Python</code>, et les packages nécessaires à chaque changement d’environnement peut être assez long et pénible en pratique ;</li>
<li>dans un environnement de production, gérer des environnements virtuels différents pour chaque projet peut s’avérer rapidement complexe pour les administrateurs système.</li>
</ul>
<p>La technologie des conteneurs permet de répondre à ces différents problèmes.</p>
</section>
</section>
<section id="les-conteneurs" class="level1">
<h1>Les conteneurs 🐋</h1>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://external-preview.redd.it/aR6WdUcsrEgld5xUlglgKX_0sC_NlryCPTXIHk5qdu8.jpg?auto=webp&amp;s=5fe64dd318eec71711d87805d43def2765dd83cd" class="img-fluid figure-img"></p>
<figcaption>Image trouvée sur <a href="https://www.reddit.com/r/ProgrammerHumor/comments/cw58z7/it_works_on_my_machine/">reddit</a></figcaption>
</figure>
</div>
<section id="introduction-1" class="level2">
<h2 class="anchored" data-anchor-id="introduction-1">Introduction</h2>
<p>Avec les environnements virtuels, l’idée était de permettre à chaque utilisateur potentiel de notre projet d’installer sur son environnement d’exécution les packages nécessaires à la bonne exécution du projet.</p>
<p>Néanmoins, comme on l’a vu, cette approche ne garantit pas une reproductibilité parfaite et a l’inconvénient de demander beaucoup de gestion manuelle.</p>
<p>Changeons de perspective : <em>au lieu de distribuer une recette permettant à l’utilisateur de recréer l’environnement nécessaire sur sa machine, ne pourrait-on pas directement distribuer à l’utilisateur une machine contenant l’environnement pré-configuré ?</em></p>
<p>Bien entendu, on ve pas configurer et envoyer des ordinateurs portables à tous les utilisateurs potentiels d’un projet. On va donc essayer de livrer une version virtuelle de notre ordinateur. Il existe deux approches principales pour cela:</p>
<ul>
<li>Les <strong>machines virtuelles</strong>. Cette approche n’est pas nouvelle. Elle consiste à recréer, sur un serveur, un environnement informatique complet (matériel et système d’exploitation) qui réplique le comportement d’un véritable ordinateur.</li>
<li>Les <strong>conteneurs</strong>, une solution plus légère pour empaqueter un environnement informatique afin de répliquer le comportement d’une machine réelle.</li>
</ul>
</section>
<section id="fonctionnement-1" class="level2">
<h2 class="anchored" data-anchor-id="fonctionnement-1">Fonctionnement</h2>
<p>Les machines virtuelles ont l’inconvénient d’être assez lourdes, et complexes à répliquer et distribuer. Pour pallier ces différentes limites, les conteneurs se sont imposés au cours de la dernière décennie. Toutes les infrastructures <em>cloud</em> modernes ont progressivement abandonné les machines virtuelles pour privilégier des conteneurs pour les raisons que nous allons évoquer ultérieurement.</p>
<p>Comme les machines virtuelles, les conteneurs permettent d’empaqueter complètement l’environnement (librairies systèmes, application, configuration) qui permet de faire tourner l’application. Mais à l’inverse d’une machine virtuelle, le conteneur n’inclut pas de système d’exploitation propre, il utilise celui de la machine hôte qui l’exécute. Cela signifie que si on désire reproduire le comportement d’une machine Windows, il n’est pas nécessaire d’avoir un gros serveur avec Windows. Il est tout à fait possible d’avoir un serveur Linux, ce qui est la norme, et de répliquer le comportement d’une machine Windows à l’intérieur. A l’inverse, cela peut permettre de tester des configurations Linux ou Mac sur un ordinateur Windows. C’est le rôle du logiciel de conteneurisation qui fera la traduction entre les instructions voulues par le <em>software</em> et le système d’exploitation du <em>hardware</em>.</p>
<p>La technologie des conteneurs permet ainsi de garantir une très forte reproductibilité tout en restant suffisamment légère pour permettre une distribution et un déploiement simple aux utilisateurs. En effet, l’adhérence forte entre un système d’exploitation et un logiciel dans l’approche des machines virtuelles rend plus complexe la montée en charge d’un serveur. Si plus d’utilisateurs commencent à utiliser l’application, il est nécessaire de s’assurer que des serveurs correspondant aux besoins de l’application (système d’exploitation, configurations techniques, etc.) soient disponibles. Avec les conteneurs, la montée en charge est plus simple puisque les restrictions matérielles sont moins fortes: ajouter un serveur Linux avec les logiciels adéquats peut être suffisant.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../docker-vm.png" class="img-fluid figure-img"></p>
<figcaption>Différences entre l’approche conteneurs (gauche) et l’approche machines virtuelles (droite) (Source : <a href="https://www.docker.com/resources/what-container/">docker.com</a> )</figcaption>
</figure>
</div>
<p>Du point de vue de l’utilisateur, la différence n’est pas toujours perceptible pour des besoins standards. L’utilisateur accédera à son application par une application dédiée (un navigateur, un logiciel spécialisé…) et les calculs issus des opérations effectuées seront déportés sur les serveurs où est hébergée cette application. Néanmoins, pour l’organisation qui gère cette application, les conteneurs offriront plus de liberté et de flexibilité comme nous l’avons évoqué.</p>
</section>
<section id="docker-limplémentation-standard" class="level2">
<h2 class="anchored" data-anchor-id="docker-limplémentation-standard"><code>Docker</code> <i class="fa-brands fa-docker" aria-label="docker"></i>, l’implémentation standard</h2>
<p>Comme nous l’avons évoqué, le logiciel de conteneurisation fait office de couche tampon entre les applications et le système d’exploitation du serveur.</p>
<p>Comme pour les environnements virtuels, il existe différentes implémentations de la technologie des conteneurs. En pratique, l’implémentation offerte par <code>Docker</code> est devenue largement prédominante, au point qu’il est devenu courant d’utiliser de manière interchangeable les termes <em>“conteneuriser”</em> et <em>“Dockeriser”</em> une application. C’est donc cette implémentation que nous allons étudier et utiliser dans ce cours.</p>
<section id="installation-et-environnements-bacs-à-sable" class="level3">
<h3 class="anchored" data-anchor-id="installation-et-environnements-bacs-à-sable">Installation et environnements bacs à sable</h3>
<p><code>Docker</code> <i class="fa-brands fa-docker" aria-label="docker"></i> est un logiciel qui peut s’installer sur différents système d’exploitation. Les instructions sont détaillées dans la <a href="https://docs.docker.com/get-docker/">documentation officielle</a>. Il est nécessaire d’avoir des droits administrateurs sur son poste pour pouvoir faire cette installation.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Besoins en espace disque
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Il est également recommandé d’avoir de l’espace disque libre car certaines images (concept sur lequel nous reviendrons), une fois décompressées et construites, peuvent être lourdes selon la richesse des librairies installées dessus. Elles peuvent rapidement prendre quelques Gigas d’espace disque.</p>
<p>Ceci est néanmoins à comparer à l’espace disque monstrueux que peut prendre un système d’exploitation complet (autour de 15GB pour Ubuntu ou Mac OS, 20GB par exemple pour Windows…). La distribution Linux la plus minimaliste (<a href="https://hub.docker.com/_/alpine/tags">Alpine</a>) ne fait que 3Mo compressée et 5Mo une fois décompressée.</p>
</div>
</div>
</div>
<p>Il existe également des environnements en ligne gratuits pouvant servir de bacs à sable s’il n’est pas possible pour vous d’installer <code>Docker</code>.<br>
<em><a href="https://labs.play-with-docker.com">Play with Docker</a></em> permet de tester en ligne <code>Docker</code> comme on pourrait le faire sur une installation personnelle. Néanmoins, ces services sont limités: la taille maximale des images décompressées est limitée à 2Go, les services connaissent des coupures en cas d’utilisation massive…</p>
<p>Comme nous le verrons ultérieurement, l’utilisation de <code>Docker</code> en interactif est pratique pour apprendre et expérimenter. Néanmoins, en pratique, on utilise principalement <code>Docker</code> par le biais de l’intégration continue via <code>Github Actions</code> ou <code>Gitlab CI</code>.</p>
</section>
<section id="principes" class="level3">
<h3 class="anchored" data-anchor-id="principes">Principes</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ensae-reproductibilite.github.io/slides/img/docker-workflow.png" class="img-fluid figure-img"></p>
<figcaption>Source : <a href="https://k21academy.com/docker-kubernetes/docker-and-kubernetes/">k21academy.com</a></figcaption>
</figure>
</div>
<p>Un conteneur Docker est mis à disposition sous la forme d’une <strong>image</strong>, c’est à dire d’un fichier binaire qui contient l’environnement nécessaire à l’exécution de l’application. Celui-ci est mis à disposition de tous sous une forme compressée sur un dépôt d’images publiques (le plus connu est <code>Dockerhub</code>).</p>
<p>Avant de mettre à disposition une image, il est nécessaire de la construire (<em>build</em>). Pour cela on utilise un <code>Dockerfile</code>, un fichier texte qui contient la recette — sous forme de commandes Linux — de construction de l’environnement.</p>
<p>Une fois l’image construite, il est possible de faire deux actions:</p>
<ul>
<li>La lancer (<em>run</em>) en local. Cela permet de tester l’application, éventuellement de la corriger en cas de mauvais fonctionnement. Le lancement de l’application permet de faire tourner l’image dans un environnement isolé qu’on appelle le conteneur (<em>container</em>), une instance vivante de l’image en quelques sortes<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a>.</li>
<li>La mettre à disposition sur un dépôt public pour permettre à d’autres (ou à soi-même) de la tester. L’image va être uploadée (<em>push</em>) sur un dépôt (<em>registry</em>), public ou privé, depuis lequel les utilisateurs vont pouvoir télécharger l’image (<em>pull</em>).</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Mettre à disposition son image <code>Docker</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Le répertoire d’images publiques le plus connu est <a href="https://hub.docker.com/"><code>DockerHub</code></a>. Il s’agit d’un répertoire où n’importe qui peut proposer une image <code>Docker</code>, associée ou non à un projet disponible sur <code>Github</code> ou <code>Gitlab</code>. Il est possible de mettre à disposition de manière manuelle des images mais, comme nous le montrerons dans le chapitre sur la <a href="../chapters/deployment.html">mise en production</a>, il est beaucoup plus pratique d’utiliser des fonctionalités d’interaction automatique entre <code>DockerHub</code> et un dépôt <code>GitHub</code>.</p>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="docker-en-pratique-un-exemple" class="level1">
<h1><code>Docker</code> en pratique: un exemple</h1>
<p><a href="../chapters/application.html">L’application fil rouge</a> présente des exemples similaires sur notre cas d’usage qu’est une application visant à rendre public les résultats de notre modèle de <em>machine learning</em>.</p>
<section id="application" class="level2">
<h2 class="anchored" data-anchor-id="application">Application</h2>
<p>Afin de présenter l’utilisation de <code>Docker</code> en pratique, nous allons présenter les différentes étapes permettant de <em>“dockeriser”</em> une application web minimaliste construite avec le <em>framework</em> <code>Python</code> <a href="https://flask.palletsprojects.com/en/2.1.x/"><code>Flask</code></a><a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a>.</p>
<p>La structure de notre projet est la suivante.</p>
<pre data-code-line-numbers=""><code>├── myflaskapp
│   ├── Dockerfile
│   ├── hello-world.py
│   └── requirements.txt</code></pre>
<p>Le script <code>hello-world.py</code> contient le code d’une application minimaliste, qui affiche simplement <em>“Hello, World!”</em> sur une page web. Nous verrons dans l’<a href="../chapters/application.html">application fil rouge</a> comment construire une application interactive plus complète.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>hello-world.py</strong></pre>
</div>
<div class="sourceCode" id="cb39" data-filename="hello-world.py" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> flask <span class="im">import</span> Flask</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> Flask(<span class="va">__name__</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">"/"</span>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hello_world():</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"&lt;p&gt;Hello, World!&lt;/p&gt;"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pour faire tourner l’application, il nous faut donc à la fois <code>Python</code> et le package <code>Flask</code>. Il est donc nécessaire de contrôler l’environnement virtuel autour de <code>Python</code> ce qui va impliquer:</p>
<ul>
<li>Installer <code>Python</code> ;</li>
<li>Installer les <em>packages</em> nécessaires à l’exécution de notre code. En l’occurrence, on n’a besoin que de <code>Flask</code>.</li>
</ul>
<p>Si la version de <code>Python</code> utilisée par notre application nous importe peu, il est plus simple d’adopter un environnement virtuel <code>venv</code> que <code>conda</code>. Nous allons donc proposer d’utiliser ceci ce qui tombe bien car nous avons déjà notre <code>requirements.txt</code> qui prend la forme suivante:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>requirements.txt</strong></pre>
</div>
<div class="sourceCode" id="cb40" data-filename="requirements.txt" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>Flask<span class="op">==</span><span class="fl">2.1.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ces installations en deux temps (<code>Python</code> et packages nécessaires) doivent être spécifiées dans le <code>Dockerfile</code> (cf.&nbsp;<a href="#dockerfile">section suivante</a>).</p>
</section>
<section id="dockerfile" class="level2">
<h2 class="anchored" data-anchor-id="dockerfile">Le <code>Dockerfile</code></h2>
<p>Pour faire un plat, il faut une recette. Pour faire une image image <code>Docker</code>, il faut un <code>Dockerfile</code>.</p>
<p>Ce fichier texte contient une série de commandes qui permettent de construire l’image. Ces fichiers peuvent être plus ou moins complexes selon l’application que l’on cherche à conteneuriser, mais leur structure est assez normalisée.</p>
<p>L’idée est de partir d’une couche de base (une distribution Linux minimaliste) et y ajouter des couches en fonction des besoins de notre application.</p>
<p>Pour illustrer cela, analysons ligne à ligne le <code>Dockerfile</code> nécessaire pour construire une image <code>Docker</code> de notre application <code>Flask.</code></p>
<div id="e207e212" class="cell" data-execution_count="1">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Dockerfile</strong></pre>
</div>
<div class="sourceCode cell-code" id="annotated-cell-6" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-6-1" class="code-annotation-target"><a href="#annotated-cell-6-1" aria-hidden="true" tabindex="-1"></a>FROM ubuntu:<span class="fl">20.04</span></span>
<span id="annotated-cell-6-2"><a href="#annotated-cell-6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-6-3"><a href="#annotated-cell-6-3" aria-hidden="true" tabindex="-1"></a>RUN apt<span class="op">-</span>get update <span class="op">-</span>y <span class="op">&amp;&amp;</span> \ </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-6-4" class="code-annotation-target"><a href="#annotated-cell-6-4" aria-hidden="true" tabindex="-1"></a>    apt<span class="op">-</span>get install <span class="op">-</span>y python3<span class="op">-</span>pip python3<span class="op">-</span>dev</span>
<span id="annotated-cell-6-5"><a href="#annotated-cell-6-5" aria-hidden="true" tabindex="-1"></a>    </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-6-6" class="code-annotation-target"><a href="#annotated-cell-6-6" aria-hidden="true" tabindex="-1"></a>WORKDIR <span class="op">/</span>app</span>
<span id="annotated-cell-6-7"><a href="#annotated-cell-6-7" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-6-8" class="code-annotation-target"><a href="#annotated-cell-6-8" aria-hidden="true" tabindex="-1"></a>COPY requirements.txt <span class="op">/</span>app<span class="op">/</span>requirements.txt</span>
<span id="annotated-cell-6-9"><a href="#annotated-cell-6-9" aria-hidden="true" tabindex="-1"></a>RUN pip install <span class="op">-</span>r requirements.txt</span>
<span id="annotated-cell-6-10"><a href="#annotated-cell-6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-6-11"><a href="#annotated-cell-6-11" aria-hidden="true" tabindex="-1"></a>COPY . <span class="op">/</span>app</span>
<span id="annotated-cell-6-12"><a href="#annotated-cell-6-12" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-6-13" class="code-annotation-target"><a href="#annotated-cell-6-13" aria-hidden="true" tabindex="-1"></a>ENV FLASK_APP<span class="op">=</span><span class="st">"hello-world.py"</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-6-14" class="code-annotation-target"><a href="#annotated-cell-6-14" aria-hidden="true" tabindex="-1"></a>EXPOSE <span class="dv">5000</span></span>
<span id="annotated-cell-6-15"><a href="#annotated-cell-6-15" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="7" onclick="event.preventDefault();">7</a><span id="annotated-cell-6-16" class="code-annotation-target"><a href="#annotated-cell-6-16" aria-hidden="true" tabindex="-1"></a>CMD [<span class="st">"flask"</span>, <span class="st">"run"</span>, <span class="st">"--host=0.0.0.0"</span>]</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-6" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="1" data-code-annotation="1"><code>FROM</code> : spécifie l’image de base. Une image <code>Docker</code> hérite toujours d’une image de base. Ici, on choisit l’image <code>Ubuntu</code> version <code>20.04</code>, tout va donc se passer comme si l’on développait sur une machine virtuelle vierge ayant pour système d’exploitation <code>Ubuntu 20.04</code> <i class="fa-brands fa-linux" aria-label="linux"></i> ;</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="4" data-code-annotation="2"><code>RUN</code> : lance une commande Linux. Ici, on met d’abord à jour la liste des packages téléchargeables via <code>apt</code>, puis on installe <code>Python</code> <i class="fa-brands fa-python" aria-label="python"></i> ainsi que des librairies système nécessaires au bon fonctionnement de notre application ;</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="6" data-code-annotation="3"><code>WORKDIR</code> : spécifie le répertoire de travail de l’image. Ainsi, toutes les commandes suivantes seront exécutées depuis ce répertoire. C’est l’équivalent <code>Docker</code> de la commande <code>cd</code> (voir <a href="../chapters/linux-101.html">Linux 101</a>) ;</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="8,9,11" data-code-annotation="4"><code>COPY</code> : copie un fichier local sur l’image <code>Docker</code>. Cela est lié à la manière dont fonctionne <code>Docker</code>. Pour ne pas polluer l’image de fichiers non nécessaires (qui affecteront de manière incidente sa configuration et le poids de celle-ci), par défaut, votre image ne contient pas de fichiers de votre projet. Si certains sont nécessaires pour construire l’image, il faut explicitement le dire à <code>Docker</code>. Ici, on copie d’abord le fichier <code>requirements.txt</code> du projet, qui spécifie les dépendances <code>Python</code> de notre application, puis on les installe avec une commande <code>RUN</code>. La seconde instruction <code>COPY</code> copie le répertoire du projet sur l’image ;</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="13" data-code-annotation="5"><code>ENV</code> : crée une variable d’environnement qui sera accessible à l’application dans le conteneur. Ici, on définit une variable d’environnement attendue par <code>Flask</code>, qui spécifie le nom du script permettant de lancer l’application ;</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="14" data-code-annotation="6"><code>EXPOSE</code> : informe <code>Docker</code> que le conteneur “écoute” sur le port 5000, qui est le port par défaut utilisé par le serveur web de <code>Flask</code>. Ceci est lié à la nature du fonctionnement de <code>Flask</code> qui lance un <em>localhost</em> sur un port donné, en l’occurrence le port 5000. ;</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="16" data-code-annotation="7"><code>CMD</code> : spécifie la commande que doit exécuter le conteneur lors de son lancement. Il s’agit d’une liste, qui contient les différentes parties de la commande sous forme de chaînes de caractères. Ici, on lance la commande <code>flask run</code> qui sait automatiquement quelle application lancer du fait de la commande <code>ENV</code> spécifiée précédemment. On ajoute l’option <code>--host=0.0.0.0</code> pour que ce soit l’application déployée sur le <em>localhost</em> (notre application <code>Flask</code>) qui soit mis à disposition de l’utilisateur final.</span>
</dd>
</dl>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Choisir l’image de base
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Dans l’idéal, on essaie de partir d’une couche la plus petite possible pour limiter la taille de l’image finalement obtenue. Il n’est en effet pas nécessaire d’utiliser une image disposant de <i class="fa-brands fa-r-project" aria-label="r-project"></i> si on n’utilise que du <i class="fa-brands fa-python" aria-label="python"></i>.</p>
<p>En général, les différents langages proposent des images de petite taille dans lequel un interpréteur est déjà installé et proprement configuré. Dans cette application, on aurait par exemple pu utiliser l’image <a href="https://hub.docker.com/layers/python/library/python/3.9-slim-buster/images/sha256-e07b35c0c81c21995a43cefd64730ac0e57a5164cc440b6a5c94c118cfacd0ca?context=explore"><code>python:3.9-slim-buster</code></a>.</p>
</div>
</div>
</div>
<p>Avec la première commande <code>RUN</code> du <code>Dockerfile</code>, nous installons <code>Python</code> mais aussi des librairies système nécessaires au bon fonctionnement de l’application. Mais comment les avons-nous trouvées ?</p>
<p>Par essai et erreur. Lors de l’étape de <a href="#build">build</a> que l’on verra juste après, le moteur <code>Docker</code> va essayer de construire l’image selon les spécifications du <code>Dockerfile</code>, comme s’il partait d’un ordinateur vide contenant simplement <code>Ubuntu 20.04</code>. Si des librairies manquent, le processus de <em>build</em> devrait renvoyer une erreur, qui s’affichera dans les <em>logs</em> de l’application, affichés par défaut dans la console. Quand on a de la chance, les <em>logs</em> décrivent explicitement les librairies système manquantes. Mais souvent, les messages d’erreur ne sont pas très explicites, et il faut alors les copier dans un moteur de recherche bien connu pour trouver la réponse, souvent sur <a href="https://stackoverflow.com/">StackOverflow</a>.</p>
<p>Il est recommandé, avant d’essayer de créer une image <code>Docker</code>, de passer par l’étape intermédiaire dans la démarche de reproductibilité qu’est la création d’un script shell (<code>.sh</code>). Cette approche graduelle est illustrée dans <a href="../chapters/application.html">l’application fil rouge</a>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
L’instruction <code>COPY</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>La recette présente dans le <code>Dockerfile</code> peut nécessiter l’utilisation de fichiers appartenant au dossier de travail. Pour que <code>Docker</code> les trouve dans son contexte, il est nécessaire d’introduire une commande <code>COPY</code>. C’est un petit peu comme pour la cuisine: pour utiliser un produit dans une recette, il faut le sortir du frigo (fichier local) et le mettre sur la table.</p>
</div>
</div>
</div>
<p>Nous n’avons ici vu que les commandes <code>Docker</code> les plus fréquentes, il en existe beaucoup d’autres en pratique. N’hésitez pas à consulter la <a href="https://docs.docker.com/engine/reference/builder/">documentation officielle</a> pour comprendre leur utilisation.</p>
</section>
<section id="build" class="level2">
<h2 class="anchored" data-anchor-id="build">Construction d’une image Docker</h2>
<p>Pour construire une image à partir d’un <code>Dockerfile</code>, il suffit d’utiliser la commande <code>docker build</code> depuis la ligne de commande<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a>. Il faut ensuite spécifier deux éléments importants :</p>
<ul>
<li>le <strong><em>build context</em></strong>. Il faut indiquer à <code>Docker</code> le chemin de notre projet, qui doit contenir le <code>Dockerfile</code>. En pratique, il est plus simple de se mettre dans le dossier du projet via la commande <code>cd</code>, puis de passer <code>.</code> comme <em>build context</em> pour indiquer à <code>Docker</code> de <em>build</em> “d’ici” ;</li>
<li>le <strong><em>tag</em></strong>, c’est à dire le nom de l’image. Tant que l’on utilise <code>Docker</code> en local, le <em>tag</em> importe peu. On verra par la suite que la structure du <em>tag</em> a de l’importance lorsque l’on souhaite <a href="#imp-docker">exporter</a> ou <a href="#exp-docker">importer</a> une image <code>Docker</code> à partir d’un dépôt distant.</li>
</ul>
<p>Regardons ce qui se passe en pratique lorsque l’on essaie de construire notre image. Le tag de celle-ci est <code>myflaskapp</code>:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb41" data-filename="terminal" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker build <span class="at">-t</span> myflaskapp .</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb42" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>Sending build context to Docker daemon     <span class="dv">47</span><span class="er">MB</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>Step <span class="dv">1</span><span class="op">/</span><span class="dv">8</span> : FROM ubuntu:<span class="fl">20.04</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> <span class="dv">825</span><span class="er">d55fb6340</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>Step <span class="dv">2</span><span class="op">/</span><span class="dv">8</span> : RUN apt<span class="op">-</span>get update <span class="op">&amp;&amp;</span> apt<span class="op">-</span>get install <span class="op">-</span>y python3<span class="op">-</span>pip python3<span class="op">-</span>dev</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> Running <span class="kw">in</span> <span class="dv">92</span><span class="er">b42d579cfa</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>done.</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>Removing intermediate container <span class="dv">92</span><span class="er">b42d579cfa</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> <span class="dv">8826</span><span class="er">d53e3c01</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>Step <span class="dv">3</span><span class="op">/</span><span class="dv">8</span> : WORKDIR <span class="op">/</span>app</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> Running <span class="kw">in</span> <span class="dv">153</span><span class="er">b32893c23</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>Removing intermediate container <span class="dv">153</span><span class="er">b32893c23</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> <span class="dv">7</span><span class="er">b4d22021986</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>Step <span class="dv">4</span><span class="op">/</span><span class="dv">8</span> : COPY requirements.txt <span class="op">/</span>app<span class="op">/</span>requirements.txt</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>Successfully built <span class="dv">125</span><span class="er">bd8da70ff</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>Successfully tagged myflaskapp:latest</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Le moteur <code>Docker</code> essaie de construire notre image séquentiellement à partir des commandes spécifiées dans le <code>Dockerfile</code>. S’il rencontre une erreur, la procédure s’arrête, et il faut alors trouver la source du problème dans les <em>logs</em> et adapter le <code>Dockerfile</code> en conséquence.</p>
<p>Si tout se passe bien, <code>Docker</code> nous indique que le <em>build</em> a réussi et l’image est prête à être utilisée. On peut vérifier que l’image est bien disponible à l’aide de la commande <code>docker images</code>.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb43" data-filename="terminal" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker images</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb44" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>REPOSITORY                               TAG       IMAGE ID       CREATED          SIZE</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>myflaskapp                               latest    <span class="dv">57</span><span class="er">d2f410a631</span>   <span class="dv">2</span> hours ago      <span class="dv">433</span><span class="er">MB</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Intéressons nous un peu plus en détail aux <em>logs</em> de l’étape de <em>build</em> 👆️.</p>
<p>Entre les étapes, <code>Docker</code> affiche des suites de lettres et de chiffres un peu ésotériques, et nous parle de conteneurs intermédiaires. En fait, il faut voir une image <code>Docker</code> comme un empilement de couches (<em>layers</em>), qui sont elles-mêmes des images <code>Docker</code>. Quand on hérite d’une image avec l’instruction <code>FROM</code>, on spécifie donc à <code>Docker</code> la couche initiale, sur laquelle il va construire le reste de notre environnement. A chaque étape sa nouvelle couche, et à chaque couche son <em>hash</em>, un identifiant unique fait de lettres et de chiffres.</p>
<p>Cela peut ressembler à des détails techniques, mais c’est en fait extrêmement utile en pratique car cela permet à <code>Docker</code> de faire du <em>caching</em>. Lorsqu’on développe un <code>Dockerfile</code>, il est fréquent de devoir modifier ce dernier de nombreuses fois avant de trouver la bonne recette, et on aimerait bien ne pas avoir à <em>rebuild</em> l’environnement complet à chaque fois. <code>Docker</code> gère cela très bien : il <em>cache</em> chacune des couches intermédiaires<a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a>.</p>
<p>Par exemple, si l’on modifie la 5ème commande du <code>Dockerfile</code>, <code>Docker</code> va utiliser le cache pour ne pas avoir à recalculer les étapes précédentes, qui n’ont pas changé. Cela s’appelle l’<em>“invalidation du cache”</em> : dès lors qu’une étape du <code>Dockerfile</code> est modifiée, <code>Docker</code> va recalculer toutes les étapes suivantes, mais seulement celles-ci. Conséquence directe de cette observation : il faut toujours ordonner les étapes d’un <code>Dockerfile</code> de sorte à ce qui est le plus susceptible d’être souvent modifié soit à la fin du fichier, et inversement.</p>
<p>Pour illustrer cela, regardons ce qui se passe si l’on modifie le nom du script qui lance l’application, et donc la valeur de la variable d’environnement <code>FLASK_APP</code> dans le <code>Dockerfile</code>.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb45" data-filename="terminal" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker build . <span class="at">-t</span> myflaskapp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="a1fa6655" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb46" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>Sending build context to Docker daemon  <span class="fl">4.096</span><span class="er">kB</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>Step <span class="dv">1</span><span class="op">/</span><span class="dv">10</span> : FROM ubuntu:<span class="fl">20.04</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> <span class="dv">825</span><span class="er">d55fb6340</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>Step <span class="dv">2</span><span class="op">/</span><span class="dv">10</span> : ENV DEBIAN_FRONTEND<span class="op">=</span>noninteractive</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> Using cache</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> ea1c7c083ac9</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>Step <span class="dv">3</span><span class="op">/</span><span class="dv">10</span> : RUN apt<span class="op">-</span>get update <span class="op">-</span>y <span class="op">&amp;&amp;</span>     apt<span class="op">-</span>get install <span class="op">-</span>y python3<span class="op">-</span>pip python3<span class="op">-</span>dev</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> Using cache</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> <span class="dv">0</span><span class="er">78b8ac0e1cb</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>Step <span class="dv">4</span><span class="op">/</span><span class="dv">10</span> : WORKDIR <span class="op">/</span>app</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> Using cache</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> cd19632825b3</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>Step <span class="dv">5</span><span class="op">/</span><span class="dv">10</span> : COPY requirements.txt <span class="op">/</span>app<span class="op">/</span>requirements.txt</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> Using cache</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> <span class="dv">271</span><span class="er">cd1686899</span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>Step <span class="dv">6</span><span class="op">/</span><span class="dv">10</span> : RUN pip install <span class="op">-</span>r requirements.txt</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> Using cache</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> <span class="dv">3</span><span class="er">ea406fdf383</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>Step <span class="dv">7</span><span class="op">/</span><span class="dv">10</span> : COPY . <span class="op">/</span>app</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> <span class="dv">3</span><span class="er">ce5bd3a9572</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>Step <span class="dv">8</span><span class="op">/</span><span class="dv">10</span> : ENV FLASK_APP<span class="op">=</span><span class="st">"new.py"</span></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> Running <span class="kw">in</span> b378d16bb605</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>Removing intermediate container b378d16bb605</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> e1f50490287b</span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>Step <span class="dv">9</span><span class="op">/</span><span class="dv">10</span> : EXPOSE <span class="dv">5000</span></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> Running <span class="kw">in</span> ab53c461d3de</span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>Removing intermediate container ab53c461d3de</span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> <span class="dv">0</span><span class="er">b86eca40a80</span></span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a>Step <span class="dv">10</span><span class="op">/</span><span class="dv">10</span> : CMD [<span class="st">"flask"</span>, <span class="st">"run"</span>, <span class="st">"--host=0.0.0.0"</span>]</span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> Running <span class="kw">in</span> <span class="dv">340</span><span class="er">eec151a51</span></span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>Removing intermediate container <span class="dv">340</span><span class="er">eec151a51</span></span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> <span class="dv">16</span><span class="er">d7a5b8db28</span></span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a>Successfully built <span class="dv">16</span><span class="er">d7a5b8db28</span></span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a>Successfully tagged myflaskapp:latest</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>L’étape de <em>build</em> a pris quelques secondes au lieu de plusieurs minutes, et les <em>logs</em> montrent bien l’utilisation du cache faite par <code>Docker</code> : les étapes précédant le changement réutilisent les couches cachées, mais celle d’après sont recalculées.</p>
</section>
<section id="execution" class="level2">
<h2 class="anchored" data-anchor-id="execution">Exécuter (<em>run</em>) une image <code>Docker</code></h2>
<p>L’étape de <em>build</em> a permis de créer une <em>image</em> <code>Docker</code>. Une image doit être vue comme un <em>template</em> : elle permet d’exécuter l’application sur n’importe quel environnement d’exécution sur lequel un moteur <code>Docker</code> est installé.</p>
<p>En l’état, on a donc juste <em>construit</em>, mais rien <em>lancé</em> : notre application ne tourne pas encore. Pour cela, il faut créer un <em>conteneur</em>, i.e.&nbsp;une instance vivante de l’image qui permet d’accéder à l’application. Cela se fait via la commande <code>docker run</code>.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb47" data-filename="terminal" data-no-prefix="true" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker run <span class="at">-d</span> <span class="at">-p</span> 8000:5000 myflaskapp:latest</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="ex">6a2ab0d82d051a3829b182ede7b9152f7b692117d63fa013e7dfe6232f1b9e81</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Détaillons la syntaxe de cette commande :</p>
<ul>
<li><code>docker run tag</code> : lance l’image dont on fournit le <em>tag</em>. Le <em>tag</em> est de la forme <code>repository/projet:version</code>. Ici, il n’y a pas de <em>repository</em> puisque tout est fait en local ;</li>
<li><code>-d</code> : “détache” le conteneur du terminal qui le lance ;</li>
<li><code>-p</code> : effectue un <em>mapping</em> entre un port de la machine qui exécute le conteneur, et le conteneur lui-même. Notre conteneur écoute sur le port 5000, et l’on veut que notre application soit exposée sur le port 8000 de notre machine.</li>
</ul>
<p>Lorsque l’on exécute <code>docker run</code>, <code>Docker</code> nous répond simplement un <em>hash</em> qui identifie le conteneur que l’on a lancé. On peut vérifier qu’il tourne bien avec la commande <code>docker ps</code>, qui renvoie toutes les informations associées au conteneur.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb48" data-filename="terminal" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker ps</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb49" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>CONTAINER ID   IMAGE        COMMAND                  CREATED         STATUS         PORTS                                   NAMES</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span><span class="er">a2ab0d82d05</span>   myflaskapp   <span class="st">"flask run --host=0.…"</span>   <span class="dv">7</span> seconds ago   Up <span class="dv">6</span> seconds   <span class="fl">0.0.0.0</span>:<span class="dv">8000</span><span class="op">-&gt;</span><span class="dv">5000</span><span class="op">/</span>tcp, :::<span class="dv">8000</span><span class="op">-&gt;</span><span class="dv">5000</span><span class="op">/</span>tcp   vigorous_kalam</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Les conteneurs peuvent être utilisés pour réaliser des tâches très différentes. Grossièrement, on peut distinguer deux situations :</p>
<ul>
<li>le conteneur effectue une tâche “one-shot”, c’est à dire une opération qui a vocation à s’effectuer en un certain temps, suite à quoi le conteneur peut s’arrêter ;</li>
<li>le conteneur exécute une application. Dans ce cas, on souhaite que le conteneur reste en vie aussi longtemps que l’on souhaite utiliser l’application en question.</li>
</ul>
<p>Dans notre cas d’application, on se situe dans la seconde configuration puisque l’on veut exécuter une application web. Lorsque l’application tourne, elle expose sur le <em>localhost</em>, accessible depuis un navigateur web — en l’occurence, à l’adresse <a href="localhost:5000/">localhost:5000/</a>. Les calculs sont effectués sur un serveur local, et le navigateur sert d’interface avec l’utilisateur — comme lorsque vous utilisez un <em>notebook</em> <code>Jupyter</code> par exemple.</p>
<p>Finalement, on a pu développer et exécuter une application complète sur notre environnement local, sans avoir eu à installer quoi que ce soit sur notre machine personnelle, à part <code>Docker.</code></p>
</section>
<section id="exp-docker" class="level2">
<h2 class="anchored" data-anchor-id="exp-docker">Exporter une image <code>Docker</code></h2>
<p>Jusqu’à maintenant, toutes les commandes <code>Docker</code> que nous avons exécutées se sont passées en local. Ce mode de fonctionnement peut être intéressant pour la phase de développement et d’expérimentation. Mais comme on l’a vu, un des gros avantages de <code>Docker</code> est la facilité de redistribution des images construites, qui peuvent ensuite être utilisées par de nombreux utilisateurs pour faire tourner notre application. Pour cela, il nous faut <em>uploader</em> notre image sur un dépôt distant, à partir duquel les utilisateurs pourront la télécharger.</p>
<p>Plusieurs possibilités existent selon le contexte de travail : une entreprise peut avoir un dépôt interne par exemple. Si le projet est <em>open source</em>, on peut utiliser le <a href="https://hub.docker.com/">DockerHub</a>.</p>
<p>Le <em>workflow</em> pour uploader une image est le suivant :</p>
<ul>
<li>créer un compte sur <code>DockerHub</code> ;</li>
<li>créer un projet (public) sur <code>DockerHub</code>, qui va héberger les images <code>Docker</code> du projet ;</li>
<li>sur un terminal, utiliser <code>docker login</code> pour s’authentifier au <code>DockerHub</code> ;</li>
<li>on va modifier le <em>tag</em> que l’on fournit lors du <em>build</em> pour spécifier le chemin attendu. Dans notre cas : <code>docker build -t compte/projet:version .</code> ;</li>
<li>uploader l’image avec <code>docker push compte/projet:version</code></li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb50" data-filename="terminal" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker push avouacr/myflaskapp:1.0.0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb51" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>The push refers to repository [docker.io<span class="op">/</span>avouacr<span class="op">/</span>myflaskapp]</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="dv">71</span><span class="er">db96687fe6</span>: Pushed </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="dv">624877</span><span class="er">ac887b</span>: Pushed </span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>ea4ab6b86e70: Pushed </span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>b5120a5bc48d: Pushed </span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span><span class="er">fa484a3c9d8</span>: Pushed </span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>c5ec52c98b31: Pushed </span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="fl">1.0.0</span>: digest: sha256:b75fe53fd1990c3092ec41ab0966a9fbbb762f3047957d99327cc16e27c68cc9 size: <span class="dv">1574</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="imp-docker" class="level2">
<h2 class="anchored" data-anchor-id="imp-docker">Importer une image <code>Docker</code></h2>
<p>En supposant que le dépôt utilisé pour uploader l’image est public, la procédure que doit suivre un utilisateur pour la télécharger se résume à utiliser la commande <code>docker pull compte/projet:version</code></p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb52" data-filename="terminal" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker pull avouacr/myflaskapp:1.0.0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb53" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fl">1.0.0</span>: Pulling <span class="im">from</span> avouacr<span class="op">/</span>myflaskapp</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>e0b25ef51634: Pull complete </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>c0445e4b247e: Pull complete </span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="dv">48</span><span class="er">ba4e71d1c2</span>: Pull complete </span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>ffd728caa80a: Pull complete </span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="dv">906</span><span class="er">a95f00510</span>: Pull complete </span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>d7d49b6e17ab: Pull complete </span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>Digest: sha256:b75fe53fd1990c3092ec41ab0966a9fbbb762f3047957d99327cc16e27c68cc9</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>Status: Downloaded newer image <span class="cf">for</span> avouacr<span class="op">/</span>myflaskapp:<span class="fl">1.0.0</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>docker.io<span class="op">/</span>avouacr<span class="op">/</span>myflaskapp:<span class="fl">1.0.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>Docker</code> télécharge et extrait chacune des couches qui constituent l’image (ce qui peut parfois être long). L’utilisateur peut alors créer un conteneur à partir de l’image, en utilisant <code>docker run</code> comme illustré précédemment.</p>
</section>
<section id="aide-mémoire-1" class="level2">
<h2 class="anchored" data-anchor-id="aide-mémoire-1">Aide-mémoire</h2>
<p>Voici une première aide-mémoire sur les principales commandes à intégrer dans un <code>Dockerfile</code>:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Commande</th>
<th>Principe</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>FROM &lt;image&gt;:&lt;tag&gt;</code></td>
<td>Utiliser comme point de départ l’image <code>&lt;image&gt;</code> ayant le tag <code>&lt;tag&gt;</code></td>
</tr>
<tr class="even">
<td><code>RUN &lt;instructions&gt;</code></td>
<td>Utiliser la suite d’instructions <code>&lt;instructions&gt;</code> dans un terminal <code>Linux</code>. Pour passer plusieurs commandes dans un <code>RUN</code>, utiliser <code>&amp;&amp;</code>. Cette suite de commande peut avoir plusieurs lignes, dans ce cas, mettre <code>\</code> en fin de ligne</td>
</tr>
<tr class="odd">
<td><code>COPY &lt;source&gt; &lt;dest&gt;</code></td>
<td>Récupérer le fichier présent dans le système de fichier local à l’emplacement <code>&lt;source&gt;</code> pour que les instructions ultérieures puissent le trouver à l’emplacement <code>&lt;source&gt;</code></td>
</tr>
<tr class="even">
<td><code>ADD &lt;source&gt; &lt;dest&gt;</code></td>
<td>Globalement, même rôle que <code>COPY</code></td>
</tr>
<tr class="odd">
<td><code>ENV MY_NAME="John Doe"</code></td>
<td>Création d’une variable d’environnement (qui devient disponible sous l’alias <code>$MY_NAME</code>)</td>
</tr>
<tr class="even">
<td><code>WORKDIR &lt;path&gt;</code></td>
<td>Définir le <em>working directory</em> du conteuneur Docker dans le dossier <code>&lt;path&gt;</code></td>
</tr>
<tr class="odd">
<td><code>USER &lt;username&gt;</code></td>
<td>Création d’un utilisateur non <em>root</em> nommé <code>&lt;username&gt;</code></td>
</tr>
<tr class="even">
<td><code>EXPOSE &lt;PORT_ID&gt;</code></td>
<td>Lorsqu’elle tournera, l’application sera disponible depuis le port <code>&lt;PORT_ID&gt;</code></td>
</tr>
<tr class="odd">
<td><code>CMD ["executable","param1","param2"]</code></td>
<td>Au lancement de l’instance Docker la commande <code>executable</code> (par exemple <code>python3</code>) sera lancée avec les paramètres additionnels fournis</td>
</tr>
</tbody>
</table>
<p>Une seconde aide-mémoire pour les principales commandes <code>Linux</code> est disponible ci-dessous:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Commande</th>
<th>Principe</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>docker build . -t &lt;tag&gt;</code></td>
<td>Construire l’image <code>Docker</code> à partir des fichiers dans le répertoire courant (<code>.</code>) en l’identifiant avec le tag <code>&lt;tag&gt;</code></td>
</tr>
<tr class="even">
<td><code>docker run -it &lt;tag&gt;</code></td>
<td>Lancer l’instance docker identifiée par <code>&lt;tag&gt;</code></td>
</tr>
<tr class="odd">
<td><code>docker images</code></td>
<td>Lister les images disponibles sur la machine et quelques unes de leurs propriétés (tags, volume, etc.)</td>
</tr>
<tr class="even">
<td><code>docker system prune</code></td>
<td>Faire un peu de ménage dans ses images <code>Docker</code> (bien réfléchir avant de faire tourner cette commande)</td>
</tr>
</tbody>
</table>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Nous reviendrons plus tard sur la manière dont la mise à disposition de <em>packages</em> sous forme précompilée par le biais de <em>wheels</em> offre une solution à ce problème.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>S’il est impossible de suivre les évolutions de tous les <em>packages</em> de la <em>data science</em>, il est recommandé de faire une veille sur les principaux comme <code>Pandas</code> ou <code>Scikit</code> en suivant les <em>release notes</em> des versions majeures qui introduisent généralement des non-compatibilités.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Le <em>solver</em> de <code>conda</code>, qui est un algorithme de recherche de chemin optimal dans des graphes pour gérer les (in)compatibilités de versions, est lourd à mettre en oeuvre. Le projet <a href="https://mamba.readthedocs.io/en/latest/"><code>mamba</code></a> a permis d’offrir une réimplémentation de <code>Conda</code> en <code>C++</code> par le biais d’un <em>solver</em> plus efficace. Cela a permis de franchement accélérer la vitesse d’installation des <em>packages</em> par le biais de <code>conda</code>. Néanmoins, l’accès de plus en plus fréquent à des <a href="https://pythonwheels.com/"><em>wheels</em></a> a permis un retour en grâce des environnements virtuels implémentés par <code>venv</code> au cours des dernières années.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Cela signifie que si on ouvre un nouveau terminal, il faudra à nouveau activer cet environnement si on désire l’utiliser. Si on désire activer par défaut un environnement, il est possible de configurer le terminal pour qu’il active automatiquement un environnement spécifique lors de son ouverture. Cela peut être réalisé en modifiant les fichiers de configuration du shell, par le biais par exemple du script <code>.bashrc</code> sur <code>Linux</code>.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>D’ailleurs, si vous utilisez <code>pip</code> sur le SSPCloud, c’est ce que vous faites, sans vous en rendre compte.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>Ces répertoires sont, dans le langage <code>conda</code>, les <em>canaux</em>. Le canal par défaut est maintenu par les développeurs d<code>Anaconda</code>. Cependant, pour en assurer la stabilité, ce canal a une forte inertie. La <code>conda-forge</code> a émergé pour offrir plus de flexibilité aux développeurs de <em>package</em> qui peuvent ainsi mettre à disposition des versions plus récentes de leurs packages, comme sur <a href="https://pypi.org/">PyPI</a>.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>Par abus de langage, on mélange souvent les termes <em>“image”</em> et <em>“conteneur”</em>. En pratique ces deux concepts sont très proches. Le second correspond à la version vivante du premier.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p><a href="https://flask.palletsprojects.com/en/2.1.x/"><code>Flask</code></a> est un <em>framework</em> permettant de déployer, de manière légère, des applications reposant sur <code>Python</code>.<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9"><p>Si vous êtes sur Windows, les lignes de commande disponibles par défaut (<code>cmd</code> ou <code>Powershell</code>) sont peu pratiques. Il est recommandé d’utiliser la ligne de commande de <code>Git Bash</code> (une émulation minimaliste d’une ligne de commande <code>Linux</code>) qui vous permettra de faire des opérations en ligne de commande.<a href="#fnref9" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn10"><p>Le <em>cache</em> est très pratique pour une construction expérimentale en local. Malheureusement, lorsqu’on passe par des services d’intégration continue, l’utilisation du <em>cache</em> est moins évidente car chaque <code>run</code> se fait sur une machine indépendante de la précédente.<a href="#fnref10" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/ensae-reproductibilite\.github\.io\/website\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<script src="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>