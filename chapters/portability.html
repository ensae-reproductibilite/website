<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Romain Avouac et Lino Galiana">
<meta name="dcterms.date" content="2022-03-03">
<meta name="description" content="PrÃ©sentation des principes et des techniques permettant de rendre un projet exÃ©cutable sur diffÃ©rents environnements.">

<title>Mise en production des projets de data science - Rendre son projet de data science portable et reproductible</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Mise en production des projets de data science</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-les-bases" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Les bases</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-les-bases">    
        <li>
    <a class="dropdown-item" href="../chapters/introduction.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/linux-101.html">
 <span class="dropdown-text">Linux 101</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/git.html">
 <span class="dropdown-text">Versionner son code et travailler collaborativement avec Git</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../chapters/code-quality.html"> 
<span class="menu-text">QualitÃ© du code</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../chapters/projects-architecture.html"> 
<span class="menu-text">Architecture des projets</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../chapters/portability.html" aria-current="page"> 
<span class="menu-text">PortabilitÃ©</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../chapters/deployment.html"> 
<span class="menu-text">Mise en production</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../chapters/application.html"> 
<span class="menu-text">Application</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../chapters/evaluation.qmd"> 
<span class="menu-text">Evaluation</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-bi-github">    
        <li>
    <a class="dropdown-item" href="https://github.com/ensae-reproductibilite/website">
 <span class="dropdown-text">Site web</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/ensae-reproductibilite/slides">
 <span class="dropdown-text">Slides</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/ensae-reproductibilite/application-correction">
 <span class="dropdown-text">Application fil rouge</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#la-notion-de-portabilitÃ©" id="toc-la-notion-de-portabilitÃ©" class="nav-link active" data-scroll-target="#la-notion-de-portabilitÃ©">La notion de portabilitÃ©</a></li>
  <li><a href="#les-environnements-virtuels" id="toc-les-environnements-virtuels" class="nav-link" data-scroll-target="#les-environnements-virtuels">Les environnements virtuels ğŸ</a>
  <ul class="collapse">
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#fonctionnement" id="toc-fonctionnement" class="nav-link" data-scroll-target="#fonctionnement">Fonctionnement</a></li>
  <li><a href="#implÃ©mentations" id="toc-implÃ©mentations" class="nav-link" data-scroll-target="#implÃ©mentations">ImplÃ©mentations</a></li>
  <li><a href="#conda" id="toc-conda" class="nav-link" data-scroll-target="#conda">Conda</a>
  <ul class="collapse">
  <li><a href="#installation" id="toc-installation" class="nav-link" data-scroll-target="#installation">Installation</a></li>
  <li><a href="#en-pratique" id="toc-en-pratique" class="nav-link" data-scroll-target="#en-pratique">En pratique</a></li>
  <li><a href="#aide-mÃ©moire" id="toc-aide-mÃ©moire" class="nav-link" data-scroll-target="#aide-mÃ©moire">Aide-mÃ©moire</a></li>
  </ul></li>
  <li><a href="#limites" id="toc-limites" class="nav-link" data-scroll-target="#limites">Limites</a></li>
  </ul></li>
  <li><a href="#les-conteneurs" id="toc-les-conteneurs" class="nav-link" data-scroll-target="#les-conteneurs">Les conteneurs ğŸ‹</a>
  <ul class="collapse">
  <li><a href="#introduction-1" id="toc-introduction-1" class="nav-link" data-scroll-target="#introduction-1">Introduction</a></li>
  <li><a href="#fonctionnement-1" id="toc-fonctionnement-1" class="nav-link" data-scroll-target="#fonctionnement-1">Fonctionnement</a></li>
  <li><a href="#implÃ©mentations-1" id="toc-implÃ©mentations-1" class="nav-link" data-scroll-target="#implÃ©mentations-1">ImplÃ©mentations</a></li>
  <li><a href="#docker" id="toc-docker" class="nav-link" data-scroll-target="#docker">Docker <i class="fab fa-docker"></i></a>
  <ul class="collapse">
  <li><a href="#installation-1" id="toc-installation-1" class="nav-link" data-scroll-target="#installation-1">Installation</a></li>
  <li><a href="#principes" id="toc-principes" class="nav-link" data-scroll-target="#principes">Principes</a></li>
  <li><a href="#en-pratique-1" id="toc-en-pratique-1" class="nav-link" data-scroll-target="#en-pratique-1">En pratique</a></li>
  <li><a href="#aide-mÃ©moire-1" id="toc-aide-mÃ©moire-1" class="nav-link" data-scroll-target="#aide-mÃ©moire-1">Aide-mÃ©moire</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Rendre son projet de data science portable et reproductible</h1>
</div>

<div>
  <div class="description">
    <p>PrÃ©sentation des principes et des techniques permettant de rendre un projet exÃ©cutable sur diffÃ©rents environnements.</p>
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Romain Avouac et Lino Galiana </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 3, 2022</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<details>
<summary>
DÃ©rouler les <em>slides</em> ci-dessous ou <a href="https://ensae-reproductibilite.github.io/slides/#/portabilitÃ©">cliquer ici</a> pour afficher les slides en plein Ã©cran.
</summary>
<div id="cb1" class="sourceCode">
<pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
<iframe class="sourceCode yaml code-with-copy" src="https://ensae-reproductibilite.github.io/slides/#/portabilitÃ©">
</iframe>
</div>
</details>
<section id="la-notion-de-portabilitÃ©" class="level1">
<h1>La notion de portabilitÃ©</h1>
<p>Dans les chapitres prÃ©cÃ©dents, nous avons vu un ensemble de bonnes pratiques qui permettent de considÃ©rablement amÃ©liorer la qualitÃ© dâ€™un projet : rendre le code plus lisible, adopter une structure du projet normalisÃ©e et Ã©volutive, et versionner proprement son code sur un dÃ©pÃ´t <code>GitHub</code>.</p>
<p>Une fois ces bonnes pratiques appliquÃ©es Ã  notre projet, ce dernier apparaÃ®t largement partageable. Du moins en thÃ©orie, car la pratique est souvent plus compliquÃ©e : il y a fort Ã  parier que si vous essayez dâ€™exÃ©cuter votre projet sur un autre environnement dâ€™exÃ©cution (un autre ordinateur, un serveur, etc.), les choses ne se passent pas du tout comme attendu. Cela signifie que quâ€™<strong>en lâ€™Ã©tat, le projet nâ€™est pas portable : il nâ€™est pas possible, sans modifications coÃ»teuses, de lâ€™exÃ©cuter dans un environnement diffÃ©rent de celui dans lequel il a Ã©tÃ© dÃ©veloppÃ©</strong>.</p>
<p>La principale raison est quâ€™un code ne vit pas dans une bulle isolÃ©e, il contient en gÃ©nÃ©ral de nombreuses adhÃ©rences, plus ou moins visibles, au langage et Ã  lâ€™environnement dans lesquels il a Ã©tÃ© dÃ©veloppÃ© :</p>
<ul>
<li>des dÃ©pendances dans le langage du projet ;</li>
<li>des dÃ©pendances dans dâ€™autres langages (ex : <code>NumPy</code> est Ã©crit en <code>C</code> et nÃ©cessite donc un compilateur <code>C</code>) ;</li>
<li>des librairies systÃ¨mes nÃ©cessaires pour installer certains <em>packages</em> (par exemple, les librairies de cartographie dynamique comme <code>Leaflet</code> ou <code>Folium</code> nÃ©cessitent la librairie systÃ¨me <code>GDAL</code>), qui ne seront pas les mÃªmes selon le systÃ¨me dâ€™exploitation utilisÃ©.</li>
</ul>
<p>Si le premier problÃ¨me peut Ãªtre gÃ©rÃ© relativement facilement en adoptant une <a href="XXXXXX">structure de projet</a> et en spÃ©cifiant bien les diffÃ©rentes dÃ©pendances utilisÃ©es, par exemple avec un fichier <code>requirements.txt</code>, les deux autres nÃ©cessitent en gÃ©nÃ©ral des outils plus avancÃ©s.</p>
<p>Ces outils vont nous permettre de <strong>normaliser lâ€™environnement afin de produire un projet portable</strong>, i.e.&nbsp;exÃ©cutable sur une large variÃ©tÃ© dâ€™environnements dâ€™exÃ©cution. Cette Ã©tape est primordiale lorsque lâ€™on se prÃ©occupe de la mise en production dâ€™un projet, car elle assure une transition relativement indolore entre lâ€™environnement de dÃ©veloppement et celui de production.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://img.devrant.com/devrant/rant/r_174386_yx6zV.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p><em>Image empruntÃ©e Ã  [devrant.com}(https://devrant.com/rants/174386/when-i-say-but-it-works-on-my-machine)</em></p>
</section>
<section id="les-environnements-virtuels" class="level1">
<h1>Les environnements virtuels ğŸ</h1>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Pour illustrer lâ€™importance de travailler avec des environnements virtuels, mettons-nous Ã  la place dâ€™un.e aspirant.e <em>data scientist</em> qui commencerait ses premiers projets.</p>
<p>Selon toute vraisemblance, on va commencer par installer une distribution de <code>Python</code> â€” souvent, via <code>Anaconda</code> â€” sur son poste et commencer Ã  dÃ©velopper, projet aprÃ¨s projet. Dans cette approche, les diffÃ©rents <em>packages</em> quâ€™on va Ãªtre amenÃ© Ã  utiliser vont Ãªtre installÃ©s au mÃªme endroit. Cela pose plusieurs problÃ¨mes :</p>
<ul>
<li><strong>conflits de version</strong> : une application A peut dÃ©pendre de la version 1 dâ€™un package lÃ  oÃ¹ une application B peut dÃ©pendre de la version 2 de ce mÃªme package. Une seule application peut donc fonctionner dans cette configuration ;</li>
<li><strong>version de <code>Python</code> fixe</strong> â€” on ne peut avoir quâ€™une seule installation par systÃ¨me â€” lÃ  oÃ¹ on voudrait pouvoir avoir des versions diffÃ©rentes selon le projet ;</li>
<li><strong>reproductiblitÃ© limitÃ©e</strong> : difficile de dire quel projet repose sur tel package, dans la mesure oÃ¹ ceux-ci sâ€™accumulent en un mÃªme endroit au fil des projets ;</li>
<li><strong>portabilitÃ© limitÃ©e</strong> : consÃ©quence du point prÃ©cÃ©dent, il est difficile de fixer dans un fichier les dÃ©pendances spÃ©cifiques Ã  un projet.</li>
</ul>
<p>Les environnements virtuels constituent une solution Ã  ces diffÃ©rents problÃ¨mes.</p>
</section>
<section id="fonctionnement" class="level2">
<h2 class="anchored" data-anchor-id="fonctionnement">Fonctionnement</h2>
<p>Le concept dâ€™environnement virtuel est techniquement trÃ¨s simple. On peut lui donner la dÃ©finition suivante pour <code>Python</code> :</p>
<blockquote class="blockquote">
<p><em>â€œdossier auto-suffisant qui contient une installation de <code>Python</code> pour une version particuliÃ¨re de <code>Python</code> ainsi que des <em>packages</em> additionnels et qui est isolÃ© des autres environnements existants.â€</em></p>
</blockquote>
<p>On peut donc simplement voir les environnements virtuels comme un moyen de faire cohabiter sur un mÃªme systÃ¨me diffÃ©rentes installations de <code>Python</code> avec chacune leur propre liste de packages installÃ©s et leurs versions. DÃ©velopper dans des environnements virtuels vierges Ã  chaque dÃ©but de projet est une trÃ¨s bonne pratique pour accroÃ®tre la reproductibilitÃ© des analyses.</p>
</section>
<section id="implÃ©mentations" class="level2">
<h2 class="anchored" data-anchor-id="implÃ©mentations">ImplÃ©mentations</h2>
<p>Il existe diffÃ©rentes implÃ©mentations des environnements virtuels en <code>Python</code>, dont chacune ont leurs spÃ©cificitÃ©s et leur communautÃ© dâ€™utilisateurs :</p>
<ul>
<li>Lâ€™implÃ©mentation standard en <code>Python</code> est <code>venv</code>.</li>
<li>Dans le domaine de la <em>data science</em>, lâ€™implÃ©mentation la plus courante est sans doute <code>conda</code>.</li>
</ul>
<p>En pratique, ces implÃ©mentations sont relativement proches. La diffÃ©rence majeure est que <code>conda</code> est Ã  la fois un <em>package manager</em> (comme <code>pip</code>) et un gestionnaire dâ€™environnements virtuels (comme <code>venv</code>).</p>
<p>Pendant longtemps, <code>conda</code> en tant que <em>package manager</em> sâ€™est avÃ©rÃ© trÃ¨s pratique en <em>data science</em>, dans la mesure oÃ¹ il gÃ©rait non seulement les dÃ©pendances <code>Python</code> mais aussi dans dâ€™autres langages â€” comme des dÃ©pendances <code>C</code>. Lâ€™autre diffÃ©rence majeure avec <code>pip</code> est que Conda utilise une mÃ©thode plus avancÃ©e â€” et donc Ã©galement plus coÃ»teuse en temps â€” de rÃ©solution des dÃ©pendances<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. En effet, diffÃ©rents packages peuvent spÃ©cifier diffÃ©rentes versions dâ€™un mÃªme package dont ils dÃ©pendent tous les deux, ce qui provoque un conflit de version. Conda va par dÃ©faut appliquer un algorithme qui vise Ã  gÃ©rer au mieux ces conflits, lÃ  oÃ¹ <code>pip</code> va choisir une approche plus minimaliste. Enfin, la <em>distribution</em> <code>Anaconda</code>, qui contient Ã  la fois <code>Python</code>, <code>conda</code> et beaucoup de <em>packages</em> utiles pour la <em>data science</em>, explique Ã©galement cette popularitÃ© auprÃ¨s des <em>data scientists</em>.</p>
<p>Pour toutes ces raisons, nous allons prÃ©senter lâ€™utilisation de <code>conda</code> comme gestionnaire dâ€™environnements virtuels. Les principes prÃ©sentÃ©s restent nÃ©anmoins valides pour les autres implÃ©mentations.</p>
</section>
<section id="conda" class="level2">
<h2 class="anchored" data-anchor-id="conda">Conda</h2>
<section id="installation" class="level3">
<h3 class="anchored" data-anchor-id="installation">Installation</h3>
<p>Les instructions Ã  suivre pour installer <code>conda</code> sont dÃ©taillÃ©es dans la <a href="https://docs.conda.io/projects/conda/en/latest/user-guide/install/index.html">documentation officielle</a>. <code>conda</code> seul Ã©tant peu utile en pratique, il est gÃ©nÃ©ralement installÃ© dans le cadre de distributions. Les deux plus populaires sont :</p>
<ul>
<li><code>Miniconda</code> : une distribution minimaliste contenant <code>conda</code>, <code>Python</code> ainsi quâ€™un petit nombre de packages techniques trÃ¨s utiles ;</li>
<li><code>Anaconda</code> : une distribution assez volumineuse contenant <code>conda</code>, <code>Python</code>, dâ€™autres logiciels (<code>R</code>, <code>Spyder</code>, etc.) ainsi quâ€™un ensemble de packages utiles pour la <em>data science</em> (<code>SciPy</code>, <code>NumPy</code>, etc.).</li>
</ul>
<p>Le choix de la distribution importe assez peu en pratique, dans la mesure oÃ¹ nous allons de toute maniÃ¨re utiliser des environnements virtuels vierges pour dÃ©velopper nos projets.</p>
<p><strong>Lâ€™Ã©cosystÃ¨me Conda</strong></p>
<p><img src="../conda-eco.png" class="img-fluid"></p>
</section>
<section id="en-pratique" class="level3">
<h3 class="anchored" data-anchor-id="en-pratique">En pratique</h3>
<section id="crÃ©er-un-environnement" class="level4">
<h4 class="anchored" data-anchor-id="crÃ©er-un-environnement">CrÃ©er un environnement</h4>
<p>Pour commencer Ã  utiliser <code>conda</code>, commenÃ§ons par crÃ©er un environnement vierge, nommÃ© <code>dev</code>, en spÃ©cifiant la version de Python que lâ€™on souhaite installer pour notre projet.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> conda create <span class="at">-n</span> dev python=3.9.7</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Collecting</span> package metadata <span class="er">(</span><span class="ex">current_repodata.json</span><span class="kw">)</span><span class="bu">:</span> done</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Solving</span> environment: done</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">## Package Plan ##</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="ex">environment</span> location: /home/coder/local/bin/conda/envs/dev</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="ex">added</span> / updated specs:</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">-</span> python=3.9.7</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> following packages will be downloaded:</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> following NEW packages will be INSTALLED:</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="ex">Proceed</span> <span class="er">(</span><span class="ex">[y]/n</span><span class="kw">)</span><span class="ex">?</span> y</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="ex">Downloading</span> and Extracting Packages</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Comme indiquÃ© dans les logs, <code>Conda</code> a crÃ©Ã© notre environnement et nous indique son emplacement sur le <em>filesystem</em>. En rÃ©alitÃ©, lâ€™environnement nâ€™est jamais vraiment vierge : <code>Conda</code> nous demande â€” et il faut rÃ©pondre oui en tapant <em>â€œyâ€</em> â€” dâ€™installer un certain nombre de packages, qui sont ceux qui viennent avec la distribution <code>Miniconda</code>.</p>
<p>On peut vÃ©rifier que lâ€™environnement a bien Ã©tÃ© crÃ©Ã© en listant les environnements installÃ©s sur le systÃ¨me.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> info <span class="at">--envs</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># conda environments:</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ex">base</span>                    <span class="pp">*</span> /home/coder/local/bin/conda</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="ex">basesspcloud</span>              /home/coder/local/bin/conda/envs/basesspcloud</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="ex">dev</span>                       /home/coder/local/bin/conda/envs/dev</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="activer-un-environnement" class="level4">
<h4 class="anchored" data-anchor-id="activer-un-environnement">Activer un environnement</h4>
<p>Comme plusieurs environnements peuvent coexister sur un mÃªme systÃ¨me, il faut spÃ©cifier Ã  <code>Conda</code> que lâ€™on souhaite utiliser cet environnement pour la session courante du terminal.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> conda activate dev</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>Conda</code> nous indique que lâ€™on travaille Ã  partir de maintenant dans lâ€™environnement <code>dev</code> en indiquant son nom entre parenthÃ¨ses au dÃ©but de la ligne de commandes. Autrement dit, <code>dev</code> devient pour un temps notre environnement par dÃ©faut. Pour sâ€™en assurer, vÃ©rifions avec la commande <code>which</code> lâ€™emplacement de lâ€™interprÃ©teur Python qui sera utilisÃ© si on lance une commande du type <code>python mon-script.py</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">dev</span><span class="kw">)</span> <span class="ex">$</span> which python </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">/home/coder/local/bin/conda/envs/dev/bin/python</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>On travaille bien dans lâ€™environnement attendu : lâ€™interprÃ©teur qui se lance nâ€™est pas celui du systÃ¨me global, mais bien celui spÃ©cifique Ã  notre environnement virtuel.</p>
</section>
<section id="lister-les-packages-installÃ©s" class="level4">
<h4 class="anchored" data-anchor-id="lister-les-packages-installÃ©s">Lister les packages installÃ©s</h4>
<p>Une fois lâ€™environnement activÃ©, on peut lister les packages installÃ©s et leur version. Cela confirme quâ€™un certain nombre de packages sont installÃ©s par dÃ©faut lors de la crÃ©ation dâ€™un environnement virtuel.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">dev</span><span class="kw">)</span> <span class="ex">$</span> conda list</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># packages in environment at /home/coder/local/bin/conda/envs/dev:</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Name                    Version                   Build  Channel</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="ex">_libgcc_mutex</span>             0.1                        main  </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="ex">_openmp_mutex</span>             4.5                       1_gnu  </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="ex">ca-certificates</span>           2022.3.29            h06a4308_0  </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="installer-un-package" class="level4">
<h4 class="anchored" data-anchor-id="installer-un-package">Installer un package</h4>
<p>La syntaxe pour installer un package avec Conda est trÃ¨s similaire Ã  celle de <code>pip</code> :</p>
<pre class="shell"><code>conda install nom_du_package</code></pre>
<p>La diffÃ©rence est que lÃ  oÃ¹ <code>pip install</code> va installer un package Ã  partir du rÃ©pertoire <a href="https://pypi.org/">PyPI</a>, <code>conda install</code> va chercher le package sur les rÃ©pertoires maintenus par les dÃ©veloppeurs de Conda<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. Installons par exemple le package phare de <em>machine learning</em> <code>scikit-learn</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">dev</span><span class="kw">)</span> <span class="ex">$</span> conda install scikit-learn</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Collecting</span> package metadata <span class="er">(</span><span class="ex">current_repodata.json</span><span class="kw">)</span><span class="bu">:</span> done</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Solving</span> environment: done</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">## Package Plan ##</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="ex">environment</span> location: /home/coder/local/bin/conda/envs/dev</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="ex">added</span> / updated specs:</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">-</span> scikit-learn</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>LÃ  encore, Conda nous demande dâ€™installer dâ€™autres packages, qui sont des dÃ©pendances de <code>scikit-learn</code>. Par exemple, la librairie de calcul scientifique <code>NumPy</code>.</p>
<p>Il arrive que des packages disponibles sur le rÃ©pertoire <code>PyPI</code> ne soient pas disponible sur les canaux gÃ©rÃ©s par Conda. Dans ce cas, il est possible dâ€™installer un package dans lâ€™environnement via la commande <code>pip install</code>. Il est nÃ©anmonins toujours prÃ©fÃ©rable de privilÃ©gier une installation via Conda si disponible.</p>
</section>
<section id="exporter-les-spÃ©cifications-de-lenvironnement" class="level4">
<h4 class="anchored" data-anchor-id="exporter-les-spÃ©cifications-de-lenvironnement">Exporter les spÃ©cifications de lâ€™environnement</h4>
<p>DÃ©velopper Ã  partir dâ€™un environnement vierge est une bonne pratique de reproductibilitÃ© : en partant dâ€™une base minimale, on sâ€™assure que seuls les packages effectivement nÃ©cessaires au bon fonctionnement de notre application ont Ã©tÃ© installÃ©s au fur et Ã  mesure du projet.</p>
<p>Cela rend Ã©galement notre projet plus portable : on peut exporter les spÃ©cifications de lâ€™environnement (version de Python, canaux de tÃ©lÃ©chargement des packages, packages installÃ©s et leurs versions) dans un fichier, appelÃ© par convention <code>environment.yml</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">dev</span><span class="kw">)</span> <span class="ex">$</span> conda env export <span class="op">&gt;</span> environment.yml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Ce fichier est mis par convention Ã  la racine du dÃ©pÃ´t <code>Git</code> du projet. Ainsi, les personnes souhaitant tester lâ€™application peuvent recrÃ©er le mÃªme environnement Conda que celui qui a servi au dÃ©veloppement via la commande suivante.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> conda env create <span class="at">-f</span> environment.yml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="changer-denvironnement" class="level4">
<h4 class="anchored" data-anchor-id="changer-denvironnement">Changer dâ€™environnement</h4>
<p>Pour changer dâ€™environnement, il suffit dâ€™en activer un autre.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">dev</span><span class="kw">)</span> <span class="ex">$</span> conda base</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">base</span><span class="kw">)</span> <span class="ex">$</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Pour sortir de tout environnement Conda, on utilise la commande <code>conda deactivate</code> :</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">base</span><span class="kw">)</span> <span class="ex">$</span> conda deactivate</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="supprimer-un-environnement" class="level4">
<h4 class="anchored" data-anchor-id="supprimer-un-environnement">Supprimer un environnement</h4>
<p>Pour supprimer lâ€™environnement <code>dev</code>, on utilise la commande <code>conda env remove -n dev</code>.</p>
</section>
</section>
<section id="aide-mÃ©moire" class="level3">
<h3 class="anchored" data-anchor-id="aide-mÃ©moire">Aide-mÃ©moire</h3>
<table class="table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Commande</th>
<th>Principe</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>conda create -n &lt;env_name&gt; python=&lt;python_version&gt;</code></td>
<td>CrÃ©ation dâ€™un environnement nommÃ© <code>&lt;env_name&gt;</code> dont la version de Python est <code>&lt;python_version&gt;</code></td>
</tr>
<tr class="even">
<td><code>conda info --envs</code></td>
<td>Lister les environnements</td>
</tr>
<tr class="odd">
<td><code>conda activate &lt;env_name&gt;</code></td>
<td>Utiliser lâ€™environnement <code>&lt;env_name&gt;</code> pour la session du terminal</td>
</tr>
<tr class="even">
<td><code>conda list</code></td>
<td>Lister les <em>packages</em> dans lâ€™environnement actif</td>
</tr>
<tr class="odd">
<td><code>conda install &lt;pkg&gt;</code></td>
<td>Installer le <em>package</em> <code>&lt;pkg&gt;</code> dans lâ€™environnement actif</td>
</tr>
<tr class="even">
<td><code>conda env export &gt; environment.yml</code></td>
<td>Exporter les spÃ©cifications de lâ€™environnement dans un fichier <code>environment.yml</code></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="limites" class="level2">
<h2 class="anchored" data-anchor-id="limites">Limites</h2>
<p>DÃ©velopper dans des environnements virtuels est une bonne pratique, car cela accroÃ®t la portabilitÃ© dâ€™une application. NÃ©anmoins, il y a plusieurs limites Ã  leur utilisation :</p>
<ul>
<li>les librairies systÃ¨me nÃ©cessaires Ã  lâ€™installation des packages ne sont pas gÃ©rÃ©es ;</li>
<li>les environnements virtuels ne permettent pas toujours de gÃ©rer des projets faisant intervenir diffÃ©rents langages de programmation ;</li>
<li>devoir installer <code>conda</code>, <code>Python</code>, et les packages nÃ©cessaires Ã  chaque changement dâ€™environnement peut Ãªtre assez long et pÃ©nible en pratique ;</li>
<li>dans un environnement de production, gÃ©rer des environnements virtuels diffÃ©rents pour chaque projet peut sâ€™avÃ©rer rapidement complexe pour les administrateurs systÃ¨me.</li>
</ul>
<p>La technologie des conteneurs permet de rÃ©pondre Ã  ces diffÃ©rents problÃ¨mes.</p>
</section>
</section>
<section id="les-conteneurs" class="level1">
<h1>Les conteneurs ğŸ‹</h1>
<section id="introduction-1" class="level2">
<h2 class="anchored" data-anchor-id="introduction-1">Introduction</h2>
<p>Avec les environnements virtuels, lâ€™idÃ©e Ã©tait de permettre Ã  chaque utilisateur potentiel de notre projet dâ€™installer sur son environnement dâ€™exÃ©cution les packages nÃ©cessaires Ã  la bonne exÃ©cution du projet. NÃ©anmoins, comme on lâ€™a vu, cette approche ne garantit pas une reproductibilitÃ© parfaite et a lâ€™inconvÃ©nient de nÃ©cessiter beaucoup de gestion manuelle.</p>
<p>Changeons de perspective : <em>au lieu de distribuer une recette permettant Ã  lâ€™utilisateur de recrÃ©er lâ€™environnement nÃ©cessaire sur sa machine, ne pourrait-on pas directement distribuer Ã  lâ€™utilisateur une machine contenant lâ€™environnement prÃ©-configurÃ© ?</em></p>
<p>Bien entendu, on ve pas configurer et envoyer des ordinateurs portables Ã  tous les utilisateurs potentiels dâ€™un projet. Une autre solution serait de distribuer des machines virtuelles, qui tournent sur un serveur et simulent un vÃ©ritable ordinateur. Ces machines ont cependant lâ€™inconvÃ©nient dâ€™Ãªtre assez lourdes, et complexes Ã  rÃ©pliquer et distribuer. Pour pallier ces diffÃ©rentes limites, on va utiliser la technologie des conteneurs.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://external-preview.redd.it/aR6WdUcsrEgld5xUlglgKX_0sC_NlryCPTXIHk5qdu8.jpg?auto=webp&amp;s=5fe64dd318eec71711d87805d43def2765dd83cd" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p><em>Image trouvÃ©e sur <a href="https://www.reddit.com/r/ProgrammerHumor/comments/cw58z7/it_works_on_my_machine/">reddit</a></em></p>
</section>
<section id="fonctionnement-1" class="level2">
<h2 class="anchored" data-anchor-id="fonctionnement-1">Fonctionnement</h2>
<p>Comme les machines virtuelles, les conteneurs permettent dâ€™empaqueter complÃ¨tement lâ€™environnement (librairies systÃ¨mes, application, configuration) qui permet de faire tourner lâ€™application. Mais Ã  lâ€™inverse dâ€™une machine virtuelle, le conteneur nâ€™inclut pas de systÃ¨me dâ€™exploitation propre, il utilise celui de la machine hÃ´te qui lâ€™exÃ©cute. La technologie des conteneurs permet ainsi de garantir une trÃ¨s forte reproductibilitÃ© tout en restant suffisamment lÃ©gÃ¨re pour permettre une distribution et un dÃ©ploiement simple aux utilisateurs.</p>
<p><strong>DiffÃ©rences entre lâ€™approche conteneurs (gauche) et lâ€™approche machines virtuelles (droite)</strong></p>
<p><img src="../docker-vm.png" class="img-fluid"></p>
<p>Source : <a href="https://www.docker.com/resources/what-container/">docker.com</a></p>
</section>
<section id="implÃ©mentations-1" class="level2">
<h2 class="anchored" data-anchor-id="implÃ©mentations-1">ImplÃ©mentations</h2>
<p>Comme pour les environnements virtuels, il existe diffÃ©rentes implÃ©mentations de la technologie des conteneurs. En pratique, lâ€™implÃ©mentation offerte par <code>Docker</code> est devenue largement prÃ©dominante, au point quâ€™il est devenu courant dâ€™utiliser de maniÃ¨re interchangeable les termes <em>â€œconteneuriserâ€</em> et <em>â€œDockeriserâ€</em> une application. Câ€™est donc cette implÃ©mentation que nous allons Ã©tudier et utiliser dans ce cours.</p>
</section>
<section id="docker" class="level2">
<h2 class="anchored" data-anchor-id="docker">Docker <i class="fab fa-docker"></i></h2>
<section id="installation-1" class="level3">
<h3 class="anchored" data-anchor-id="installation-1">Installation</h3>
<p>Les instructions Ã  suivre pour installer <code>Docker</code> <i class="fab fa-docker"></i> selon son systÃ¨me dâ€™exploiration sont dÃ©taillÃ©es dans la <a href="https://docs.docker.com/get-docker/">documentation officielle</a>. Il existe Ã©galement des environnements bacs Ã  sable en ligne comme <a href="https://labs.play-with-docker.com">Play with Docker</a>.</p>
</section>
<section id="principes" class="level3">
<h3 class="anchored" data-anchor-id="principes">Principes</h3>
<p>Un conteneur Docker est mis Ã  disposition sous la forme dâ€™une <strong>image</strong>, câ€™est Ã  dire dâ€™un fichier binaire qui contient lâ€™environnement nÃ©cessaire Ã  lâ€™exÃ©cution de lâ€™application.</p>
<p>Pour construire (<em>build</em>) lâ€™image, on utilise un <code>Dockerfile</code>, un fichier texte qui contient la recette â€” sous forme de commandes Linux â€” de construction de lâ€™environnement. Lâ€™image va Ãªtre uploadÃ©e (<em>push</em>) sur un dÃ©pÃ´t (<em>registry</em>), public ou privÃ©, depuis lequel les utilisateurs vont pouvoir tÃ©lÃ©charger lâ€™image (<em>pull</em>). Le moteur Docker permet ensuite de lancer (<em>run</em>) un <strong>conteneur</strong>, câ€™est Ã  dire une instance vivante de lâ€™image.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Le rÃ©pertoire dâ€™images publiques le plus connu est <a href="https://hub.docker.com/"><code>DockerHub</code></a>. Il sâ€™agit dâ€™un rÃ©pertoire oÃ¹ nâ€™importe qui peut proposer une image <code>Docker</code>, associÃ©e ou non Ã  un projet disponible sur <code>Github</code> ou <code>Gitlab</code>. Il est possible de mettre Ã  disposition de maniÃ¨re manuelle des images mais, comme nous le montrerons dans le chapitre sur la <a href="../chapters/deployment.html">mise en production</a>, il est beaucoup plus pratique dâ€™utiliser des fonctionalitÃ©s dâ€™interaction automatique entre <code>DockerHub</code> et un dÃ©pÃ´t <code>GitHub</code>.</p>
</div>
</div>
</section>
<section id="en-pratique-1" class="level3">
<h3 class="anchored" data-anchor-id="en-pratique-1">En pratique</h3>
<section id="application" class="level4">
<h4 class="anchored" data-anchor-id="application">Application</h4>
<p>Afin de prÃ©senter lâ€™utilisation de <code>Docker</code> en pratique, nous allons prÃ©senter les diffÃ©rentes Ã©tapes permettant de <em>â€œdockeriserâ€</em> une application web minimaliste construite avec le <em>framework</em> <code>Python</code> <a href="https://flask.palletsprojects.com/en/2.1.x/"><code>Flask</code></a><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>.</p>
<p>La structure de notre projet est la suivante.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">â”œâ”€â”€</span> myflaskapp</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="ex">â”‚</span>   â”œâ”€â”€ Dockerfile</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="ex">â”‚</span>   â”œâ”€â”€ hello-world.py</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="ex">â”‚</span>   â””â”€â”€ requirements.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Le script <code>hello-world.py</code> contient le code dâ€™une application minimaliste, qui affiche simplement <em>â€œHello, World!â€</em> sur une page web.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> flask <span class="im">import</span> Flask</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> Flask(<span class="va">__name__</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">"/"</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hello_world():</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"&lt;p&gt;Hello, World!&lt;/p&gt;"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Pour faire tourner lâ€™application, il nous faut donc Ã  la fois <code>Python</code> et le package <code>Flask</code>. Ces installations doivent Ãªtre spÃ©cifiÃ©es dans le <code>Dockerfile</code> (cf.&nbsp;<a href="#dockerfile">section suivante</a>). Lâ€™installation de <code>Flask</code> se fait via un fichier <code>requirements.txt</code>, qui contient juste la ligne suivante :</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="va">Flask</span><span class="op">=</span>=2.1.1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="dockerfile" class="level4">
<h4 class="anchored" data-anchor-id="dockerfile">Le <code>Dockerfile</code></h4>
<p>A lÃ  base de chaque image <code>Docker</code> se trouve un <code>Dockerfile</code>. Câ€™est un fichier texte qui contient une sÃ©rie de commandes qui permettent de construire lâ€™image. Ces fichiers peuvent Ãªtre plus ou moins complexes selon lâ€™application que lâ€™on cherche Ã  conteneuriser, mais leur structure est assez normalisÃ©e. Pour sâ€™en rendre compte, analysons ligne Ã  ligne le <code>Dockerfile</code> nÃ©cessaire pour construire une image <code>Docker</code> de notre application <code>Flask.</code></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">FROM</span> ubuntu:20.04</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> apt-get update <span class="at">-y</span> <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">apt-get</span> install <span class="at">-y</span> python3-pip python3-dev</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="ex">WORKDIR</span> /app</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="ex">COPY</span> requirements.txt /app/requirements.txt</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> pip install <span class="at">-r</span> requirements.txt</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="ex">COPY</span> . /app</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="ex">ENV</span> FLASK_APP=<span class="st">"hello-world.py"</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="ex">EXPOSE</span> 5000</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="ex">CMD</span> [<span class="st">"flask"</span>, <span class="st">"run"</span>, <span class="st">"--host=0.0.0.0"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>FROM</code> : spÃ©cifie lâ€™image de base. Une image Docker hÃ©rite toujours dâ€™une image de base. Ici, on choisit lâ€™image <code>Ubuntu</code> version <code>20.04</code>, tout va donc se passer comme si lâ€™on dÃ©veloppait sur une machine virtuelle vierge ayant pour systÃ¨me dâ€™exploitation <code>Ubuntu 20.04</code><a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> ;</li>
<li><code>RUN</code> : lance une commande Linux. Ici, on met dâ€™abord Ã  jour la liste des packages tÃ©lÃ©chargeables via <code>apt</code>, puis on installe <code>Python</code> ainsi que des librairies systÃ¨me nÃ©cessaires au bon fonctionnement de notre application ;</li>
<li><code>WORKDIR</code> : spÃ©cifie le rÃ©pertoire de travail de lâ€™image. Ainsi, toutes les commandes suivantes seront exÃ©cutÃ©es depuis ce rÃ©pertoire ;</li>
<li><code>COPY</code> : copie un fichier local sur lâ€™image <code>Docker</code>. Ici, on copie dâ€™abord le fichier <code>requirements.txt</code> du projet, qui spÃ©cifie les dÃ©pendances <code>Python</code> de notre application, puis on les installe avec une commande <code>RUN</code>. La seconde instruction <code>COPY</code> copie le rÃ©pertoire du projet sur lâ€™image ;</li>
<li><code>ENV</code> : crÃ©e une variable dâ€™environnement qui sera accessible Ã  lâ€™application dans le conteneur. Ici, on dÃ©finit une variable dâ€™environnement attendue par <code>Flask</code>, qui spÃ©cifie le nom du script permettant de lancer lâ€™application ;</li>
<li><code>EXPOSE</code> : informe <code>Docker</code> que le conteneur â€œÃ©couteâ€ sur le port 5000, qui est le port par dÃ©faut utilisÃ© par le serveur web de <code>Flask</code> ;</li>
<li><code>CMD</code> : spÃ©cifie la commande que doit exÃ©cuter le conteneur lors de son lancement. Il sâ€™agit dâ€™une liste, qui contient les diffÃ©rentes parties de la commande sous forme de chaÃ®nes de caractÃ¨res. Ici, on lance <code>Flask</code>, qui sait automatiquement quelle application lancer du fait de la commande <code>ENV</code> spÃ©cifiÃ©e prÃ©cÃ©demment.</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Avec la premiÃ¨re commande <code>RUN</code> du <code>Dockerfile</code>, nous installons <code>Python</code> mais aussi des librairies systÃ¨me nÃ©cessaires au bon fonctionnement de lâ€™application. Mais comment les avons-nous trouvÃ©es ?</p>
<p>Par essai et erreur. Lors de lâ€™Ã©tape de <a href="#build">build</a> que lâ€™on verra juste aprÃ¨s, le moteur <code>Docker</code> va essayer de construire lâ€™image selon les spÃ©cifications du <code>Dockerfile</code>, comme sâ€™il partait dâ€™un ordinateur vide contenant simplement <code>Ubuntu 20.04</code>. Si des librairies manquent, le processus de <em>build</em> devrait renvoyer une erreur, qui sâ€™affichera dans les <em>logs</em> de lâ€™application, affichÃ©s par dÃ©faut dans la console. Quand on a de la chance, les logs dÃ©crivent explicitement les librairies systÃ¨me manquantes. Mais souvent, les messages dâ€™erreur ne sont pas trÃ¨s explicites, et il faut alors les copier dans un moteur de recherche bien connu pour trouver la rÃ©ponse, souvent sur <a href="https://stackoverflow.com/">Stackoverflow</a>.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>La recette prÃ©sente dans le <code>Dockerfile</code> peut nÃ©cessiter lâ€™utilisation de fichiers appartenant au dossier de travail. Pour que <code>Docker</code> les trouve dans son contexte, il est nÃ©cessaire dâ€™introduire une commande <code>COPY</code>. Câ€™est un petit peu comme pour la cuisine: pour utiliser un produit dans une recette, il faut le sortir du frigo (fichier local) et le mettre sur la table.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Nous nâ€™avons vu que les commandes <code>Docker</code> les plus frÃ©quentes, il en existe beaucoup dâ€™autres en pratique. Nâ€™hÃ©sitez pas Ã  consulter la <a href="https://docs.docker.com/engine/reference/builder/">documentation officielle</a> pour comprendre leur utilisation.</p>
</div>
</div>
</section>
<section id="build" class="level4">
<h4 class="anchored" data-anchor-id="build">Construction dâ€™une image Docker</h4>
<p>Pour construire une image Ã  partir dâ€™un <code>Dockerfile</code>, il suffit dâ€™utiliser la commande <code>docker build</code>. Il faut ensuite spÃ©cifier deux Ã©lÃ©ments importnats : - le <em>build context</em>. Il faut indiquer Ã  <code>Docker</code> le chemin de notre projet, qui doit contenir le <code>Dockerfile</code>. En pratique, il est plus simple de se mettre dans le dossier du projet via la commande <code>cd</code>, puis de passer <code>.</code> comme <em>build context</em> pour indiquer Ã  <code>Docker</code> de <em>build</em> â€œdâ€™iciâ€ ; - le <em>tag</em>, câ€™est Ã  dire le nom de lâ€™image. Tant que lâ€™on utilisee <code>Docker</code> en local, le <em>tag</em> importe peu. On verra par la suite que la structure du <em>tag</em> a de lâ€™importance lorsque lâ€™on souhaite <a href="#imp-docker">exporter</a> ou <a href="#exp-docker">importer</a> une image <code>Docker</code> Ã  partir dâ€™un dÃ©pÃ´t distant.</p>
<p>Regardons ce qui se passe en pratique lorsque lâ€™on essaie de construire notre image.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker build <span class="at">-t</span> myflaskapp .</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Sending</span> build context to Docker daemon     47MB</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Step</span> 1/8 : FROM ubuntu:20.04</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a> <span class="ex">---</span><span class="op">&gt;</span> 825d55fb6340</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Step</span> 2/8 : RUN apt-get update <span class="kw">&amp;&amp;</span> <span class="ex">apt-get</span> install <span class="at">-y</span> python3-pip python3-dev</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a> <span class="ex">---</span><span class="op">&gt;</span> Running in 92b42d579cfa</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="ex">done.</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Removing</span> intermediate container 92b42d579cfa</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a> <span class="ex">---</span><span class="op">&gt;</span> 8826d53e3c01</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="ex">Step</span> 3/8 : WORKDIR /app</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a> <span class="ex">---</span><span class="op">&gt;</span> Running in 153b32893c23</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="ex">Removing</span> intermediate container 153b32893c23</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a> <span class="ex">---</span><span class="op">&gt;</span> 7b4d22021986</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Step</span> 4/8 : COPY requirements.txt /app/requirements.txt</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="ex">Successfully</span> built 125bd8da70ff</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="ex">Successfully</span> tagged myflaskapp:latest</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Le moteur <code>Docker</code> essaie de construire notre image sÃ©quentiellement Ã  partir des commandes spÃ©cifiÃ©es dans le <code>Dockerfile</code>. Sâ€™il rencontre une erreur, la procÃ©dure sâ€™arrÃªte, et il faut alors trouver la source du problÃ¨me dans les <em>logs</em> et adapter le <code>Dockerfile</code> en consÃ©quence. Si tout se passe bien, <code>Docker</code> nous indique que le <em>build</em> a rÃ©ussi et lâ€™image est prÃªte Ã  Ãªtre utilisÃ©e. On peut vÃ©rifier que lâ€™image est bien disponible Ã  lâ€™aide de la commande <code>docker images</code>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker images</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="ex">REPOSITORY</span>                               TAG       IMAGE ID       CREATED          SIZE</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="ex">myflaskapp</span>                               latest    57d2f410a631   2 hours ago      433MB</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>IntÃ©ressons nous un peu plus en dÃ©tail aux <em>logs</em> de lâ€™Ã©tape de <em>build</em>. Entre les Ã©tapes, <code>Docker</code> affiche des suites de lettres et de chiffres un peu Ã©sotÃ©riques, et nous parle de conteneurs intermÃ©diaires. En fait, il faut voir une image <code>Docker</code> comme un empilement de couches (<em>layers</em>), qui sont elles-mÃªmes des images <code>Docker</code>. Quand on hÃ©rite dâ€™une image avec lâ€™instruction <code>FROM</code>, on spÃ©cifie donc Ã  <code>Docker</code> la couche initiale, sur laquelle il va construire le reste de notre environnement. A chaque Ã©tape sa nouvelle couche, et Ã  chaque couche son <em>hash</em>, un identifiant unique fait de lettres et de chiffres.</p>
<p>Cela peut ressembler Ã  des dÃ©tails techniques, mais câ€™est en fait extrÃªmement utile en pratique car cela permet Ã  <code>Docker</code> de faire du <em>caching</em>. Lorsque lâ€™on dÃ©veloppe un <code>Dockerfile</code>, il est frÃ©quent de devoir modifier ce dernier de nombreuses fois avant de trouver la bonne recette, et on aimerait bien ne pas avoir Ã  <em>rebuild</em> lâ€™environnement complet Ã  chaque fois. <code>Docker</code> gÃ¨re cela trÃ¨s bien : il <em>cache</em> chacune des couches intermÃ©diaires. Par exemple, si lâ€™on modifie la 5Ã¨me commande du <code>Dockerfile</code>, <code>Docker</code> va utiliser le cache pour ne pas avoir Ã  recalculer les Ã©tapes prÃ©cÃ©dentes, qui nâ€™ont pas changÃ©. Cela sâ€™appelle lâ€™<em>â€œinvalidation du cacheâ€</em> : dÃ¨s lors quâ€™une Ã©tape du <code>Dockerfile</code> est modifiÃ©e, <code>Docker</code> va recalculer toutes les Ã©tapes suivantes, mais seulement celles-ci. ConsÃ©quence directe de cette observation : il faut toujours ordonner les Ã©tapes dâ€™un <code>Dockerfile</code> de sorte Ã  ce qui est le plus susceptible dâ€™Ãªtre souvent modifiÃ© soit Ã  la fin du fichier, et inversement.</p>
<p>Pour illustrer cela, regardons ce qui se passe si lâ€™on modifie le nom du script qui lance lâ€™application, et donc la valeur de la variable dâ€™environnement <code>FLASK_APP</code> dans le <code>Dockerfile</code>.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker build . <span class="at">-t</span> myflaskapp</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Sending</span> build context to Docker daemon  4.096kB</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Step</span> 1/10 : FROM ubuntu:20.04</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a> <span class="ex">---</span><span class="op">&gt;</span> 825d55fb6340</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Step</span> 2/10 : ENV DEBIAN_FRONTEND=noninteractive</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a> <span class="ex">---</span><span class="op">&gt;</span> Using cache</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a> <span class="ex">---</span><span class="op">&gt;</span> ea1c7c083ac9</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Step</span> 3/10 : RUN apt-get update <span class="at">-y</span> <span class="kw">&amp;&amp;</span>     <span class="ex">apt-get</span> install <span class="at">-y</span> python3-pip python3-dev</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a> <span class="ex">---</span><span class="op">&gt;</span> Using cache</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a> <span class="ex">---</span><span class="op">&gt;</span> 078b8ac0e1cb</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="ex">Step</span> 4/10 : WORKDIR /app</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a> <span class="ex">---</span><span class="op">&gt;</span> Using cache</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a> <span class="ex">---</span><span class="op">&gt;</span> cd19632825b3</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="ex">Step</span> 5/10 : COPY requirements.txt /app/requirements.txt</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a> <span class="ex">---</span><span class="op">&gt;</span> Using cache</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a> <span class="ex">---</span><span class="op">&gt;</span> 271cd1686899</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="ex">Step</span> 6/10 : RUN pip install <span class="at">-r</span> requirements.txt</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a> <span class="ex">---</span><span class="op">&gt;</span> Using cache</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a> <span class="ex">---</span><span class="op">&gt;</span> 3ea406fdf383</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="ex">Step</span> 7/10 : COPY . /app</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a> <span class="ex">---</span><span class="op">&gt;</span> 3ce5bd3a9572</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="ex">Step</span> 8/10 : ENV FLASK_APP=<span class="st">"new.py"</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a> <span class="ex">---</span><span class="op">&gt;</span> Running in b378d16bb605</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="ex">Removing</span> intermediate container b378d16bb605</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a> <span class="ex">---</span><span class="op">&gt;</span> e1f50490287b</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="ex">Step</span> 9/10 : EXPOSE 5000</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a> <span class="ex">---</span><span class="op">&gt;</span> Running in ab53c461d3de</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="ex">Removing</span> intermediate container ab53c461d3de</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a> <span class="ex">---</span><span class="op">&gt;</span> 0b86eca40a80</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="ex">Step</span> 10/10 : CMD [<span class="st">"flask"</span>, <span class="st">"run"</span>, <span class="st">"--host=0.0.0.0"</span>]</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a> <span class="ex">---</span><span class="op">&gt;</span> Running in 340eec151a51</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a><span class="ex">Removing</span> intermediate container 340eec151a51</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a> <span class="ex">---</span><span class="op">&gt;</span> 16d7a5b8db28</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a><span class="ex">Successfully</span> built 16d7a5b8db28</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="ex">Successfully</span> tagged myflaskapp:latest</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Lâ€™Ã©tape de <em>build</em> a pris quelques secondes au lieu de plusieurs minutes, et les <em>logs</em> montrent bien lâ€™utilisation du cache faite par <code>Docker</code> : les Ã©tapes prÃ©cÃ©dant le changement rÃ©utilisent les couches cachÃ©es, mais celle dâ€™aprÃ¨s sont recalculÃ©es.</p>
</section>
<section id="execution" class="level4">
<h4 class="anchored" data-anchor-id="execution">ExÃ©cuter une image <code>Docker</code></h4>
<p>Lâ€™Ã©tape de <em>build</em> a permis de crÃ©er une <em>image</em> <code>Docker</code>. Une image doit Ãªtre vue comme un <em>template</em> : elle permet dâ€™exÃ©cuter lâ€™application sur nâ€™importe quel environnement dâ€™exÃ©cution sur lequel un moteur <code>Docker</code> est installÃ©. En lâ€™Ã©tat, on a donc juste <em>construit</em>, mais rien <em>lancÃ©</em> : notre application ne tourne pas encore. Pour cela, il faut crÃ©er un <em>conteneur</em>, i.e.&nbsp;une instance vivante de lâ€™image qui permet dâ€™accÃ©der Ã  lâ€™application. Cela se fait via la commande <code>docker run</code>.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker run <span class="at">-d</span> <span class="at">-p</span> 8000:5000 myflaskapp:latest</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="ex">6a2ab0d82d051a3829b182ede7b9152f7b692117d63fa013e7dfe6232f1b9e81</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>DÃ©taillons la syntaxe de cette commande :</p>
<ul>
<li><code>docker run tag</code> : lance lâ€™image dont on fournit le <em>tag</em>. Le <em>tag</em> est de la forme <code>repository/projet:version</code>. Ici, il nâ€™y a pas de <em>repository</em> puisque tout est fait en local ;</li>
<li><code>-d</code> : â€œdÃ©tacheâ€ le conteneur du terminal qui le lance ;</li>
<li><code>-p</code> : effectue un <em>mapping</em> entre un port de la machine qui exÃ©cute le conteneur, et le conteneur lui-mÃªme. Notre conteneur Ã©coute sur le port 5000, et lâ€™on veut que notre application soit exposÃ©e sur le port 8000 de notre machine.</li>
</ul>
<p>Lorsque lâ€™on exÃ©cute <code>docker run</code>, <code>Docker</code> nous rÃ©pond simplement un <em>hash</em> qui identifie le conteneur que lâ€™on a lancÃ©. On peut vÃ©rifier quâ€™il tourne bien avec la commande <code>docker ps</code>, qui renvoie toutes les informations associÃ©es au conteneur.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker ps</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="ex">CONTAINER</span> ID   IMAGE        COMMAND                  CREATED         STATUS         PORTS                                   NAMES</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="ex">6a2ab0d82d05</span>   myflaskapp   <span class="st">"flask run --host=0.â€¦"</span>   7 seconds ago   Up 6 seconds   0.0.0.0:8000-<span class="op">&gt;</span>5000/tcp, :::8000-<span class="op">&gt;</span>5000/tcp   vigorous_kalam</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Les conteneurs peuvent Ãªtre utilisÃ©s pour rÃ©aliser des tÃ¢ches trÃ¨s diffÃ©rentes. GrossiÃ¨rement, on peut distinguer deux situations :</p>
<ul>
<li>le conteneur effectue une tÃ¢che â€œone-shotâ€, câ€™est Ã  dire une opÃ©ration qui a vocation Ã  sâ€™effectuer en un certain temps, suite Ã  quoi le conteneur peut sâ€™arrÃªter ;</li>
<li>le conteneur exÃ©cute une application. Dans ce cas, on souhaite que le conteneur reste en vie aussi longtemps que lâ€™on souhaite utiliser lâ€™application en question.</li>
</ul>
<p>Dans notre cas dâ€™application, on se situe dans la seconde configuration puisque lâ€™on veut exÃ©cuter une application web. Lorsque lâ€™application tourne, elle expose sur le <em>localhost</em>, accessible depuis un navigateur web â€” en lâ€™occurence, Ã  lâ€™adresse <a href="localhost:8000/">localhost:8000/</a>. Les calculs sont effectuÃ©s sur un serveur local, et le navigateur sert dâ€™interface avec lâ€™utilisateur â€” comme lorsque vous utilisez un notebook <code>Jupyter</code> par exemple.</p>
<p>Finalement, on a pu dÃ©velopper et exÃ©cuter une application complÃ¨te sur notre environnement local, sans avoir eu Ã  installer quoi que ce soit sur notre machine personnelle, Ã  part <code>Docker.</code></p>
</section>
<section id="exp-docker" class="level4">
<h4 class="anchored" data-anchor-id="exp-docker">Exporter une image <code>Docker</code></h4>
<p>Jusquâ€™Ã  maintenant, toutes les commandes <code>Docker</code> que nous avons exÃ©cutÃ©es se sont passÃ©es en local. Ce mode de fonctionnement peut Ãªtre intÃ©ressant pour la phase de dÃ©veloppement. Mais comme on lâ€™a vu, un des gros avantages de <code>Docker</code> est la facilitÃ© de redistribution des images construites, qui peuvent ensuite Ãªtre utilisÃ©es par de nombreux utilisateurs pour faire tourner notre application. Pour cela, il nous faut uploader notre image sur un dÃ©pÃ´t distant, Ã  partir duquel les utilisateurs pourront la tÃ©lÃ©charger.</p>
<p>Plusieurs possibilitÃ©s existent selon le contexte de travail : une entreprise peut avoir un dÃ©pÃ´t interne par exemple. Si le projet est open-source, on peut utiliser le <a href="https://hub.docker.com/">DockerHub</a>. Le <em>workflow</em> pour uploader une image est le suivant : - crÃ©er un compte sur le DockerHub ; - crÃ©er un projet (public) sur le DockerHub, qui va hÃ©berger les images <code>Docker</code> du projet ; - sur un terminal, utiliser <code>docker login</code> pour sâ€™authentifier au <code>DockerHub</code> ; - on va modifier le <em>tag</em> que lâ€™on fournit lors du <em>build</em> pour spÃ©cifier le chemin attendu. Dans notre cas : <code>docker build -t compte/projet:version .</code> ; - uploader lâ€™image avec <code>docker push compte/projet:version</code></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker push avouacr/myflaskapp:1.0.0</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> push refers to repository <span class="pp">[</span><span class="ss">docker.io/avouacr/myflaskapp</span><span class="pp">]</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="ex">71db96687fe6:</span> Pushed </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="ex">624877ac887b:</span> Pushed </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="ex">ea4ab6b86e70:</span> Pushed </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="ex">b5120a5bc48d:</span> Pushed </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="ex">5fa484a3c9d8:</span> Pushed </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="ex">c5ec52c98b31:</span> Pushed </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="ex">1.0.0:</span> digest: sha256:b75fe53fd1990c3092ec41ab0966a9fbbb762f3047957d99327cc16e27c68cc9 size: 1574</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="imp-docker" class="level4">
<h4 class="anchored" data-anchor-id="imp-docker">Importer une image <code>Docker</code></h4>
<p>En supposant que le dÃ©pÃ´t utilisÃ© pour uploader lâ€™image est public, la procÃ©dure que doit suivre un utilisateur pour la tÃ©lÃ©charger se rÃ©sume Ã  utiliser la commande <code>docker pull compte/projet:version</code></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker pull avouacr/myflaskapp:1.0.0</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="ex">1.0.0:</span> Pulling from avouacr/myflaskapp</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="ex">e0b25ef51634:</span> Pull complete </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="ex">c0445e4b247e:</span> Pull complete </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="ex">48ba4e71d1c2:</span> Pull complete </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="ex">ffd728caa80a:</span> Pull complete </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="ex">906a95f00510:</span> Pull complete </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="ex">d7d49b6e17ab:</span> Pull complete </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Digest:</span> sha256:b75fe53fd1990c3092ec41ab0966a9fbbb762f3047957d99327cc16e27c68cc9</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Status:</span> Downloaded newer image for avouacr/myflaskapp:1.0.0</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="ex">docker.io/avouacr/myflaskapp:1.0.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>Docker</code> tÃ©lÃ©charge et extrait chacune des couches qui constituent lâ€™image (ce qui peut parfois Ãªtre long). Lâ€™utilisateur peut alors crÃ©er un conteneur Ã  partir de lâ€™image, en utilisant <code>docker run</code> comme illustrÃ© prÃ©cÃ©demment.</p>
</section>
</section>
<section id="aide-mÃ©moire-1" class="level3">
<h3 class="anchored" data-anchor-id="aide-mÃ©moire-1">Aide-mÃ©moire</h3>
<p>Voici une premiÃ¨re aide-mÃ©moire sur les principales commandes Ã  intÃ©grer dans un <code>Dockerfile</code>:</p>
<table class="table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Commande</th>
<th>Principe</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>FROM &lt;image&gt;:&lt;tag&gt;</code></td>
<td>Utiliser comme point de dÃ©part lâ€™image <code>&lt;image&gt;</code> ayant le tag <code>&lt;tag&gt;</code></td>
</tr>
<tr class="even">
<td><code>RUN &lt;instructions&gt;</code></td>
<td>Utiliser la suite dâ€™instructions <code>&lt;instructions&gt;</code> dans un terminal <code>Linux</code>. Pour passer plusieurs commandes dans un <code>RUN</code>, utiliser <code>&amp;&amp;</code>. Cette suite de commande peut avoir plusieurs lignes, dans ce cas, mettre <code>\</code> en fin de ligne</td>
</tr>
<tr class="odd">
<td><code>COPY &lt;source&gt; &lt;dest&gt;</code></td>
<td>RÃ©cupÃ©rer le fichier prÃ©sent dans le systÃ¨me de fichier local Ã  lâ€™emplacement <code>&lt;source&gt;</code> pour que les instructions ultÃ©rieures puissent le trouver Ã  lâ€™emplacement <code>&lt;source&gt;</code></td>
</tr>
<tr class="even">
<td><code>ADD &lt;source&gt; &lt;dest&gt;</code></td>
<td>Globalement, mÃªme rÃ´le que <code>COPY</code></td>
</tr>
<tr class="odd">
<td><code>ENV MY_NAME="John Doe"</code></td>
<td>CrÃ©ation dâ€™une variable dâ€™environnement (qui devient disponible sous lâ€™alias <code>$MY_NAME</code>)</td>
</tr>
<tr class="even">
<td><code>WORKDIR &lt;path&gt;</code></td>
<td>DÃ©finir le <em>working directory</em> du conteuneur Docker dans le dossier <code>&lt;path&gt;</code></td>
</tr>
<tr class="odd">
<td><code>USER &lt;username&gt;</code></td>
<td>CrÃ©ation dâ€™un utilisateur non <em>root</em> nommÃ© <code>&lt;username&gt;</code></td>
</tr>
<tr class="even">
<td><code>EXPOSE &lt;PORT_ID&gt;</code></td>
<td>Lorsquâ€™elle tournera, lâ€™application sera disponible depuis le port <code>&lt;PORT_ID&gt;</code></td>
</tr>
<tr class="odd">
<td><code>CMD ["executable","param1","param2"]</code></td>
<td>Au lancement de lâ€™instance Docker la commande <code>executable</code> (par exemple <code>python3</code>) sera lancÃ©e avec les paramÃ¨tres additionnels fournis</td>
</tr>
</tbody>
</table>
<p>Une seconde aide-mÃ©moire pour les principales commandes <code>Linux</code> est disponible ci-dessous:</p>
<table class="table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Commande</th>
<th>Principe</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>docker build . -t &lt;tag&gt;</code></td>
<td>Construire lâ€™image <code>Docker</code> Ã  partir des fichiers dans le rÃ©pertoire courant (<code>.</code>) en lâ€™identifiant avec le tag <code>&lt;tag&gt;</code></td>
</tr>
<tr class="even">
<td><code>docker run -it &lt;tag&gt;</code></td>
<td>Lancer lâ€™instance docker identifiÃ©e par <code>&lt;tag&gt;</code></td>
</tr>
<tr class="odd">
<td><code>docker images</code></td>
<td>Lister les images disponibles sur la machine et quelques unes de leurs propriÃ©tÃ©s (tags, volume, etc.)</td>
</tr>
<tr class="even">
<td><code>docker system prune</code></td>
<td>Faire un peu de mÃ©nage dans ses images <code>Docker</code> (bien rÃ©flÃ©chir avant de faire tourner cette commande)</td>
</tr>
</tbody>
</table>


</section>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>La lenteur de lâ€™installation des packages dans les environnements <code>conda</code> par rapport Ã  <code>pip</code> et lâ€™accÃ¨s de plus en plus frÃ©quent Ã  des <a href="https://pythonwheels.com/"><em>wheels</em></a> a permis un retour en grÃ¢ce des environnements virtuels implÃ©mentÃ©s par <code>venv</code>. Une autre alternative populaire est <a href="https://mamba.readthedocs.io/en/latest/"><code>mamba</code></a>, une rÃ©implÃ©mentation de <code>Conda</code> en <code>C++</code> qui utilise un <em>solver</em> bien plus efficace. En proposant celui-ci, le projet <code>mamba</code> vise Ã  pallier lâ€™un des irritants principaux de <code>conda</code>, Ã  savoir la lenteur du <em>solver</em>.<a href="#fnref1" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn2"><p>Ces rÃ©pertoires sont, dans le langage <code>conda</code> les <em>canaux</em>. Le canal par dÃ©faut est maintenu par les dÃ©veloppeurs d<code>Anaconda</code>. Cependant, pour en assurer la stabilitÃ©, ce canal a une forte inertie. La <code>conda-forge</code> a Ã©mergÃ© pour offrir plus de flexibilitÃ© aux dÃ©veloppeurs de <em>package</em> qui peuvent ainsi mettre Ã  disposition des versions plus rÃ©centes de leurs packages, comme sur <a href="https://pypi.org/">PyPI</a>.<a href="#fnref2" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn3"><p><a href="https://flask.palletsprojects.com/en/2.1.x/"><code>Flask</code></a> est un <em>framework</em> permettant de dÃ©ployer, de maniÃ¨re lÃ©gÃ¨re, des applications reposant sur <code>Python</code>.<a href="#fnref3" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn4"><p>Dans lâ€™idÃ©al, on essaie de partir dâ€™une couche la plus petite possible pour limiter la taille de lâ€™image finalement obtenue. Il nâ€™est en effet pas nÃ©cessaire dâ€™utiliser une image disposant de <code>R</code> si on nâ€™utilise que du <code>Python</code>. En gÃ©nÃ©ral, les diffÃ©rents langages proposent des images de petite taille dans lequel un interprÃ©teur est dÃ©jÃ  installÃ© et proprement configurÃ©. Dans cette application, on aurait par exemple pu utiliser lâ€™image <a href="https://hub.docker.com/layers/python/library/python/3.9-slim-buster/images/sha256-e07b35c0c81c21995a43cefd64730ac0e57a5164cc440b6a5c94c118cfacd0ca?context=explore">python:3.9-slim-buster</a>.<a href="#fnref4" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>