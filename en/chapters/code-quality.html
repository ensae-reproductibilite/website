<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Pr√©sentation des standards permettant de produire du code lisible et maintenable, et d‚Äôoutils pour faciliter leur adoption.">

<title>Code quality ‚Äì Putting into production course</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-e5be4814725dea48736acb40950f1f11.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-1.2.0/all.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-1.2.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>
div.callout-application.callout {
  border-left-color: #9c5bd9;
}
div.callout-application.callout-style-default > .callout-header {
  background-color: rgba(156, 91, 217, 0.13);
}
div.callout-application .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-application.callout-style-default .callout-icon::before, div.callout-application.callout-titled .callout-icon::before {
  content: 'üß†';
  background-image: none;
}
</style>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://ensae-reproductibilite.github.io/"> 
<span class="menu-text">Putting into production</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../chapters/introduction.html"> 
<span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-fundamentals" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Fundamentals</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-fundamentals">    
        <li>
    <a class="dropdown-item" href="../chapters/linux101.html">
 <span class="dropdown-text">Linux 101</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/git.html">
 <span class="dropdown-text">Git</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-good-development-practices" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Good development practices</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-good-development-practices">    
        <li>
    <a class="dropdown-item" href="../chapters/code-quality.html">
 <span class="dropdown-text">Code quality</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/projects-architecture.html">
 <span class="dropdown-text">Projects structure</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/big-data.html">
 <span class="dropdown-text">Big data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/portability.html">
 <span class="dropdown-text">Portability</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-putting-into-production" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Putting into production</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-putting-into-production">    
        <li>
    <a class="dropdown-item" href="../chapters/yaml101.html">
 <span class="dropdown-text">YAML 101</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/deployment.html">
 <span class="dropdown-text">Deployment</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/mlops.html">
 <span class="dropdown-text">MLOps</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../chapters/application.html"> 
<span class="menu-text">Application</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-projects" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Projects</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-projects">    
        <li>
    <a class="dropdown-item" href="../chapters/evaluation.html">
 <span class="dropdown-text">Evaluations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/galerie.html">
 <span class="dropdown-text">Past student projects</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-bi-github">    
        <li>
    <a class="dropdown-item" href="https://github.com/ensae-reproductibilite/website">
 <span class="dropdown-text">Website</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/ensae-reproductibilite/slides">
 <span class="dropdown-text">Slides</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/ensae-reproductibilite/application">
 <span class="dropdown-text">Red thread application</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction-1" id="toc-introduction-1" class="nav-link active" data-scroll-target="#introduction-1">Introduction</a>
  <ul class="collapse">
  <li><a href="#why-readable-and-maintainable-code-matters" id="toc-why-readable-and-maintainable-code-matters" class="nav-link" data-scroll-target="#why-readable-and-maintainable-code-matters">Why Readable and Maintainable Code Matters</a></li>
  <li><a href="#why-follow-conventions" id="toc-why-follow-conventions" class="nav-link" data-scroll-target="#why-follow-conventions">Why Follow Conventions?</a></li>
  </ul></li>
  <li><a href="#principle-1-adopt-community-standards" id="toc-principle-1-adopt-community-standards" class="nav-link" data-scroll-target="#principle-1-adopt-community-standards">Principle 1Ô∏è‚É£: Adopt Community Standards</a>
  <ul class="collapse">
  <li><a href="#a-good-ide-the-first-step-toward-quality" id="toc-a-good-ide-the-first-step-toward-quality" class="nav-link" data-scroll-target="#a-good-ide-the-first-step-toward-quality">A Good IDE: The First Step Toward Quality</a>
  <ul class="collapse">
  <li><a href="#automated-tools-for-code-diagnostics-and-formatting" id="toc-automated-tools-for-code-diagnostics-and-formatting" class="nav-link" data-scroll-target="#automated-tools-for-code-diagnostics-and-formatting">Automated Tools for Code Diagnostics and Formatting</a></li>
  <li><a href="#linters-to-identify-bad-coding-habits" id="toc-linters-to-identify-bad-coding-habits" class="nav-link" data-scroll-target="#linters-to-identify-bad-coding-habits">Linters to Identify Bad Coding Habits</a></li>
  <li><a href="#formatters-for-bulk-code-cleanup" id="toc-formatters-for-bulk-code-cleanup" class="nav-link" data-scroll-target="#formatters-for-bulk-code-cleanup">Formatters for Bulk Code Cleanup</a></li>
  </ul></li>
  <li><a href="#sharing-a-path-to-better-code-quality" id="toc-sharing-a-path-to-better-code-quality" class="nav-link" data-scroll-target="#sharing-a-path-to-better-code-quality">Sharing: A Path to Better Code Quality</a>
  <ul class="collapse">
  <li><a href="#open-source-as-a-quality-driver" id="toc-open-source-as-a-quality-driver" class="nav-link" data-scroll-target="#open-source-as-a-quality-driver">Open Source as a Quality Driver</a></li>
  <li><a href="#code-review" id="toc-code-review" class="nav-link" data-scroll-target="#code-review">Code Review</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#principle-2-favour-a-modular-structure" id="toc-principle-2-favour-a-modular-structure" class="nav-link" data-scroll-target="#principle-2-favour-a-modular-structure">Principle 2Ô∏è‚É£: Favour a Modular Structure</a>
  <ul class="collapse">
  <li><a href="#objectives" id="toc-objectives" class="nav-link" data-scroll-target="#objectives">Objectives</a></li>
  <li><a href="#advantages-of-functions" id="toc-advantages-of-functions" class="nav-link" data-scroll-target="#advantages-of-functions">Advantages of Functions</a>
  <ul class="collapse">
  <li><a href="#programming-advice" id="toc-programming-advice" class="nav-link" data-scroll-target="#programming-advice">Programming Advice</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<script>
  const langButton = document.createElement("div");
  langButton.className = "lang-switch-button";
  langButton.style.textAlign = "right";
  langButton.style.marginTop = "1rem";
  langButton.style.marginBottom = "1rem";

  const currentPath = window.location.pathname;

  // G√©rer les cas avec un sous-r√©pertoire comme /website
  const normalizedPath = currentPath.replace(/^\/website/, "");
  const isEnglish = normalizedPath.includes("/en/");
  let targetHref, label, svg;

  if (isEnglish) {
    targetHref = currentPath.replace("/en/", "/");  // conserve le pr√©fixe /website si pr√©sent
    label = "Passer √† la version fran√ßaise";
    svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="20" height="20" style="vertical-align: middle; margin-left: 0.5em; display: inline-block;"><mask id="circleFlagsLangFr"><circle cx="256" cy="256" r="256" fill="#fff"/></mask><g mask="url(#circleFlagsLangFr)"><path fill="#0055A4" d="M0 0h512v512H0z"/><path fill="#fff" d="M170.7 0h170.6v512H170.7z"/><path fill="#EF4135" d="M341.3 0H512v512H341.3z"/></g></svg>`;
  } else {
    const prefix = currentPath.startsWith("/website") ? "/website" : "";
    targetHref = prefix + "/en" + currentPath.slice(prefix.length);
    label = "Switch to English version";
    svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="20" height="20" style="vertical-align: middle; margin-left: 0.5em; display: inline-block;"><mask id="circleFlagsLangEn"><circle cx="256" cy="256" r="256" fill="#fff"/></mask><g mask="url(#circleFlagsLangEn)"><path fill="#eee" d="M256 0L0 256v64l32 32l-32 32v128l22-8l23 8h23l54-32l54 32h32l48-32l48 32h32l54-32l54 32h68l-8-22l8-23v-23l-32-54l32-54v-32l-32-48l32-48v-32l-32-54l32-54V0z"/><path fill="#d80027" d="M224 64v64h160l64-64zm0 128l32 64l-48 48v208h96V304h208v-96H304l16-16zM0 320v64h128l-64 64H0v64h45l131-131v-45l16-16zm336 16l176 176v-45L381 336Z"/><path fill="#0052b4" d="M0 0v256h256V0zm512 68L404 176h108zM404 336l108 108V336zm-228 68L68 512h108zm160 0v108h108z"/><path fill="#eee" d="m187 243l57-41h-70l57 41l-22-67zm-81 0l57-41H93l57 41l-22-67zm-81 0l57-41H12l57 41l-22-67zm162-81l57-41h-70l57 41l-22-67zm-81 0l57-41H93l57 41l-22-67zm-81 0l57-41H12l57 41l-22-67Zm162-82l57-41h-70l57 41l-22-67zm-81 0l57-41H93l57 41l-22-67Zm-81 0l57-41H12l57 41l-22-67Z"/></g></svg>`;
  }

  langButton.innerHTML = `
    <a href="${targetHref}" class="button-cta">
      <button class="btn"><i class="fa fa-language"></i> ${label} ${svg}</button>
    </a>
  `;

  const main = document.querySelector("main#quarto-document-content");
  if (main) main.insertAdjacentElement("afterbegin", langButton);
</script>
    

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Code quality</h1>
</div>

<div>
  <div class="description">
    <p>Pr√©sentation des standards permettant de produire du code lisible et maintenable, et d‚Äôoutils pour faciliter leur adoption.</p>
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<details>
<summary>
D√©rouler les <em>slides</em> ci-dessous ou <a href="https://ensae-reproductibilite.github.io/slides/#/qualit√©-du-code">cliquer ici</a> pour afficher les slides en plein √©cran.
</summary>
<div id="cb1" class="sourceCode">
<pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
<iframe class="sourceCode yaml code-with-copy" src="https://ensae-reproductibilite.github.io/slides/#/qualit√©-du-code">
</iframe>
</div>
</details>
<p>This chapter introduces the topic of code quality,<br>
the first level in the hierarchy of best practices. It outlines<br>
why code quality matters, general principles for improving it,<br>
and a few simple tools or practices to enhance code quality.<br>
These are explored further in the <a href="../chapters/application.html">running example</a>.</p>
<section id="introduction-1" class="level1">
<h1>Introduction</h1>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../berk.png" class="img-fluid figure-img"></p>
<figcaption>Image borrowed from the ‚ÄúLes joies du code‚Äù page</figcaption>
</figure>
</div>
<section id="why-readable-and-maintainable-code-matters" class="level2">
<h2 class="anchored" data-anchor-id="why-readable-and-maintainable-code-matters">Why Readable and Maintainable Code Matters</h2>
<blockquote class="blockquote">
<p><em>‚ÄúThe code is read much more often than it is written.‚Äù</em></p>
<p>Guido Van Rossum<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
</blockquote>
<p>When getting started with <em>data science</em>, it‚Äôs natural to think of code in a purely functional way: ‚ÄúI want to complete a given task‚Äîsay, run a classification algorithm‚Äîso I‚Äôll piece together some code, often found online, in a notebook until the task is done.‚Äù The project‚Äôs structure doesn‚Äôt matter much, as long as it loads the necessary data.</p>
<p>While this minimalist and flexible mindset works well during the learning phase, it‚Äôs essential to move past it as you progress‚Äîespecially if you‚Äôre building professional or collaborative projects. Otherwise, you‚Äôll likely end up <strong>with code that‚Äôs hard to maintain or improve‚Äîand that will eventually be abandoned</strong>.</p>
<p>It‚Äôs important to choose, among many ways to solve a problem, a solution that can be understood by others who speak the same programming language. Code is read far more than it‚Äôs written‚Äîit‚Äôs primarily a <strong>communication tool</strong>. Moreover, maintaining code typically takes more effort than writing it in the first place. That‚Äôs why thinking ahead about code quality and project structure is critical to long-term maintainability.</p>
<p>To improve communication and reduce the pain of working with unclear code, developers have attempted‚Äîsometimes informally, sometimes through institutions‚Äîto define conventions. These depend on the language but are based on principles that apply universally to code-based projects.</p>
</section>
<section id="why-follow-conventions" class="level2">
<h2 class="anchored" data-anchor-id="why-follow-conventions">Why Follow Conventions?</h2>
<p><code>Python</code> is a very <strong>readable</strong> language. With a bit of care‚Äînaming things well, managing dependencies, and structuring code properly‚Äîyou can often understand a script without running it. This is one of Python‚Äôs biggest strengths, enabling fast learning and easy understanding of other people‚Äôs code.</p>
<p>The Python community has developed a set of widely accepted standards, called <code>PEPs</code> (Python Enhancement Proposals), that serve as the foundation of the ecosystem. The two most well-known are:</p>
<ul>
<li><strong><a href="https://peps.python.org/pep-0008/"><code>PEP8</code></a></strong>, which defines code style conventions;</li>
<li><strong><a href="https://peps.python.org/pep-0257/"><code>PEP257</code></a></strong>, which outlines conventions for documentation (<em>docstrings</em>).</li>
</ul>
<p>These conventions go beyond syntax. Several standards for project organization have also emerged, which we‚Äôll explore in the <a href="../chapters/projects-architecture.html">next chapter</a>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Comparison with <i class="fa-brands fa-r-project" aria-label="r-project"></i>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>In the <i class="fa-brands fa-r-project" aria-label="r-project"></i> ecosystem, formalization has been less structured. The language is more permissive than <code>Python</code> in some ways<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. Still, some style standards have emerged, including:</p>
<ul>
<li>the <a href="https://style.tidyverse.org/googl"><em>tidyverse style guide</em></a>,</li>
<li>the <a href="https://google.github.io/styleguide/Rguide.html"><em>Google R style guide</em></a>,</li>
<li>and the <a href="https://github.com/mlr-org/mlr3/wiki/Style-Guide#theoretical-style-guide">MLR style guide</a>‚Ä¶</li>
</ul>
<p>For further learning in <i class="fa-brands fa-r-project" aria-label="r-project"></i>:</p>
<ul>
<li>The Insee training on <a href="https://inseefrlab.github.io/formation-bonnes-pratiques-git-R/">best practices with <code>Git</code> and <i class="fa-brands fa-r-project" aria-label="r-project"></i></a>, which aligns closely with this course;</li>
<li>Additional guidance in the <a href="https://www.book.utilitr.org/02_bonnes_pratiques/01-qualite-code">collaborative <code>utilitR</code> documentation</a>;</li>
<li><a href="https://blog.r-hub.io/2022/03/21/code-style/">This blog post</a> that links to various resources on the subject.</li>
</ul>
</div>
</div>
</div>
<p>These conventions are somewhat arbitrary‚Äîit‚Äôs natural to prefer some styles over others.</p>
<p>They‚Äôre also not set in stone. Languages and practices evolve, which means conventions must adapt. Still, adopting the recommended habits‚Äîwhen possible‚Äîwill make your code easier for the community to understand, increase your chances of getting help, and make future maintenance easier.</p>
<p>There are many coding style philosophies, but the most important principle is <strong>consistency</strong>: If you choose a convention‚Äîsay, <em>snake_case</em> (<code>my_function_name</code>) over <em>camelCase</em> (<code>myFunctionName</code>)‚Äîthen stick with it.</p>
</section>
</section>
<section id="principle-1-adopt-community-standards" class="level1">
<h1>Principle 1Ô∏è‚É£: Adopt Community Standards</h1>
<p>In line with the idea of best practices as a <strong>continuum</strong> introduced in the <a href="../chapters/introduction.html">introduction</a>, it‚Äôs not necessarily advisable to apply all the recommendations in this chapter to every project. In some cases, the marginal cost of implementing certain practices may outweigh the benefits.</p>
<p>Instead, we recommend thinking of these best practices as habits to be acquired gradually, through a back-and-forth between theory and practice. The tools we‚Äôll introduce are here to help accelerate the adoption of best practices.</p>
<p>This chapter is not meant to be exhaustive. It highlights some useful resources while offering practical advice. Memorizing every rule or constantly switching between your code and rulebooks would be tedious.</p>
<p>To draw a parallel with natural language: we don‚Äôt always have a dictionary at hand. Text editors and smartphones come with built-in spellcheckers that identify‚Äîand sometimes fix‚Äîerrors in real time.</p>
<section id="a-good-ide-the-first-step-toward-quality" class="level2">
<h2 class="anchored" data-anchor-id="a-good-ide-the-first-step-toward-quality">A Good IDE: The First Step Toward Quality</h2>
<p>Without automated code formatting tools, adopting best practices would be time-consuming and difficult to implement daily. Tools that provide diagnostics or automatically format code are incredibly useful. They allow developers to meet minimum quality standards almost instantly, saving time throughout a <em>data science</em> project. These tools are a prerequisite for production deployment, which we‚Äôll discuss later.</p>
<p>The first step toward best practices is choosing a suitable development environment. <code>VSCode</code> is an excellent IDE, as we‚Äôll explore in the <a href="../chapters/application.html">practical section</a>. It offers autocompletion, built-in diagnostics (unlike <code>Jupyter</code>), and a wide array of extensions to expand functionality:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://code.visualstudio.com/assets/docs/python/editing/packageAbbreviations.gif" class="img-fluid figure-img"></p>
<figcaption>Example of diagnostics and actions in <code>VSCode</code></figcaption>
</figure>
</div>
<p>However, IDE-level tools are not enough. They require manual interaction, which can be time-consuming and difficult to apply consistently. Fortunately, we also have automated tools for diagnostics and formatting.</p>
<section id="automated-tools-for-code-diagnostics-and-formatting" class="level3">
<h3 class="anchored" data-anchor-id="automated-tools-for-code-diagnostics-and-formatting">Automated Tools for Code Diagnostics and Formatting</h3>
<p>Since <code>Python</code> is the primary tool of thousands of <em>data scientists</em>, many tools have been developed to reduce the time needed to create a functional project. These tools boost productivity, reduce repetitive tasks, and improve project quality through diagnostics or even automatic fixes.</p>
<p>There are two main types of tools:</p>
<ol type="1">
<li><strong>Linters</strong>: programs that check whether code formally adheres to a given <em>guidestyle</em>
<ul>
<li>They report issues but do not fix them</li>
</ul></li>
<li><strong>Formatters</strong>: programs that automatically rewrite code to follow a specific <em>guidestyle</em>
<ul>
<li>They modify the code directly</li>
</ul></li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Examples
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>Issues that a linter can catch:
<ul>
<li>long or poorly indented lines, unbalanced parentheses, poorly named functions‚Ä¶</li>
</ul></li>
<li>Issues that a linter typically won‚Äôt catch:
<ul>
<li>incorrect function usage, mis-specified arguments, incoherent structure, insufficient documentation‚Ä¶</li>
</ul></li>
</ul>
</div>
</div>
</div>
</section>
<section id="linters-to-identify-bad-coding-habits" class="level3">
<h3 class="anchored" data-anchor-id="linters-to-identify-bad-coding-habits">Linters to Identify Bad Coding Habits</h3>
<p>Linters assess code quality and its potential to trigger explicit or silent errors.</p>
<p>Examples of issues linters can catch include:</p>
<ul>
<li>usage of undefined variables (errors)</li>
<li>unused variables (unnecessary code)</li>
<li>poor code organization (risk of bugs)</li>
<li>violations of code style guidelines</li>
<li>syntax errors (e.g., typos)</li>
</ul>
<p>Most development tools offer built-in diagnostics (and sometimes suggestions). You may need to enable them in the settings, as they‚Äôre often disabled by default to avoid overwhelming beginners.</p>
<p>However, if you don‚Äôt fix issues as you go, the backlog of changes can become overwhelming.</p>
<p>In <code>Python</code>, the two most common linters are <a href="https://pylint.readthedocs.io/en/latest/"><code>PyLint</code></a> and <a href="https://flake8.pycqa.org/en/latest/"><code>Flake8</code></a>. In this course, we‚Äôll use <code>PyLint</code> for its practicality and pedagogy. It can be run from the command line as follows:</p>
<div class="sourceCode" id="cb1" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install pylint</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">pylint</span> myscript.py   <span class="co"># for a single file</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">pylint</span> src           <span class="co"># for all files in the 'src' folder</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>One of the nice features of <code>PyLint</code> is that it gives a score, which is quite informative. We‚Äôll use this in the running project to track how each step improves code quality.</p>
<p>You can also set up <a href="https://pylint.readthedocs.io/en/latest/user_guide/installation/pre-commit-integration.html"><em>pre-commit hooks</em></a> to block commits that don‚Äôt meet a minimum score.</p>
</div>
</div>
</div>
</section>
<section id="formatters-for-bulk-code-cleanup" class="level3">
<h3 class="anchored" data-anchor-id="formatters-for-bulk-code-cleanup">Formatters for Bulk Code Cleanup</h3>
<p>A formatter rewrites code directly‚Äîlike a spellchecker, but for style. It can make substantial changes to improve readability.</p>
<p>The most widely used formatter is <a href="https://black.readthedocs.io/en/stable/"><code>Black</code></a>. More recently, <a href="https://github.com/astral-sh/ruff"><code>Ruff</code></a>‚Äîa hybrid linter/formatter‚Äîhas gained popularity. It builds on <code>Black</code> while integrating diagnostics from other packages.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>If your project uses <code>Black</code>, you can add a badge to the <code>README</code> on GitHub:</p>
<p><a href="https://github.com/psf/black"><img src="https://img.shields.io/badge/code%20style-black-000000.svg" class="img-fluid"></a></p>
</div>
</div>
</div>
<p>It‚Äôs quite instructive to review code after formatting‚Äîit helps identify and correct stylistic habits. You‚Äôll likely notice some rules that contradict your current habits. Try applying these new rules incrementally. Once they become second nature, revisit the guide and tackle the next set of improvements. This step-by-step approach helps raise code quality without getting bogged down in micro-details that distract from the bigger project goals.</p>
</section>
</section>
<section id="sharing-a-path-to-better-code-quality" class="level2">
<h2 class="anchored" data-anchor-id="sharing-a-path-to-better-code-quality">Sharing: A Path to Better Code Quality</h2>
<section id="open-source-as-a-quality-driver" class="level3">
<h3 class="anchored" data-anchor-id="open-source-as-a-quality-driver">Open Source as a Quality Driver</h3>
<p>By sharing your code on open-source platforms (see <a href="../chapters/git.html">Git chapter</a>), you may receive suggestions or even contributions from other users. But the benefits of openness go further. Public code tends to be better written, better documented, and more thoughtfully structured‚Äîoften because authors want to avoid public embarrassment! Even without external feedback, sharing code encourages higher quality.</p>
</section>
<section id="code-review" class="level3">
<h3 class="anchored" data-anchor-id="code-review">Code Review</h3>
<p>Code review borrows from academic <em>peer review</em> to improve the quality of <code>Python</code> code. In a review, one or more developers read and evaluate code written by someone else to identify errors and suggest improvements.</p>
<p>Benefits include:</p>
<ul>
<li>catching bugs before they escalate</li>
<li>ensuring consistent style and structure</li>
<li>enforcing best practices</li>
<li>identifying code that could be refactored for clarity or maintainability</li>
</ul>
<p>It‚Äôs also a great way to share knowledge: senior developers can help junior ones grow by reviewing their work.</p>
<p>Platforms like <code>GitHub</code> <i class="fa-brands fa-github" aria-label="github"></i> and <code>GitLab</code> <i class="fa-brands fa-gitlab" aria-label="gitlab"></i> offer convenient code review features: inline discussions, suggestions, etc.</p>
</section>
</section>
</section>
<section id="principle-2-favour-a-modular-structure" class="level1">
<h1>Principle 2Ô∏è‚É£: Favour a Modular Structure</h1>
<section id="objectives" class="level2">
<h2 class="anchored" data-anchor-id="objectives">Objectives</h2>
<ul>
<li>Encourage <strong>conciseness</strong> to reduce the risk of error and make the process clearer;</li>
<li>Improve <strong>readability</strong>, which is essential to make the process understandable by others but also for yourself when revisiting an old script;</li>
<li>Reduce <strong>redundancy</strong>, which simplifies code (the <em>don‚Äôt repeat yourself</em> paradigm);</li>
<li>Minimize the risk of <strong>errors due to copy/paste</strong>.</li>
</ul>
</section>
<section id="advantages-of-functions" class="level2">
<h2 class="anchored" data-anchor-id="advantages-of-functions">Advantages of Functions</h2>
<p>Functions have many advantages over long scripts:</p>
<ul>
<li>Limit the risk of errors caused by copy/paste;</li>
<li>Make the code more readable and compact;</li>
<li>Only one place to modify the code if the processing changes;</li>
<li>Facilitate code reuse and documentation!</li>
</ul>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Golden Rule
</div>
</div>
<div class="callout-body-container callout-body">
<p>You should use a <span class="red2"><strong>function</strong></span> whenever a piece of code is used more than twice (<span class="red2"><strong><em>don‚Äôt repeat yourself</em> (DRY)</strong></span>).</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rules for Writing <strong>Effective</strong> Functions
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>One task = one function;</li>
<li>A complex task = a sequence of functions, each performing a simple task;</li>
<li>Limit the use of global variables.</li>
</ul>
</div>
</div>
<p>Regarding package installation, as we will see in the <a href="../chapters/projects-architecture.html">Project Structure</a> and <a href="../chapters/portability.html">Portability</a> sections, this should not be managed inside the script, but in a separate element related to the project‚Äôs execution environment<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. Those sections also provide practical advice on handling API or database tokens, which <strong>should never be written in the code</strong>.</p>
<p>Overly long scripts are not a best practice. It is better to divide all scripts executing a production chain into <em>‚Äúmonads‚Äù</em>, i.e., small coherent units. Functions are a key tool for this purpose (they help reduce redundancy and are a preferred tool for documenting code).</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example: Prefer List Comprehensions
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>In <code>Python</code>, it is recommended to prefer list comprehensions over indented <code>for</code> loops. The latter are generally less efficient and involve a larger number of code lines, whereas list comprehensions are much more concise:</p>
<div class="sourceCode" id="cb2" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>liste_nombres <span class="op">=</span> <span class="bu">range</span>(<span class="dv">10</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># very bad</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> []</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> liste_nombres:</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        y.append(x<span class="op">*</span>x)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># better</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> [x<span class="op">*</span>x <span class="cf">for</span> x <span class="kw">in</span> liste_nombres <span class="cf">if</span> x <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<section id="programming-advice" class="level3">
<h3 class="anchored" data-anchor-id="programming-advice">Programming Advice</h3>
<p>In the Python programming world, there are two main paradigms:</p>
<ul>
<li><strong>Functional programming</strong>: builds code by chaining functions, i.e., more or less standardized operations;</li>
<li><strong>Object-Oriented Programming (OOP)</strong>: builds code by defining objects of a given <em>class</em> with <em>attributes</em> (intrinsic features) and custom <em>methods</em> to perform class-specific operations.</li>
</ul>
<details>
<summary>
Example comparing the two paradigms
</summary>
<p>Thanks <em>ChatGPT</em> for the example:</p>
<div id="ad2ab0b6" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AverageCalculator:</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, numbers):</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.numbers <span class="op">=</span> numbers</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> calculate_average(<span class="va">self</span>):</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">sum</span>(<span class="va">self</span>.numbers) <span class="op">/</span> <span class="bu">len</span>(<span class="va">self</span>.numbers)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Usage</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>calculator <span class="op">=</span> AverageCalculator([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Average (OOP):"</span>, calculator.calculate_average())</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_average(numbers):</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>(numbers) <span class="op">/</span> <span class="bu">len</span>(numbers)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Usage</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>numbers <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>]</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Average (FP):"</span>, calculate_average(numbers))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>Average (OOP): 3.0
Average (FP): 3.0</code></pre>
</div>
</div>
</details>
<p>Functional programming is more intuitive than OOP and often allows for quicker code development. OOP is a more formalist approach, useful when functions need to adapt to the input object type (e.g., loading different model weights depending on the model type in <a href="https://pytorch.org/vision/0.9/models.html"><code>Pytorch</code></a>). It avoids üçù <em>spaghetti code</em> that‚Äôs hard to debug.</p>
<p>However, one should remain pragmatic. OOP can be more complex to implement than functional programming. In many cases, well-written functional code is sufficient. For large projects, adopting a <strong>defensive programming</strong> approach is helpful ‚Äî a precautionary strategy in the functional paradigm that anticipates and manages unexpected situations (e.g., wrong argument type or structure).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Spaghetti Code
</div>
</div>
<div class="callout-body-container callout-body">
<p>‚ÄúSpaghetti code‚Äù refers to programming style that leads to tangled code due to excessive use of conditions, exceptions, and complex event handling. It becomes almost impossible to trace the cause of errors without stepping through every line of code ‚Äî and there are many, due to poor practices.</p>
<p>Spaghetti code prevents determining who, what, and how something happens, making updates time-consuming since one must follow the chain of references line by line.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
A Progressive Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>üí° Suppose we have a dataset that uses <code>‚àí99</code> to represent missing values. We want to replace all <code>‚àí99</code> with <code>NA</code>.</p>
<div class="sourceCode" id="cb5" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1234</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.random.randint(<span class="dv">1</span>, <span class="dv">10</span>, size <span class="op">=</span> (<span class="dv">5</span>,<span class="dv">6</span>))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> np.insert(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    a,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    np.random.choice(<span class="bu">len</span>(a), size<span class="op">=</span><span class="dv">6</span>),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span><span class="dv">99</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(df.reshape((<span class="dv">6</span>,<span class="dv">6</span>)), columns<span class="op">=</span>[<span class="bu">chr</span>(x) <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">97</span>, <span class="dv">103</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>First attempt:</p>
<div class="sourceCode" id="cb6" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df.copy()</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>df2.loc[df2[<span class="st">'a'</span>] <span class="op">==</span> <span class="op">-</span><span class="dv">99</span>,<span class="st">'a'</span>] <span class="op">=</span> np.nan</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>df2.loc[df2[<span class="st">'b'</span>] <span class="op">==</span> <span class="op">-</span><span class="dv">99</span>,<span class="st">'b'</span>] <span class="op">=</span> np.nan</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>df2.loc[df2[<span class="st">'c'</span>] <span class="op">==</span> <span class="op">-</span><span class="dv">99</span>,<span class="st">'c'</span>] <span class="op">=</span> np.nan</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>df2.loc[df2[<span class="st">'d'</span>] <span class="op">==</span> <span class="op">-</span><span class="dv">99</span>,<span class="st">'d'</span>] <span class="op">=</span> np.nan</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>df2.loc[df2[<span class="st">'e'</span>] <span class="op">==</span> <span class="op">-</span><span class="dv">98</span>,<span class="st">'e'</span>] <span class="op">=</span> np.nan</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>df2.loc[df2[<span class="st">'f'</span>] <span class="op">==</span> <span class="op">-</span><span class="dv">99</span>,<span class="st">'e'</span>] <span class="op">=</span> np.nan</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>What‚Äôs wrong here?</p>
<details>
<summary>
Hint üí° Look at columns <code>e</code> and <code>g</code>.
</summary>
Two copy-paste errors: - <code>-98</code> instead of <code>-99</code>; - <code>'e'</code> instead of <code>'f'</code> in the last line.
</details>
<p>Next improvement ‚Äî using a function:</p>
<div class="sourceCode" id="cb7" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fix_missing(x: pd.Series):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    x[x <span class="op">==</span> <span class="op">-</span><span class="dv">99</span>] <span class="op">=</span> np.nan</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df.copy()</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>df2[<span class="st">'a'</span>] <span class="op">=</span> fix_missing(df[<span class="st">'a'</span>])</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>df2[<span class="st">'b'</span>] <span class="op">=</span> fix_missing(df[<span class="st">'b'</span>])</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Still repetitive and error-prone with column names.</p>
<p>Best version ‚Äî apply function across all columns:</p>
<div class="sourceCode" id="cb8" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df.copy()</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df2.<span class="bu">apply</span>(fix_missing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now the code is: 1. Concise; 2. Robust to data structure changes; 3. Free from hard-coded mistakes; 4. Easily generalizable ‚Äî e.g., apply only on selected columns:</p>
<div class="sourceCode" id="cb9" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df2[[<span class="st">'a'</span>,<span class="st">'b'</span>,<span class="st">'e'</span>]] <span class="op">=</span> df2[[<span class="st">'a'</span>,<span class="st">'b'</span>,<span class="st">'e'</span>]].<span class="bu">apply</span>(fix_missing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Resources like the <a href="https://docs.python-guide.org/writing/style/">Hitchhiker‚Äôs Guide to Python</a> and <a href="https://towardsdatascience.com/the-zen-of-python-a-guide-to-pythons-design-principles-93f3f76d088a">this blog post</a> illustrate these design principles well.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The Zen of Python
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Written by Tim Peters in 2004, this set of aphorisms embodies Python‚Äôs design philosophy:</p>
<div class="sourceCode" id="cb10" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> this</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre data-code-line-numbers=""><code>The Zen of Python, by Tim Peters

Beautiful is better than ugly.
Explicit is better than implicit.
Simple is better than complex.
...
Namespaces are one honking great idea -- let's do more of those!</code></pre>
</div>
</div>
</div>


</section>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Guido Van Rossum is the creator of <i class="fa-brands fa-python" aria-label="python"></i>, which makes him a voice worth listening to.<a href="#fnref1" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
<li id="fn2"><p>For example, in <i class="fa-brands fa-r-project" aria-label="r-project"></i>, you can use <code>&lt;-</code> or <code>=</code> for assignment, and the language won‚Äôt complain about poor indentation‚Ä¶<a href="#fnref2" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
<li id="fn3"><p>We will present the two main approaches in <code>Python</code>, their similarities and differences: virtual environments (managed by a <code>requirements.txt</code> file) and conda environments (managed by an <code>environment.yml</code> file).<a href="#fnref3" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<script src="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>