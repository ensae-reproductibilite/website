<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Présentation des principes et des techniques permettant de rendre un projet exécutable sur différents environnements.">

<title>Portabilité – Putting into production course</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-e5be4814725dea48736acb40950f1f11.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-1.2.0/all.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-1.2.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>
div.callout-application.callout {
  border-left-color: #9c5bd9;
}
div.callout-application.callout-style-default > .callout-header {
  background-color: rgba(156, 91, 217, 0.13);
}
div.callout-application .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-application.callout-style-default .callout-icon::before, div.callout-application.callout-titled .callout-icon::before {
  content: '🧠';
  background-image: none;
}
</style>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://ensae-reproductibilite.github.io/"> 
<span class="menu-text">Putting into production</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../chapters/introduction.html"> 
<span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-fundamentals" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Fundamentals</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-fundamentals">    
        <li>
    <a class="dropdown-item" href="../chapters/linux101.html">
 <span class="dropdown-text">Linux 101</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/git.html">
 <span class="dropdown-text">Git</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-good-development-practices" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Good development practices</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-good-development-practices">    
        <li>
    <a class="dropdown-item" href="../chapters/code-quality.html">
 <span class="dropdown-text">Code quality</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/projects-architecture.html">
 <span class="dropdown-text">Projects structure</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/big-data.html">
 <span class="dropdown-text">Big data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/portability.html">
 <span class="dropdown-text">Portability</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-putting-into-production" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Putting into production</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-putting-into-production">    
        <li>
    <a class="dropdown-item" href="../chapters/yaml101.html">
 <span class="dropdown-text">YAML 101</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/deployment.html">
 <span class="dropdown-text">Deployment</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/mlops.html">
 <span class="dropdown-text">MLOps</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../chapters/application.html"> 
<span class="menu-text">Application</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-projects" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Projects</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-projects">    
        <li>
    <a class="dropdown-item" href="../chapters/evaluation.html">
 <span class="dropdown-text">Evaluations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/galerie.html">
 <span class="dropdown-text">Past student projects</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-bi-github">    
        <li>
    <a class="dropdown-item" href="https://github.com/ensae-reproductibilite/website">
 <span class="dropdown-text">Website</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/ensae-reproductibilite/slides">
 <span class="dropdown-text">Slides</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/ensae-reproductibilite/application">
 <span class="dropdown-text">Red thread application</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction-the-notion-of-portability" id="toc-introduction-the-notion-of-portability" class="nav-link active" data-scroll-target="#introduction-the-notion-of-portability">Introduction: The Notion of Portability</a></li>
  <li><a href="#virtualenv" id="toc-virtualenv" class="nav-link" data-scroll-target="#virtualenv">Virtual Environments <i class="fa-brands fa-python" aria-label="python"></i></a>
  <ul class="collapse">
  <li><a href="#introduction-1" id="toc-introduction-1" class="nav-link" data-scroll-target="#introduction-1">Introduction</a></li>
  <li><a href="#how-it-works" id="toc-how-it-works" class="nav-link" data-scroll-target="#how-it-works">How It Works</a></li>
  <li><a href="#implementations" id="toc-implementations" class="nav-link" data-scroll-target="#implementations">Implementations</a></li>
  <li><a href="#practical-guide-to-using-a-virtual-environment" id="toc-practical-guide-to-using-a-virtual-environment" class="nav-link" data-scroll-target="#practical-guide-to-using-a-virtual-environment">Practical Guide to Using a Virtual Environment</a>
  <ul class="collapse">
  <li><a href="#installation-1" id="toc-installation-1" class="nav-link" data-scroll-target="#installation-1">Installation</a></li>
  <li><a href="#creating-an-environment" id="toc-creating-an-environment" class="nav-link" data-scroll-target="#creating-an-environment">Creating an Environment</a></li>
  <li><a href="#activating-an-environment" id="toc-activating-an-environment" class="nav-link" data-scroll-target="#activating-an-environment">Activating an Environment</a></li>
  <li><a href="#listing-installed-packages" id="toc-listing-installed-packages" class="nav-link" data-scroll-target="#listing-installed-packages">Listing Installed Packages</a></li>
  <li><a href="#installing-a-package" id="toc-installing-a-package" class="nav-link" data-scroll-target="#installing-a-package">Installing a package</a></li>
  <li><a href="#exporting-environment-specifications" id="toc-exporting-environment-specifications" class="nav-link" data-scroll-target="#exporting-environment-specifications">Exporting environment specifications</a></li>
  <li><a href="#switching-environments" id="toc-switching-environments" class="nav-link" data-scroll-target="#switching-environments">Switching environments</a></li>
  <li><a href="#cheat-sheet" id="toc-cheat-sheet" class="nav-link" data-scroll-target="#cheat-sheet">Cheat sheet</a></li>
  </ul></li>
  <li><a href="#limitations" id="toc-limitations" class="nav-link" data-scroll-target="#limitations">Limitations</a></li>
  </ul></li>
  <li><a href="#containers" id="toc-containers" class="nav-link" data-scroll-target="#containers">Containers 🐋</a>
  <ul class="collapse">
  <li><a href="#introduction-3" id="toc-introduction-3" class="nav-link" data-scroll-target="#introduction-3">Introduction</a></li>
  <li><a href="#how-it-works-1" id="toc-how-it-works-1" class="nav-link" data-scroll-target="#how-it-works-1">How it works</a></li>
  <li><a href="#docker-the-standard-implementation" id="toc-docker-the-standard-implementation" class="nav-link" data-scroll-target="#docker-the-standard-implementation"><code>Docker</code> <i class="fa-brands fa-docker" aria-label="docker"></i>, the standard implementation</a>
  <ul class="collapse">
  <li><a href="#installation-sandbox-environments" id="toc-installation-sandbox-environments" class="nav-link" data-scroll-target="#installation-sandbox-environments">Installation &amp; sandbox environments</a></li>
  <li><a href="#concepts" id="toc-concepts" class="nav-link" data-scroll-target="#concepts">Concepts</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#docker-in-practice-an-example" id="toc-docker-in-practice-an-example" class="nav-link" data-scroll-target="#docker-in-practice-an-example"><code>Docker</code> in Practice: An Example</a>
  <ul class="collapse">
  <li><a href="#application-1" id="toc-application-1" class="nav-link" data-scroll-target="#application-1">Application</a></li>
  <li><a href="#dockerfile" id="toc-dockerfile" class="nav-link" data-scroll-target="#dockerfile">The <code>Dockerfile</code></a></li>
  <li><a href="#build" id="toc-build" class="nav-link" data-scroll-target="#build">Building a Docker Image</a></li>
  <li><a href="#execution" id="toc-execution" class="nav-link" data-scroll-target="#execution">Running a Docker Image</a></li>
  <li><a href="#exp-docker" id="toc-exp-docker" class="nav-link" data-scroll-target="#exp-docker">Exporting a Docker Image</a></li>
  <li><a href="#imp-docker" id="toc-imp-docker" class="nav-link" data-scroll-target="#imp-docker">Importing a Docker Image</a></li>
  <li><a href="#cheat-sheet-1" id="toc-cheat-sheet-1" class="nav-link" data-scroll-target="#cheat-sheet-1">Cheat Sheet</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<script>
  const langButton = document.createElement("div");
  langButton.className = "lang-switch-button";
  langButton.style.textAlign = "right";
  langButton.style.marginTop = "1rem";
  langButton.style.marginBottom = "1rem";

  const currentPath = window.location.pathname;

  // Gérer les cas avec un sous-répertoire comme /website
  const normalizedPath = currentPath.replace(/^\/website/, "");
  const isEnglish = normalizedPath.includes("/en/");
  let targetHref, label, svg;

  if (isEnglish) {
    targetHref = currentPath.replace("/en/", "/");  // conserve le préfixe /website si présent
    label = "Passer à la version française";
    svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="20" height="20" style="vertical-align: middle; margin-left: 0.5em; display: inline-block;"><mask id="circleFlagsLangFr"><circle cx="256" cy="256" r="256" fill="#fff"/></mask><g mask="url(#circleFlagsLangFr)"><path fill="#0055A4" d="M0 0h512v512H0z"/><path fill="#fff" d="M170.7 0h170.6v512H170.7z"/><path fill="#EF4135" d="M341.3 0H512v512H341.3z"/></g></svg>`;
  } else {
    const prefix = currentPath.startsWith("/website") ? "/website" : "";
    targetHref = prefix + "/en" + currentPath.slice(prefix.length);
    label = "Switch to English version";
    svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="20" height="20" style="vertical-align: middle; margin-left: 0.5em; display: inline-block;"><mask id="circleFlagsLangEn"><circle cx="256" cy="256" r="256" fill="#fff"/></mask><g mask="url(#circleFlagsLangEn)"><path fill="#eee" d="M256 0L0 256v64l32 32l-32 32v128l22-8l23 8h23l54-32l54 32h32l48-32l48 32h32l54-32l54 32h68l-8-22l8-23v-23l-32-54l32-54v-32l-32-48l32-48v-32l-32-54l32-54V0z"/><path fill="#d80027" d="M224 64v64h160l64-64zm0 128l32 64l-48 48v208h96V304h208v-96H304l16-16zM0 320v64h128l-64 64H0v64h45l131-131v-45l16-16zm336 16l176 176v-45L381 336Z"/><path fill="#0052b4" d="M0 0v256h256V0zm512 68L404 176h108zM404 336l108 108V336zm-228 68L68 512h108zm160 0v108h108z"/><path fill="#eee" d="m187 243l57-41h-70l57 41l-22-67zm-81 0l57-41H93l57 41l-22-67zm-81 0l57-41H12l57 41l-22-67zm162-81l57-41h-70l57 41l-22-67zm-81 0l57-41H93l57 41l-22-67zm-81 0l57-41H12l57 41l-22-67Zm162-82l57-41h-70l57 41l-22-67zm-81 0l57-41H93l57 41l-22-67Zm-81 0l57-41H12l57 41l-22-67Z"/></g></svg>`;
  }

  langButton.innerHTML = `
    <a href="${targetHref}" class="button-cta">
      <button class="btn"><i class="fa fa-language"></i> ${label} ${svg}</button>
    </a>
  `;

  const main = document.querySelector("main#quarto-document-content");
  if (main) main.insertAdjacentElement("afterbegin", langButton);
</script>
    

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Portabilité</h1>
</div>

<div>
  <div class="description">
    <p>Présentation des principes et des techniques permettant de rendre un projet exécutable sur différents environnements.</p>
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<details>
<summary>
Dérouler les <em>slides</em> ci-dessous ou <a href="https://ensae-reproductibilite.github.io/slides/#/portabilité">cliquer ici</a> pour afficher les slides en plein écran.
</summary>
<div id="cb1" class="sourceCode">
<pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
<iframe class="sourceCode yaml code-with-copy" src="https://ensae-reproductibilite.github.io/slides/#/portabilité">
</iframe>
</div>
</details>
<section id="introduction-the-notion-of-portability" class="level1">
<h1>Introduction: The Notion of Portability</h1>
<p>In previous chapters, we explored a set of best practices that significantly improve project quality: making code more readable, adopting a standardized and scalable project structure, and properly versioning code on a <code>GitHub</code> <i class="fa-brands fa-github" aria-label="github"></i> repository.</p>
<p>Once these best practices are applied, the project seems highly shareable — at least in theory. In practice, things are often more complicated: chances are that if you try to run your project on a different execution environment (another computer, a server, etc.), it won’t behave as expected. That means that <strong>in its current state, the project is not <span class="colorized">portable</span>: it cannot be run in a different environment without costly modifications</strong>.</p>
<p>The main reason is that code doesn’t live in a bubble — it typically includes many, often invisible, dependencies on the language and the environment in which it was developed:</p>
<ul>
<li><strong><code>Python</code> dependencies</strong>: these are the <em>packages</em> required for the code to run;</li>
<li><strong>Dependencies in other languages</strong>: many <code>Python</code> libraries rely on low-level implementations for performance. For example, <code>NumPy</code> is written in <code>C</code>, requiring a C compiler, while <code>Pytorch</code> depends on <code>C++</code>;</li>
<li><strong>System library dependencies</strong>: installing some <em>packages</em> requires system-level libraries that vary by operating system and hardware setup (e.g., 32-bit vs.&nbsp;64-bit Windows). For instance, spatial data libraries like <code>GeoPandas</code> and <code>Folium</code> rely on <code>GDAL</code> system libraries, which differ per OS<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</li>
</ul>
<p>The first problem can be handled fairly easily by adopting a proper project structure (<a href="../chapters/projects-architecture.html">see previous chapter</a>) and including a well-maintained <code>requirements.txt</code> file. The other two typically require more advanced tools.</p>
<p>We’re now moving up the ladder of reproducibility by aiming to make the project portable — that is, runnable in a different environment from where it was developed. This requires new tools, each marking a new step toward reproducibility:</p>
<ul>
<li><a href="#virtualenv">Virtual environments</a>;</li>
<li><a href="#conteneurs">Containers</a>.</li>
</ul>
<p>These tools allow us to <strong>standardize the environment and make the project portable</strong>. This step is crucial when aiming to deploy a project into production, as it ensures a smooth transition from the development environment to the production one.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://img.devrant.com/devrant/rant/r_174386_yx6zV.jpg" class="img-fluid figure-img"></p>
<figcaption>Image borrowed from <a href="https://devrant.com/rants/174386/when-i-say-but-it-works-on-my-machine">devrant.com</a></figcaption>
</figure>
</div>
<p>Which method to use depends on a time-versus-benefit tradeoff. Not all projects are meant to be containerized. However, the benefit of adopting best practices is that if the project grows in ambition and containerization becomes relevant, it will be inexpensive to implement.</p>
</section>
<section id="virtualenv" class="level1">
<h1>Virtual Environments <i class="fa-brands fa-python" aria-label="python"></i></h1>
<section id="introduction-1" class="level2">
<h2 class="anchored" data-anchor-id="introduction-1">Introduction</h2>
<p>To illustrate the importance of working with virtual environments, let’s take the perspective of an aspiring data scientist starting their first projects.</p>
<p>Most likely, they begin by installing a Python distribution—often via Anaconda—on their machine and start developing project after project. If they need to install an additional library, they do so without much thought. Then they move on to the next project using the same approach. And so on.</p>
<p>This natural workflow allows for quick experimentation. However, it becomes problematic when it comes time to share a project or revisit it later.</p>
<p>In this setup, all packages used across various projects are installed in the same location. While this might seem trivial—after all, Python’s simplicity is one of its strengths—several issues will eventually arise:</p>
<ul>
<li><strong>Version conflicts</strong>: Application A may require version 1 of a package, while application B needs version 2. These versions may be incompatible. In such a setup, only one application may work;</li>
<li><strong>Fixed Python version</strong> — Only one Python installation is available per system, whereas you’d want different versions for different projects;</li>
<li><strong>Limited reproducibility</strong>: It’s difficult to trace which project relies on which packages, since everything accumulates in the same environment;</li>
<li><strong>Limited portability</strong>: As a result of the above, it’s hard to generate a file listing only the dependencies of a specific project.</li>
</ul>
<p>Virtual environments provide a solution to these issues.</p>
</section>
<section id="how-it-works" class="level2">
<h2 class="anchored" data-anchor-id="how-it-works">How It Works</h2>
<p>The concept of a virtual environment is technically quite simple. In Python, it can be defined as:</p>
<blockquote class="blockquote">
<p><em>“A self-contained directory tree that contains a Python installation for a particular version of Python, plus additional packages.”</em></p>
</blockquote>
<p>You can think of virtual environments as a way to maintain multiple isolated Python setups on the same system, each with its own package list and versions. Starting every new project in a clean virtual environment is a great practice to improve reproducibility.</p>
</section>
<section id="implementations" class="level2">
<h2 class="anchored" data-anchor-id="implementations">Implementations</h2>
<p>There are various implementations of virtual environments in Python, each with its own community and features:</p>
<ul>
<li>The standard Python implementation is <code>venv</code>.</li>
<li><code>conda</code> provides a more comprehensive implementation.</li>
</ul>
<p>From the user’s perspective, these implementations are fairly similar. The key conceptual difference is that <code>conda</code> acts as both a package manager (like <code>pip</code>) and a virtual environment manager (like <code>venv</code>).</p>
<p>For a long time, <code>conda</code> was the go-to tool for data science, as it handled not only Python dependencies but also system-level dependencies (e.g., C libraries) used by many data science packages. However, in recent years, the widespread use of <a href="https://pythonwheels.com/">wheels</a>—precompiled packages tailored for each system—has made <code>pip</code> more viable again.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Conceptual difference between <code>pip</code> and <code>conda</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Another major difference is how they resolve dependency conflicts.</p>
<p>Multiple packages might require different versions of a shared dependency. <code>conda</code> uses an advanced (and slower) solver to resolve such conflicts optimally, while <code>pip</code> follows a simpler approach.</p>
</div>
</div>
</div>
<p><code>pip+venv</code> offers simplicity, while <code>conda</code> offers robustness. Depending on your project’s context, either can be appropriate. If your project runs in an isolated container, <code>venv</code> is usually sufficient since the container already provides isolation.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Is it different in <i class="fa-brands fa-r-project" aria-label="r-project"></i>?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Some <i class="fa-brands fa-r-project" aria-label="r-project"></i> enthusiasts claim Python’s environment management is chaotic. That was true in the early 2010s, but not so much today.</p>
<p>R’s tools, like <a href="https://rstudio.github.io/renv/articles/renv.html"><code>renv</code></a>, are great but have limitations—for example, <a href="https://rstudio.github.io/renv/articles/renv.html#caveats"><code>renv</code></a> doesn’t let you specify the R version.</p>
<p>In contrast, Python’s command-line tools offer stronger portability: <code>venv</code> lets you choose the Python version when creating the environment; <code>conda</code> lets you define the version directly in the <code>environment.yml</code> file.</p>
</div>
</div>
</div>
<p>Since there’s no absolute reason to choose between <code>pip+venv</code> or <code>conda</code>, we recommend pragmatism. We personally lean toward <code>venv</code> because we mainly work in container-based microservices—an increasingly common practice in modern data science. However, we present both approaches, and the <a href="../chapters/application.html">application section</a> includes both, so you can choose what suits your needs best.</p>
</section>
<section id="practical-guide-to-using-a-virtual-environment" class="level2">
<h2 class="anchored" data-anchor-id="practical-guide-to-using-a-virtual-environment">Practical Guide to Using a Virtual Environment</h2>
<section id="installation-1" class="level3">
<h3 class="anchored" data-anchor-id="installation-1">Installation</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true"><code>venv</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false"><code>conda</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p><code>venv</code> is a module included by default in Python, making it easily accessible for managing virtual environments.</p>
<p>Instructions for using <code>venv</code>, Python’s built-in tool for creating virtual environments, are available in the <a href="https://docs.python.org/3/library/venv.html">official Python documentation</a>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.dataquest.io/wp-content/uploads/2022/01/python-virtual-envs1-1024x576.webp" class="img-fluid figure-img"></p>
<figcaption>Illustration of the concept (Source: <a href="https://www.dataquest.io/blog/a-complete-guide-to-python-virtual-environments/">dataquest</a>)</figcaption>
</figure>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>Instructions for installing <code>conda</code> are provided in the <a href="https://docs.conda.io/projects/conda/en/latest/user-guide/install/index.html">official documentation</a>. <code>conda</code> alone is not very useful in practice and is generally included in distributions. The two most popular ones are:</p>
<ul>
<li><code>Miniconda</code>: a minimalist distribution that includes <code>conda</code>, <code>Python</code>, and a small set of useful technical packages;</li>
<li><code>Anaconda</code>: a large distribution that includes <code>conda</code>, <code>Python</code>, other tools (<code>R</code>, <code>Spyder</code>, etc.), and many packages useful for data science (<code>SciPy</code>, <code>NumPy</code>, etc.).</li>
</ul>
<p><img src="../conda-eco.png" class="img-fluid"></p>
<p>In practice, the choice of distribution matters little, since we will use clean virtual environments to develop our projects.</p>
</div>
</div>
</div>
</section>
<section id="creating-an-environment" class="level3">
<h3 class="anchored" data-anchor-id="creating-an-environment">Creating an Environment</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true"><code>venv</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false"><code>conda</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>To start using <code>venv</code>, we first create a clean environment named <code>dev</code>. This is done from the command line using <code>Python</code>. That means the version of Python used in the environment will be the one active at the time of creation.</p>
<div class="sourceCode" id="annotated-cell-1" data-code-line-numbers=""><pre class="sourceCode bash code-annotation-code code-with-copy code-annotated"><code class="sourceCode bash"><a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-1-1" class="code-annotation-target"><a href="#annotated-cell-1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> venv dev</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-1" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="1" data-code-annotation="1">On a Windows system, use <code>python.exe -m venv dev</code></span>
</dd>
</dl>
<p>This command creates a folder named <code>dev/</code> containing an isolated Python installation.</p>
<details>
<summary>
Example on a Linux system
</summary>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../venv_local.png" class="img-fluid figure-img"></p>
<figcaption>Example on a Linux system</figcaption>
</figure>
</div>
</details>
<p>The Python version used will be the one set as default in your <code>PATH</code>, e.g., <code>Python 3.11</code>. To create an environment with a different version of Python, specify the path explicitly:</p>
<div class="sourceCode" id="cb1" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">/path/to/python3.8</span> <span class="at">-m</span> venv dev-old</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>To start using <code>conda</code>, we first create a clean environment named <code>dev</code>, specifying the Python version we want to install for the project:</p>
<div class="sourceCode" id="cb2" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> create <span class="at">-n</span> dev python=3.9.7</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb3" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>Retrieving notices: ...working... done</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>Channels:</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a> <span class="op">-</span> conda<span class="op">-</span>forge</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>Platform: linux<span class="op">-</span><span class="dv">64</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>Collecting package metadata (repodata.json): done</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>Solving environment: done</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">## Package Plan ##</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  environment location: <span class="op">/</span>opt<span class="op">/</span>mamba<span class="op">/</span>envs<span class="op">/</span>dev</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  added <span class="op">/</span> updated specs:</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span> python<span class="op">=</span><span class="fl">3.9.7</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>The following packages will be downloaded:</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>The following NEW packages will be INSTALLED:</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>Proceed ([y]<span class="op">/</span>n)? y</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>Downloading <span class="kw">and</span> Extracting Packages</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>As noted in the logs, <code>conda</code> created the environment and tells us where it’s located on the file system. In reality, the environment isn’t completely empty: <code>conda</code> asks—requiring confirmation with <code>y</code>—to install a number of packages, those that come bundled with the <code>Miniconda</code> distribution.</p>
<p>We can verify that the environment was created by listing all environments on the system:</p>
<div class="sourceCode" id="cb4" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> info <span class="at">--envs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb5" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># conda environments:</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>base                  <span class="op">*</span>  <span class="op">/</span>opt<span class="op">/</span>mamba</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>dev                      <span class="op">/</span>opt<span class="op">/</span>mamba<span class="op">/</span>envs<span class="op">/</span>dev</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="activating-an-environment" class="level3">
<h3 class="anchored" data-anchor-id="activating-an-environment">Activating an Environment</h3>
<p>Since multiple environments can coexist on the same system, you need to tell your environment manager which one to activate. From then on, it will implicitly be used for commands like <code>python</code>, <code>pip</code>, etc., in the current command-line session<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true"><code>venv</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false"><code>conda</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="sourceCode" id="cb6" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> dev/bin/activate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>venv</code> activates the virtual environment <code>dev</code>, which is confirmed by the name of the environment appearing at the beginning of the command line. Once activated, <code>dev</code> temporarily becomes our default Python environment. To confirm, use the <code>which</code> command to see which Python interpreter will be used:</p>
<div class="sourceCode" id="cb7" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span> python</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb8" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="op">/</span>home<span class="op">/</span>onyxia<span class="op">/</span>work<span class="op">/</span>dev<span class="op">/</span><span class="bu">bin</span><span class="op">/</span>python</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="sourceCode" id="cb9" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> activate dev</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>Conda</code> indicates that you’re now working in the <code>dev</code> environment by showing its name in parentheses at the beginning of the command line. This means <code>dev</code> is temporarily your default environment. Again, we can verify it using <code>which</code>:</p>
<div class="sourceCode" id="cb10" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span> python</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb11" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="op">/</span>opt<span class="op">/</span>mamba<span class="op">/</span>envs<span class="op">/</span>dev<span class="op">/</span><span class="bu">bin</span><span class="op">/</span>python</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>You’re now working in the correct environment: the Python interpreter being used is not the system one, but the one from your virtual environment.</p>
</section>
<section id="listing-installed-packages" class="level3">
<h3 class="anchored" data-anchor-id="listing-installed-packages">Listing Installed Packages</h3>
<p>Once the environment is activated, you can list the installed packages and their versions. This confirms that some packages are present by default when creating a virtual environment.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true"><code>venv</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false"><code>conda</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<p>We start with a truly bare-bones environment:</p>
<div class="sourceCode" id="cb12" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> list</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb13" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>Package    Version</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="op">----------</span> <span class="op">-------</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>pip        <span class="fl">23.3.2</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>setuptools <span class="fl">69.0.3</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>wheel      <span class="fl">0.42.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<p>The environment is fairly minimal, though more populated than a fresh <code>venv</code> environment:</p>
<div class="sourceCode" id="cb14" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> list</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb15" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># packages in environment at /opt/mamba/envs/dev:</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Name                    Version                   Build  Channel</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>_libgcc_mutex             <span class="fl">0.1</span>                 conda_forge    conda<span class="op">-</span>forge</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>_openmp_mutex             <span class="fl">4.5</span>                       <span class="dv">2</span><span class="er">_gnu</span>    conda<span class="op">-</span>forge</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>ca<span class="op">-</span>certificates           <span class="fl">2023.11.17</span>           hbcca054_0    conda<span class="op">-</span>forge</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>As a quick check, we can confirm that <code>Numpy</code> is indeed not available in the environment:</p>
<div class="sourceCode" id="cb16" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-c</span> <span class="st">"import numpy as np"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb17" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>Traceback (most recent call last):</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  File <span class="st">"&lt;string&gt;"</span>, line <span class="dv">1</span>, <span class="kw">in</span> <span class="op">&lt;</span>module<span class="op">&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="pp">ModuleNotFoundError</span>: No module named <span class="st">'numpy'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="installing-a-package" class="level3">
<h3 class="anchored" data-anchor-id="installing-a-package">Installing a package</h3>
<p>Your environment can be extended, when needed,<br>
by installing a package via the command line.<br>
The procedure is very similar between <code>pip</code> (for <code>venv</code> environments) and <code>conda</code>.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Mixing <code>pip</code> and <code>conda</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>It is technically possible to install packages using <code>pip</code><br>
while working within a <code>conda</code> virtual environment<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>.<br>
This is fine for experimentation and speeds up development.</p>
<p>However, in a production environment, it is a <a href="https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#using-pip-in-an-environment">practice to avoid</a>.</p>
<ul>
<li>Either you initialize a fully self-sufficient <code>conda</code> environment with an <code>env.yml</code> (see below);</li>
<li>Or you create a <code>venv</code> environment and use only <code>pip install</code>.</li>
</ul>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true"><code>venv</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false"><code>conda</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb18" data-filename="terminal" data-env="dev" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install nom_du_package</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb19" data-filename="terminal" data-env="dev" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> install nom_du_package</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>The difference is that while <code>pip install</code> installs a package from the <a href="https://pypi.org/">PyPI</a> repository, <code>conda install</code> fetches the package from repositories maintained by the Conda developers<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>.</p>
<p>Let’s install the flagship <em>machine learning</em> package <code>scikit-learn</code>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true"><code>venv</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false"><code>conda</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb20" data-filename="terminal" data-env="dev" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install scikit-learn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb21" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>pip install scikit<span class="op">-</span>learn</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>Collecting scikit<span class="op">-</span>learn</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Required dependencies (like <code>Numpy</code>) are automatically installed.<br>
The environment is thus enriched:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb22" data-filename="terminal" data-env="dev" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> list</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb23" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>Package       Version</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="op">-------------</span> <span class="op">-------</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>joblib        <span class="fl">1.3.2</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>numpy         <span class="fl">1.26.3</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>pip           <span class="fl">23.2.1</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>scikit<span class="op">-</span>learn  <span class="fl">1.4.0</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>scipy         <span class="fl">1.12.0</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>setuptools    <span class="fl">65.5.0</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>threadpoolctl <span class="fl">3.2.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb24" data-filename="terminal" data-env="dev" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> install scikit-learn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<details>
<summary>
See output
</summary>
<div class="sourceCode" id="cb25" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>Channels:</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a> <span class="op">-</span> conda<span class="op">-</span>forge</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>Executing transaction: done</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p>Again, <code>conda</code> requires installing additional packages that are dependencies of <code>scikit-learn</code>. For example, the scientific computing library <code>NumPy</code>.</p>
<div class="sourceCode" id="cb26" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>(dev) $ conda <span class="bu">list</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre data-code-line-numbers=""><code># packages in environment at /opt/mamba/envs/dev:
#
# Name                    Version                   Build  Channel
_libgcc_mutex             0.1                 conda-forge    conda-forge
...
zlib                      1.2.13               hd590300_5    conda-forge</code></pre>
</div>
</div>
</div>
</section>
<section id="exporting-environment-specifications" class="level3">
<h3 class="anchored" data-anchor-id="exporting-environment-specifications">Exporting environment specifications</h3>
<p>Starting from a clean environment is a good reproducibility practice:<br>
by beginning with a minimal setup, we ensure that only the packages<br>
strictly necessary for the application’s functionality are installed as the project evolves.</p>
<p>This also makes the project easier to port.<br>
You can export the environment’s specifications into a special file<br>
to recreate a similar setup elsewhere.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true"><code>venv</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false"><code>conda</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb28" data-filename="terminal" data-env="dev" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> freeze <span class="op">&gt;</span> requirements.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<details>
<summary>
View the generated <code>requirements.txt</code> file
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>requirements.txt</strong></pre>
</div>
<div class="sourceCode" id="cb29" data-filename="requirements.txt" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>joblib<span class="op">==</span><span class="fl">1.3.2</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>numpy<span class="op">==</span><span class="fl">1.26.3</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>scikit<span class="op">-</span>learn<span class="op">==</span><span class="fl">1.4.0</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>scipy<span class="op">==</span><span class="fl">1.12.0</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>threadpoolctl<span class="op">==</span><span class="fl">3.2.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb30" data-filename="terminal" data-env="dev" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> env export <span class="op">&gt;</span> environment.yml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

</div>
</div>
</div>
<p>This file is conventionally stored at the root of the project’s <code>Git</code> repository.<br>
This way, collaborators can recreate the exact same Conda environment used during development via the following command:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true"><code>venv</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false"><code>conda</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<p>Repeat the earlier process of creating a clean environment,<br>
then run <code>pip install -r requirements.txt</code>.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb31" data-filename="terminal" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> venv newenv</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> newenv/bin/activate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb32" data-filename="terminal" data-env="newenv" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">-r</span> requirements.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<p>This can be done in a single command:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb33" data-filename="terminal" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> env create <span class="at">-f</span> environment.yml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="switching-environments" class="level3">
<h3 class="anchored" data-anchor-id="switching-environments">Switching environments</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true"><code>venv</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false"><code>conda</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<p>To switch environments, simply activate a different one.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb34" data-filename="terminal" data-no-prefix="true" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">myenv</span><span class="kw">)</span> <span class="ex">$</span> deactivate</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> source anotherenv/bin/activate</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">anotherenv</span><span class="kw">)</span> <span class="ex">$</span> which python</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="ex">/chemin/vers/anotherenv/bin/python</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To exit the active virtual environment, just use <code>deactivate</code>:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb35" data-filename="terminal" data-no-prefix="true" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">anotherenv</span><span class="kw">)</span> <span class="ex">$</span> deactivate</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<p>To switch environments, just activate another one.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb36" data-filename="terminal" data-no-prefix="true" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">dev</span><span class="kw">)</span> <span class="ex">$</span> conda activate base</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">base</span><span class="kw">)</span> <span class="ex">$</span> which python</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="ex">/opt/mamba/bin/python</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To exit all conda environments, use <code>conda deactivate</code>:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb37" data-filename="terminal" data-no-prefix="true" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">base</span><span class="kw">)</span> <span class="ex">$</span> conda deactivate</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<details>
<summary>
View the generated <code>environment.yml</code> file
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>environment.yml</strong></pre>
</div>
<div class="sourceCode" id="cb38" data-filename="environment.yml" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>name: dev</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>channels:</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> conda<span class="op">-</span>forge</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>dependencies:</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> _libgcc_mutex<span class="op">=</span><span class="fl">0.1</span><span class="op">=</span>conda_forge</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> _openmp_mutex<span class="op">=</span><span class="fl">4.5</span><span class="op">=</span><span class="dv">2</span><span class="er">_gnu</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> ca<span class="op">-</span>certificates<span class="op">=</span><span class="fl">2023.11.17</span><span class="op">=</span>hbcca054_0</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span> joblib<span class="op">=</span><span class="fl">1.3.2</span><span class="op">=</span>pyhd8ed1a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</section>
<section id="cheat-sheet" class="level3">
<h3 class="anchored" data-anchor-id="cheat-sheet">Cheat sheet</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 26%">
<col style="width: 30%">
<col style="width: 43%">
</colgroup>
<thead>
<tr class="header">
<th><code>venv</code></th>
<th><code>conda</code></th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>python -m venv &lt;env_name&gt;</code></td>
<td><code>conda create -n &lt;env_name&gt; python=&lt;python_version&gt;</code></td>
<td>Create a new environment named <code>&lt;env_name&gt;</code> with Python version <code>&lt;python_version&gt;</code></td>
</tr>
<tr class="even">
<td></td>
<td><code>conda info --envs</code></td>
<td>List available environments</td>
</tr>
<tr class="odd">
<td><code>source &lt;env_name&gt;/bin/activate</code></td>
<td><code>conda activate &lt;env_name&gt;</code></td>
<td>Activate the environment for the current terminal session</td>
</tr>
<tr class="even">
<td><code>pip list</code></td>
<td><code>conda list</code></td>
<td>List packages in the active environment</td>
</tr>
<tr class="odd">
<td><code>pip install &lt;pkg&gt;</code></td>
<td><code>conda install &lt;pkg&gt;</code></td>
<td>Install the <code>&lt;pkg&gt;</code> package in the active environment</td>
</tr>
<tr class="even">
<td><code>pip freeze &gt; requirements.txt</code></td>
<td><code>conda env export &gt; environment.yml</code></td>
<td>Export environment specs to a <code>requirements.txt</code> or <code>environment.yml</code> file</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="limitations" class="level2">
<h2 class="anchored" data-anchor-id="limitations">Limitations</h2>
<p>Using virtual environments is good practice as it improves application portability.<br>
However, there are some limitations:</p>
<ul>
<li>system libraries needed by packages aren’t managed;</li>
<li>environments may not handle multi-language projects well;</li>
<li>installing <code>conda</code>, <code>Python</code>, and required packages every time can be tedious;</li>
<li>in production, managing separate environments per project can quickly become complex for system administrators.</li>
</ul>
<p>Containerization technologies help address these limitations.</p>
</section>
</section>
<section id="containers" class="level1">
<h1>Containers 🐋</h1>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://external-preview.redd.it/aR6WdUcsrEgld5xUlglgKX_0sC_NlryCPTXIHk5qdu8.jpg?auto=webp&amp;s=5fe64dd318eec71711d87805d43def2765dd83cd" class="img-fluid figure-img"></p>
<figcaption>Image found on <a href="https://www.reddit.com/r/ProgrammerHumor/comments/cw58z7/it_works_on_my_machine/">reddit</a></figcaption>
</figure>
</div>
<section id="introduction-3" class="level2">
<h2 class="anchored" data-anchor-id="introduction-3">Introduction</h2>
<p>With virtual environments,<br>
the goal was to allow every potential user of our project to install the required packages on their system for proper execution.</p>
<p>However, as we’ve seen, this approach doesn’t ensure perfect reproducibility and requires significant manual effort.</p>
<p>Let’s shift perspective: <em>instead of giving users a recipe to recreate the environment on their machine, couldn’t we just give them a pre-configured machine?</em></p>
<p>Of course, we’re not going to configure and ship laptops to every potential user.<br>
So we aim to deliver a virtual version<br>
of our machine. There are two main approaches:</p>
<ul>
<li><strong>Virtual machines</strong>: not a new approach. They simulate a full computing environment (hardware + OS) on a server to replicate a real computer’s behavior.</li>
<li><strong>Containers</strong>: a more lightweight solution to bundle a computing environment and mimic a real machine’s behavior.</li>
</ul>
</section>
<section id="how-it-works-1" class="level2">
<h2 class="anchored" data-anchor-id="how-it-works-1">How it works</h2>
<p>Virtual machines are heavy and difficult to replicate or distribute.<br>
To overcome these limitations, containers have emerged in the past decade.<br>
Modern cloud infrastructure has largely moved from virtual machines to containers for the reasons we’ll discuss.</p>
<p>Like VMs, containers package the full environment (system libraries, app, configs) needed to run an app.<br>
But unlike VMs, containers don’t include their own OS. Instead, they use the host machine’s OS.<br>
This means to simulate a Windows machine, you don’t need a Windows server — a Linux one will do. Conversely, you can test Linux/Mac setups on a Windows machine.<br>
The containerization software handles the translation between software-level instructions and the host OS.</p>
<p>This technology guarantees strong reproducibility while remaining lightweight enough for easy distribution and deployment.<br>
With VMs, strong coupling between the OS and the app makes scaling harder. You need to spin up new servers matching your app’s needs (OS, configs).<br>
With containers, scaling is easier: just add Linux servers with the right tools and you’re good to go.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../docker-vm.png" class="img-fluid figure-img"></p>
<figcaption>Differences between containers (left) and VMs (right) (Source: <a href="https://www.docker.com/resources/what-container/">docker.com</a>)</figcaption>
</figure>
</div>
<p>From the user’s point of view, the difference is often invisible for typical usage.<br>
They access the app via a browser or tool, and computations happen on the remote server.<br>
But for the organization hosting the app, containers bring more freedom and flexibility.</p>
</section>
<section id="docker-the-standard-implementation" class="level2">
<h2 class="anchored" data-anchor-id="docker-the-standard-implementation"><code>Docker</code> <i class="fa-brands fa-docker" aria-label="docker"></i>, the standard implementation</h2>
<p>As mentioned, the containerization software acts as a bridge between applications and the server’s OS.</p>
<p>As with virtual environments, there are multiple container technologies.<br>
In practice, <code>Docker</code> has become the dominant one — to the point where “containerize” and “Dockerize” are often used interchangeably.<br>
We will focus on Docker in this course.</p>
<section id="installation-sandbox-environments" class="level3">
<h3 class="anchored" data-anchor-id="installation-sandbox-environments">Installation &amp; sandbox environments</h3>
<p><code>Docker</code> <i class="fa-brands fa-docker" aria-label="docker"></i> can be installed on various operating systems.<br>
Installation instructions are in the <a href="https://docs.docker.com/get-docker/">official documentation</a>.<br>
You need admin rights on your computer to install it.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Disk space requirements
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>It’s also recommended to have free disk space, as some images (we’ll come back to that) can be large once decompressed and built.<br>
They may take up several GBs depending on the libraries included.</p>
<p>Still, this is small compared to a full OS (15GB for Ubuntu or macOS, 20GB for Windows…).<br>
The smallest Linux distribution (<a href="https://hub.docker.com/_/alpine/tags">Alpine</a>) is only 3MB compressed and 5MB uncompressed.</p>
</div>
</div>
</div>
<p>If you can’t install Docker, there are free online sandboxes.<br>
<em><a href="https://labs.play-with-docker.com">Play with Docker</a></em> lets you test Docker as if it were on your local machine.<br>
These services are limited though (2GB max image size, outages under heavy load…).</p>
<p>As we’ll see, interactive Docker usage is great for learning.<br>
But in practice, Docker is mostly used via CI systems like <code>GitHub Actions</code> or <code>Gitlab CI</code>.</p>
</section>
<section id="concepts" class="level3">
<h3 class="anchored" data-anchor-id="concepts">Concepts</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ensae-reproductibilite.github.io/slides/img/docker-workflow.png" class="img-fluid figure-img"></p>
<figcaption>Source: <a href="https://k21academy.com/docker-kubernetes/docker-and-kubernetes/">k21academy.com</a></figcaption>
</figure>
</div>
<p>A Docker container is delivered as an <strong>image</strong>: a binary file containing the environment needed to run an app.<br>
It’s shared in compressed form on a public image repository (e.g., <code>Dockerhub</code>).</p>
<p>Before sharing, you must <em>build</em> the image.<br>
That’s done using a <code>Dockerfile</code>, a text file with Linux commands describing how to set up the environment.</p>
<p>Once built, you can:</p>
<ul>
<li><em>Run</em> it locally to test and debug the app.<br>
Running it creates an isolated environment called a <em>container</em> — a live instance of the image<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>.</li>
<li><em>Push</em> it to a public or private repository so others (or yourself) can <em>pull</em> and use it.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Publishing your Docker image
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The most well-known image repository is <a href="https://hub.docker.com/"><code>DockerHub</code></a>.<br>
Anyone can publish a Docker image there, optionally linked to a GitHub or Gitlab project.<br>
While you can upload images manually, as we’ll see in the <a href="../chapters/deployment.html">deployment chapter</a>, it’s much better to use automated links between <code>DockerHub</code> and your <code>GitHub</code> repo.</p>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="docker-in-practice-an-example" class="level1">
<h1><code>Docker</code> in Practice: An Example</h1>
<p>The <a href="../chapters/application.html">running example</a> presents similar steps applied to a use case: deploying a web application that publicly exposes the results of a machine learning model.</p>
<section id="application-1" class="level2">
<h2 class="anchored" data-anchor-id="application-1">Application</h2>
<p>To demonstrate Docker in practice, we’ll walk through the steps to <em>Dockerize</em> a minimal web application built with the Python web framework <a href="https://flask.palletsprojects.com/en/2.1.x/"><code>Flask</code></a><a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>.</p>
<p>Our project structure is as follows:</p>
<pre data-code-line-numbers=""><code>├── myflaskapp
│   ├── Dockerfile
│   ├── hello-world.py
│   └── requirements.txt</code></pre>
<p>The <code>hello-world.py</code> script contains the code of a basic app that simply displays <em>“Hello, World!”</em> on a web page. We’ll explore how to build a more interactive application in the <a href="../chapters/application.html">running example</a>.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>hello-world.py</strong></pre>
</div>
<div class="sourceCode" id="cb40" data-filename="hello-world.py" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> flask <span class="im">import</span> Flask</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> Flask(<span class="va">__name__</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">"/"</span>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hello_world():</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"&lt;p&gt;Hello, World!&lt;/p&gt;"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To run the app, we need both Python and the <code>Flask</code> package. This means we need to control the Python environment:</p>
<ul>
<li>Install Python;</li>
<li>Install the packages required by our code—in this case, only <code>Flask</code>.</li>
</ul>
<p>Since we’re not tied to a specific version of Python, using a <code>venv</code> virtual environment is simpler than <code>conda</code>. Conveniently, we already have a <code>requirements.txt</code> file that looks like this:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>requirements.txt</strong></pre>
</div>
<div class="sourceCode" id="cb41" data-filename="requirements.txt" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>Flask<span class="op">==</span><span class="fl">2.1.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Both steps (installing Python and its required packages) must be declared in the <code>Dockerfile</code> (see <a href="#dockerfile">next section</a>).</p>
</section>
<section id="dockerfile" class="level2">
<h2 class="anchored" data-anchor-id="dockerfile">The <code>Dockerfile</code></h2>
<p>Just like a dish needs a recipe, a Docker image needs a <code>Dockerfile</code>.</p>
<p>This text file contains a sequence of instructions to build the image. These files can range from simple to complex depending on the application being containerized, but their structure follows some standards.</p>
<p>The idea is to start from a base layer (typically a minimal Linux distribution) and layer on the tools and configuration needed by our app.</p>
<p>Let’s go through the <code>Dockerfile</code> for our <code>Flask</code> application line by line:</p>
<div class="sourceCode" id="annotated-cell-59" data-code-line-numbers=""><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-59-1"><a href="#annotated-cell-59-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| filename: Dockerfile</span></span>
<span id="annotated-cell-59-2"><a href="#annotated-cell-59-2" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-59" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-59-3" class="code-annotation-target"><a href="#annotated-cell-59-3" aria-hidden="true" tabindex="-1"></a>FROM ubuntu:<span class="fl">20.04</span></span>
<span id="annotated-cell-59-4"><a href="#annotated-cell-59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-59-5"><a href="#annotated-cell-59-5" aria-hidden="true" tabindex="-1"></a>RUN apt<span class="op">-</span>get update <span class="op">-</span>y <span class="op">&amp;&amp;</span> <span class="op">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-59" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-59-6" class="code-annotation-target"><a href="#annotated-cell-59-6" aria-hidden="true" tabindex="-1"></a>    apt<span class="op">-</span>get install <span class="op">-</span>y python3<span class="op">-</span>pip python3<span class="op">-</span>dev</span>
<span id="annotated-cell-59-7"><a href="#annotated-cell-59-7" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-59" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-59-8" class="code-annotation-target"><a href="#annotated-cell-59-8" aria-hidden="true" tabindex="-1"></a>WORKDIR <span class="op">/</span>app</span>
<span id="annotated-cell-59-9"><a href="#annotated-cell-59-9" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-59" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-59-10" class="code-annotation-target"><a href="#annotated-cell-59-10" aria-hidden="true" tabindex="-1"></a>COPY requirements.txt <span class="op">/</span>app<span class="op">/</span>requirements.txt</span>
<span id="annotated-cell-59-11"><a href="#annotated-cell-59-11" aria-hidden="true" tabindex="-1"></a>RUN pip install <span class="op">-</span>r requirements.txt</span>
<span id="annotated-cell-59-12"><a href="#annotated-cell-59-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-59-13"><a href="#annotated-cell-59-13" aria-hidden="true" tabindex="-1"></a>COPY . <span class="op">/</span>app</span>
<span id="annotated-cell-59-14"><a href="#annotated-cell-59-14" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-59" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-59-15" class="code-annotation-target"><a href="#annotated-cell-59-15" aria-hidden="true" tabindex="-1"></a>ENV FLASK_APP<span class="op">=</span><span class="st">"hello-world.py"</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-59" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-59-16" class="code-annotation-target"><a href="#annotated-cell-59-16" aria-hidden="true" tabindex="-1"></a>EXPOSE <span class="dv">5000</span></span>
<span id="annotated-cell-59-17"><a href="#annotated-cell-59-17" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-59" data-target-annotation="7" onclick="event.preventDefault();">7</a><span id="annotated-cell-59-18" class="code-annotation-target"><a href="#annotated-cell-59-18" aria-hidden="true" tabindex="-1"></a>CMD [<span class="st">"flask"</span>, <span class="st">"run"</span>, <span class="st">"--host=0.0.0.0"</span>]</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-59" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-59" data-code-lines="3" data-code-annotation="1"><code>FROM</code>: defines the base image. All Docker images inherit from a base. Here we choose <code>ubuntu:20.04</code>, so our environment will act like a blank virtual machine running Ubuntu 20.04 <i class="fa-brands fa-linux" aria-label="linux"></i>;</span>
</dd>
<dt data-target-cell="annotated-cell-59" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-59" data-code-lines="6" data-code-annotation="2"><code>RUN</code>: executes a Linux command. We first update the list of installable packages, then install Python <i class="fa-brands fa-python" aria-label="python"></i> and any required system libraries;</span>
</dd>
<dt data-target-cell="annotated-cell-59" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-59" data-code-lines="8" data-code-annotation="3"><code>WORKDIR</code>: sets the working directory inside the image. All following commands will run from this path—Docker’s equivalent to the <code>cd</code> command (see <a href="../chapters/linux101.html">Linux 101</a>);</span>
</dd>
<dt data-target-cell="annotated-cell-59" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-59" data-code-lines="10,11,13" data-code-annotation="4"><code>COPY</code>: transfers files from the host to the Docker image. This is important because Docker builds images in isolation—your project files don’t exist inside the image unless explicitly copied. First, we copy <code>requirements.txt</code> to install dependencies, then copy the full project directory;</span>
</dd>
<dt data-target-cell="annotated-cell-59" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-59" data-code-lines="15" data-code-annotation="5"><code>ENV</code>: defines an environment variable accessible inside the container. Here, we use <code>FLASK_APP</code> to tell Flask which script to run;</span>
</dd>
<dt data-target-cell="annotated-cell-59" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-59" data-code-lines="16" data-code-annotation="6"><code>EXPOSE</code>: tells Docker the app will listen on port 5000—the default port for Flask’s development server;</span>
</dd>
<dt data-target-cell="annotated-cell-59" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-59" data-code-lines="18" data-code-annotation="7"><code>CMD</code>: defines the command to run when the container starts. Here, it launches the Flask server and binds it to all IPs in the container with <code>--host=0.0.0.0</code>.</span>
</dd>
</dl>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Choosing the Base Image
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Ideally, you want the smallest base image possible to reduce final image size. For example, there’s no need to use an image with <i class="fa-brands fa-r-project" aria-label="r-project"></i> if your project only uses <i class="fa-brands fa-python" aria-label="python"></i>.</p>
<p>Most languages provide lightweight base images with preinstalled and well-configured interpreters. In our case, we could have used <a href="https://hub.docker.com/layers/python/library/python/3.9-slim-buster/images/sha256-e07b35c0c81c21995a43cefd64730ac0e57a5164cc440b6a5c94c118cfacd0ca?context=explore"><code>python:3.9-slim-buster</code></a>.</p>
</div>
</div>
</div>
<p>The first <code>RUN</code> installs Python and system libraries required by our app. But how did we know which libraries to include?</p>
<p>Trial and error. During the <a href="#build">build</a> phase, Docker attempts to construct the image from the <code>Dockerfile</code>—as if it’s starting from a clean Ubuntu 20.04 machine. If a system dependency is missing, the build will fail and show an error message in the console logs. With luck, the logs will explicitly name the missing library. More often, the messages are vague and require some web searching—StackOverflow is a frequent lifesaver.</p>
<p>Before creating a Docker image, it’s helpful to go through an intermediate step: writing a shell script (<code>.sh</code>) to automate setup locally. This approach is outlined in the <a href="../chapters/application.html">running example</a>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The <code>COPY</code> Instruction
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Your <code>Dockerfile</code> recipe might require files from your working folder. To ensure Docker sees them during the build, you need a <code>COPY</code> command. Think of it like cooking: if you want to use an ingredient, you need to take it out of the fridge (your local disk) and place it on the table (Docker build context).</p>
</div>
</div>
</div>
<p>We’ve covered only the most common <code>Docker</code> commands. For a full reference, check the <a href="https://docs.docker.com/engine/reference/builder/">official documentation</a>.</p>
</section>
<section id="build" class="level2">
<h2 class="anchored" data-anchor-id="build">Building a Docker Image</h2>
<p>To build an image from a <code>Dockerfile</code>, use the <code>docker build</code> command from the terminal<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a>. Two important arguments must be provided:</p>
<ul>
<li>the <strong>build context</strong>: this tells Docker where the project is located (it should contain the <code>Dockerfile</code>). The simplest approach is to navigate into the project directory via <code>cd</code> and pass <code>.</code> to indicate “build from here”;</li>
<li>the <strong>tag</strong>, i.e., the name of the image. While working locally, the tag doesn’t matter much, but we’ll see later that it becomes important when <a href="#imp-docker">exporting</a> or <a href="#exp-docker">importing</a> an image from/to a remote repository.</li>
</ul>
<p>Let’s see what happens when we try to build our image with the tag <code>myflaskapp</code>:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb42" data-filename="terminal" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> myflaskapp .</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb43" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>Sending build context to Docker daemon     <span class="dv">47</span><span class="er">MB</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>Step <span class="dv">1</span><span class="op">/</span><span class="dv">8</span> : FROM ubuntu:<span class="fl">20.04</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> <span class="dv">825</span><span class="er">d55fb6340</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>Step <span class="dv">2</span><span class="op">/</span><span class="dv">8</span> : RUN apt<span class="op">-</span>get update <span class="op">&amp;&amp;</span> apt<span class="op">-</span>get install <span class="op">-</span>y python3<span class="op">-</span>pip python3<span class="op">-</span>dev</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> Running <span class="kw">in</span> <span class="dv">92</span><span class="er">b42d579cfa</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>done.</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>Removing intermediate container <span class="dv">92</span><span class="er">b42d579cfa</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> <span class="dv">8826</span><span class="er">d53e3c01</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>Successfully built <span class="dv">125</span><span class="er">bd8da70ff</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>Successfully tagged myflaskapp:latest</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Docker’s engine processes the instructions from the <code>Dockerfile</code> one at a time. If there’s an error, the build stops, and you’ll need to debug the problem using the log output and adjust the <code>Dockerfile</code> accordingly.</p>
<p>If successful, Docker will indicate that the build was completed and that the image is ready for use. You can confirm its presence with the <code>docker images</code> command:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb44" data-filename="terminal" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> images</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb45" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>REPOSITORY   TAG       IMAGE ID       CREATED          SIZE</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>myflaskapp   latest    <span class="dv">57</span><span class="er">d2f410a631</span>   <span class="dv">2</span> hours ago      <span class="dv">433</span><span class="er">MB</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let’s look more closely at the build logs 👆️.</p>
<p>Between each step, Docker prints cryptic hashes and mentions intermediate containers. Think of a Docker image as a stack of <strong>layers</strong>, each layer being itself a Docker image. The <code>FROM</code> instruction specifies the starting layer. Each command adds a new layer with a unique hash.</p>
<p>This design is not just technical trivia—it’s incredibly useful in practice because Docker <strong>caches</strong> each intermediate layer<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a>.</p>
<p>For example, if you modify the 5th instruction in the <code>Dockerfile</code>, Docker will reuse the cache for previous layers and only rebuild from the change onward. This is called <strong>cache invalidation</strong>: once a step changes, Docker recalculates that step and all that follow, but no more. As a result, you should always place frequently changing steps at the end of the file.</p>
<p>Let’s illustrate this by changing the <code>FLASK_APP</code> environment variable in the <code>Dockerfile</code>:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb46" data-filename="terminal" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build . <span class="at">-t</span> myflaskapp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb47" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>Sending build context to Docker daemon  <span class="fl">4.096</span><span class="er">kB</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>Step <span class="dv">1</span><span class="op">/</span><span class="dv">10</span> : FROM ubuntu:<span class="fl">20.04</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> <span class="dv">825</span><span class="er">d55fb6340</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>Step <span class="dv">2</span><span class="op">/</span><span class="dv">10</span> : ENV DEBIAN_FRONTEND<span class="op">=</span>noninteractive</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> Using cache</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> ea1c7c083ac9</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>Step <span class="dv">3</span><span class="op">/</span><span class="dv">10</span> : RUN apt<span class="op">-</span>get update <span class="op">-</span>y <span class="op">&amp;&amp;</span> ...</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> Using cache</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> <span class="dv">0</span><span class="er">78b8ac0e1cb</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>Step <span class="dv">8</span><span class="op">/</span><span class="dv">10</span> : ENV FLASK_APP<span class="op">=</span><span class="st">"new.py"</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a> <span class="op">---&gt;</span> Running <span class="kw">in</span> b378d16bb605</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>Successfully built <span class="dv">16</span><span class="er">d7a5b8db28</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>Successfully tagged myflaskapp:latest</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The build finishes in seconds instead of minutes. The logs show that previous steps were cached, and only modified or dependent ones were rebuilt.</p>
</section>
<section id="execution" class="level2">
<h2 class="anchored" data-anchor-id="execution">Running a Docker Image</h2>
<p>The <code>build</code> step created a <strong>Docker image</strong>—essentially a blueprint for your app. It can be executed on any environment with Docker installed.</p>
<p>So far, we’ve built the image but haven’t <strong>run</strong> it. To launch the app, we must create a <strong>container</strong>, i.e., a live instance of the image. This is done with the <code>docker run</code> command:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb48" data-filename="terminal" data-no-prefix="true" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker run <span class="at">-d</span> <span class="at">-p</span> 8000:5000 myflaskapp:latest</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="ex">6a2ab0d82d051a3829b182ede7b9152f7b692117d63fa013e7dfe6232f1b9e81</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here’s a breakdown of the command:</p>
<ul>
<li><code>docker run tag</code>: runs the image specified by <code>tag</code>. Tags usually follow the format <code>repository/project:version</code>. Since we’re local, there’s no repository;</li>
<li><code>-d</code>: runs the container in <strong>detached</strong> mode (in the background);</li>
<li><code>-p</code>: maps a port on the host machine (8000) to a port inside the container (5000). Since Flask listens on port 5000, this makes the app accessible via <code>localhost:8000</code>.</li>
</ul>
<p>The command returns a long hash—this is the container ID. You can verify that it’s running with:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb49" data-filename="terminal" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> ps</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb50" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>CONTAINER ID   IMAGE        COMMAND                  CREATED         STATUS         PORTS                                   NAMES</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span><span class="er">a2ab0d82d05</span>   myflaskapp   <span class="st">"flask run --host=0.…"</span>   <span class="dv">7</span> seconds ago   Up <span class="dv">6</span> seconds   <span class="fl">0.0.0.0</span>:<span class="dv">8000</span><span class="op">-&gt;</span><span class="dv">5000</span><span class="op">/</span>tcp, :::<span class="dv">8000</span><span class="op">-&gt;</span><span class="dv">5000</span><span class="op">/</span>tcp   vigorous_kalam</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Docker containers serve different purposes. Broadly, they fall into two categories:</p>
<ul>
<li><strong>One-shot jobs</strong>: containers that execute a task and terminate;</li>
<li><strong>Running apps</strong>: containers that persist while serving an application.</li>
</ul>
<p>In our case, we’re in the second category. We want to run a web app, so the container must stay alive. Flask launches a server on a local port (5000), and we’ve mapped it to port 8000 on our machine. You can access the app from your browser at <a href="http://localhost:8000/">localhost:8000</a>, just like a Jupyter notebook.</p>
<p>In the end, we’ve built and launched a fully working application on our local machine—without installing anything beyond Docker itself.</p>
</section>
<section id="exp-docker" class="level2">
<h2 class="anchored" data-anchor-id="exp-docker">Exporting a Docker Image</h2>
<p>So far, all Docker commands we’ve run were executed locally. This is fine for development and experimentation. But as we’ve seen, one of Docker’s biggest strengths is the ability to easily share images with others. These images can then be used by multiple users to run the same application on their own machines.</p>
<p>To do this, we need to <strong>upload</strong> our image to a remote repository from which others can <strong>download</strong> it.</p>
<p>There are various options depending on your context: a company might have a private registry, while open-source projects can use <a href="https://hub.docker.com/">DockerHub</a>.</p>
<p>Here is the typical workflow for uploading an image:</p>
<ul>
<li>Create an account on DockerHub;</li>
<li>Create a (public) project on DockerHub to host your Docker images;</li>
<li>Use <code>docker login</code> in your terminal to authenticate with DockerHub;</li>
<li>Modify the image tag during the build to include the expected path. For example: <code>docker build -t username/project:version .</code>;</li>
<li>Push the image with <code>docker push username/project:version</code>.</li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb51" data-filename="terminal" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> push avouacr/myflaskapp:1.0.0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb52" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>The push refers to repository [docker.io<span class="op">/</span>avouacr<span class="op">/</span>myflaskapp]</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="dv">71</span><span class="er">db96687fe6</span>: Pushed</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="dv">624877</span><span class="er">ac887b</span>: Pushed</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>ea4ab6b86e70: Pushed</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="imp-docker" class="level2">
<h2 class="anchored" data-anchor-id="imp-docker">Importing a Docker Image</h2>
<p>If the image repository is public, users can pull the image using a single command:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb53" data-filename="terminal" data-code-line-numbers=""><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> pull avouacr/myflaskapp:1.0.0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb54" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fl">1.0.0</span>: Pulling <span class="im">from</span> avouacr<span class="op">/</span>myflaskapp</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>e0b25ef51634: Pull complete</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>c0445e4b247e: Pull complete</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>Status: Downloaded newer image <span class="cf">for</span> avouacr<span class="op">/</span>myflaskapp:<span class="fl">1.0.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Docker will download and unpack each layer of the image (which may take time). Once downloaded, users can run the container with the <code>docker run</code> command as shown earlier.</p>
</section>
<section id="cheat-sheet-1" class="level2">
<h2 class="anchored" data-anchor-id="cheat-sheet-1">Cheat Sheet</h2>
<p>Here’s a quick reference of common <code>Dockerfile</code> commands:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 40%">
<col style="width: 59%">
</colgroup>
<thead>
<tr class="header">
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>FROM &lt;image&gt;:&lt;tag&gt;</code></td>
<td>Use <code>&lt;image&gt;</code> with <code>&lt;tag&gt;</code> as the base image</td>
</tr>
<tr class="even">
<td><code>RUN &lt;instructions&gt;</code></td>
<td>Execute Linux shell instructions. Use <code>&amp;&amp;</code> to chain commands. Use <code>\</code> to split long commands across multiple lines</td>
</tr>
<tr class="odd">
<td><code>COPY &lt;source&gt; &lt;dest&gt;</code></td>
<td>Copy a file from the local machine into the image</td>
</tr>
<tr class="even">
<td><code>ADD &lt;source&gt; &lt;dest&gt;</code></td>
<td>Similar to <code>COPY</code>, but can also handle URLs and tar archives</td>
</tr>
<tr class="odd">
<td><code>ENV MY_NAME="John Doe"</code></td>
<td>Define an environment variable available via <code>$MY_NAME</code></td>
</tr>
<tr class="even">
<td><code>WORKDIR &lt;path&gt;</code></td>
<td>Set the working directory inside the container</td>
</tr>
<tr class="odd">
<td><code>USER &lt;username&gt;</code></td>
<td>Set a non-root user named <code>&lt;username&gt;</code></td>
</tr>
<tr class="even">
<td><code>EXPOSE &lt;PORT_ID&gt;</code></td>
<td>Indicate that the application will listen on port <code>&lt;PORT_ID&gt;</code></td>
</tr>
<tr class="odd">
<td><code>CMD ["executable","param1","param2"]</code></td>
<td>Define the default command to run when the container starts</td>
</tr>
</tbody>
</table>
<p>And a second cheat sheet with basic Docker CLI commands:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 40%">
<col style="width: 59%">
</colgroup>
<thead>
<tr class="header">
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>docker build . -t &lt;tag&gt;</code></td>
<td>Build the Docker image from current directory, tagging it with <code>&lt;tag&gt;</code></td>
</tr>
<tr class="even">
<td><code>docker run -it &lt;tag&gt;</code></td>
<td>Run the container interactively from image with <code>&lt;tag&gt;</code></td>
</tr>
<tr class="odd">
<td><code>docker images</code></td>
<td>List locally available images and metadata (tags, size, etc.)</td>
</tr>
<tr class="even">
<td><code>docker system prune</code></td>
<td>Clean up unused images and containers (use with caution)</td>
</tr>
</tbody>
</table>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’ll later explain how distributing <em>packages</em> as precompiled <em>wheels</em> addresses this issue.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>This means that if you open a new terminal, you’ll need to activate the environment again if you want to use it. To activate an environment by default, you can configure your terminal (e.g., by editing <code>.bashrc</code> on Linux) to automatically activate a specific environment when it starts.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>In fact, if you’re using <code>pip</code> on SSPCloud,<br>
you’re doing exactly this—without realizing it.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>These repositories are known as <em>channels</em> in the <code>conda</code> ecosystem.<br>
The default channel is maintained by the developers at <code>Anaconda</code>.<br>
To ensure stability, this channel updates more slowly.<br>
The <code>conda-forge</code> channel emerged to offer developers more flexibility,<br>
letting them publish newer versions of their packages, much like <a href="https://pypi.org/">PyPI</a>.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>The terms “image” and “container” are often used interchangeably.<br>
Technically, a container is the live version of an image.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p><a href="https://flask.palletsprojects.com/en/2.1.x/"><code>Flask</code></a> is a lightweight framework for deploying Python-based web applications.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>On Windows, the default command lines (<code>cmd</code> or <code>PowerShell</code>) are not very convenient. We recommend using the <code>Git Bash</code> terminal, a lightweight Linux command-line emulator, for better compatibility with command-line operations.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>Caching is very useful for local development. Unfortunately, it’s harder to leverage in CI environments, since each run usually happens on a fresh machine.<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<script src="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>